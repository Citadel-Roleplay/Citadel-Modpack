agot_attempt_triarchy = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major
	ai_check_interval = 120
	desc = agot_attempt_triarchy_desc

	is_shown = {
		is_independent_ruler = yes
		government_has_flag = government_is_free_city
		NOR = {
			exists = title:e_three_daughters.holder
			exists = global_var:three_daughters_confederation
		}
		OR = {
			has_title = title:k_tyrosh
			has_title = title:k_lys
			has_title = title:k_myr
		}
		NAND = {
			has_title = title:k_tyrosh
			has_title = title:k_lys
			has_title = title:k_myr
		}
	}

	is_valid = {
		is_independent_ruler = yes
		NOR = {
			exists = title:e_three_daughters.holder
			exists = global_var:three_daughters_confederation
		}
		exists = title:k_tyrosh.holder
		title:k_tyrosh.holder = { government_has_flag = government_is_free_city }
		exists = title:k_lys.holder
		title:k_lys.holder = { government_has_flag = government_is_free_city }
		exists = title:k_myr.holder
		title:k_myr.holder = { government_has_flag = government_is_free_city }
		OR = {
			has_title = title:k_tyrosh
			has_title = title:k_lys
			has_title = title:k_myr
		}
		NOT = {
			title:k_myr.holder = { is_at_war = yes }
			title:k_lys.holder = { is_at_war = yes }
			title:k_tyrosh.holder = { is_at_war = yes }
		}

		trigger_if = {
			limit = {
				NOT = { has_title = title:k_tyrosh }
			}
			title:k_tyrosh.holder = {
				is_allied_to = root
				opinion = {
					target = root
					value >= 80
				}
			}
		}

		trigger_if = {
			limit = {
				NOT = { has_title = title:k_lys }
			}
			title:k_lys.holder = {
				is_allied_to = root
				opinion = {
					target = root
					value >= 80
				}
			}
		}

		trigger_if = {
			limit = {
				NOT = { has_title = title:k_myr }
			}
			title:k_myr.holder = {
				is_allied_to = root
				opinion = {
					target = root
					value >= 80
				}
			}
		}

		trigger_if = {
			limit = {
				NOT = { has_title = title:k_tyrosh }
				NOT = { has_title = title:k_lys }
			}
			title:k_tyrosh.holder = {
				opinion = {
					target = title:k_lys.holder
					value >= 80
				}
			}
			title:k_lys.holder = {
				opinion = {
					target = title:k_tyrosh.holder
					value >= 80
				}
			}
		}

		trigger_if = {
			limit = {
				NOT = { has_title = title:k_tyrosh }
				NOT = { has_title = title:k_myr }
			}
			title:k_tyrosh.holder = {
				opinion = {
					target = title:k_myr.holder
					value >= 80
				}
			}
			title:k_myr.holder = {
				opinion = {
					target = title:k_tyrosh.holder
					value >= 80
				}
			}
		}

		trigger_if = {
			limit = {
				NOT = { has_title = title:k_lys }
				NOT = { has_title = title:k_myr }
			}
			title:k_lys.holder = {
				opinion = {
					target = title:k_myr.holder
					value >= 80
				}
			}
			title:k_myr.holder = {
				opinion = {
					target = title:k_lys.holder
					value >= 80
				}
			}
		}

	}

	ai_potential = {
		is_independent_ruler = yes
		government_has_flag = government_is_free_city
		NOR = {
			exists = title:e_three_daughters.holder
			exists = global_var:three_daughters_confederation
		}
		exists = title:k_tyrosh.holder
		exists = title:k_lys.holder
		exists = title:k_myr.holder
		OR = {
			has_title = title:k_tyrosh
			has_title = title:k_lys
			has_title = title:k_myr
		}
		NOT = {
			title:k_myr.holder = { is_at_war = yes }
			title:k_lys.holder = { is_at_war = yes }
			title:k_tyrosh.holder = { is_at_war = yes }
		}
	}

	ai_will_do = {
		base = 5
		modifier = {
			has_trait = ambitious
			add = 40
		}
		modifier = {
			has_trait = authoritative
			add = 5
		}
	}

	effect = {
		save_scope_as = request_sender
		set_global_variable = {
			name = triarchy_agreements
			value = 1
		}
		title:k_tyrosh.holder = {
			if = { limit = { title:k_tyrosh.holder != root } trigger_event = free_city_events.0001 }
			save_scope_as = archon_tyrosh
		}
		title:k_lys.holder = {
			save_scope_as = first_magister_lys
			if = { limit = { title:k_lys.holder != root } trigger_event = free_city_events.0001 }
		}
		title:k_myr.holder = {
			save_scope_as = first_magister_myr
			if = { limit = { title:k_myr.holder != root } trigger_event = free_city_events.0001 }
		}
		trigger_event = {
			id = free_city_events.0002
			days = 1
		}
	}

	cost = { prestige = 2500 }

	cooldown = { years = 10 }
}

agot_create_three_daughters = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major
	ai_check_interval = 120
	desc = agot_create_three_daughters_desc

	is_shown = {
		is_independent_ruler = yes
		NOR = {
			exists = title:e_three_daughters.holder
			exists = global_var:three_daughters_confederation
		}
		has_title = title:k_tyrosh
		has_title = title:k_lys
		has_title = title:k_myr
	}

	ai_will_do = {
		base = 5
		modifier = {
			has_trait = ambitious
			add = 40
		}
		modifier = {
			has_trait = authoritative
			add = 5
		}
	}

	effect = {
		save_scope_as = request_sender
		create_triarchy = yes
	}

	cost = { prestige = 2500 }
}

agot_stepstones_rhoynish_culture = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major
	ai_check_interval = 120
	desc = agot_stepstones_rhoynish_culture_desc

	is_shown = {
		NOT = { has_global_variable = stepstones_rhoynish_culture_decision }
		agot_is_independent_ruler = yes
		has_title = title:c_turtleback
		has_culture = culture:rhoynish
	}

	is_valid = {
		agot_is_independent_ruler = yes
		is_at_war = no
		prestige_level >= 3
		OR = {
			AND = {
				has_title = title:d_first_stepstones
				has_title = title:d_skull_tides
			}
			has_title = title:k_the_stepstones
		}
	}

	cost = { prestige = 3500 }

	ai_potential = {
		is_independent_ruler = yes
		is_at_war = no
		prestige_level >= 3
		OR = {
			AND = {
				has_title = title:d_first_stepstones
				has_title = title:d_skull_tides
			}
			has_title = title:k_the_stepstones
		}
	}

	ai_will_do = {
		base = 5
		modifier = {
			has_trait = ambitious
			add = 40
		}
		modifier = {
			has_trait = authoritative
			add = 5
		}
	}

	effect = {
		set_global_variable = stepstones_rhoynish_culture_decision
		custom_tooltip = agot_stepstones_rhoynish_culture_tooltip
		hidden_effect = {
			create_divergent_culture_with_side_effects_excluding_cost = yes
			culture = {
				set_culture_name = {
					noun = somberysh
					prefix = somberysh_prefix
					collective_noun = somberysh_collective_noun
				}
				copy_all_traditions_from = culture:rhoynish
				get_all_innovations_from = culture:rhoynish
				set_culture_pillar = ethos_methodical
				remove_culture_tradition = tradition_agrarian
				remove_culture_tradition = tradition_metal_craftsmanship
				add_culture_tradition = tradition_lords_of_the_elephant
				add_culture_tradition = agot_tradition_harsh_laws
				set_variable = {
					name = recent_event_divergence
					days = 3650
				}
			}
		}
	}
}

agot_seize_control = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major
	ai_check_interval = 120
	desc = agot_seize_control_desc

	is_shown = {
		is_independent_ruler = yes
		government_has_flag = government_is_free_city
		primary_title = {
			tier >= tier_kingdom
			has_title_law = dictatorship_succession_law
		}
	}

	is_valid = {
		is_independent_ruler = yes
		has_realm_law = imperial_bureaucracy_3
		dread >= 100
		primary_title = {
			title_held_years >= 20
			custom_tooltip = {
				text = agot_seize_control_full_county_control_tt
				title_capital_county = {
					county_control >= full_county_control
				}
			}
		}
		custom_tooltip = {
			text = strong_hook_on_all_powerful_vassals_tt
			any_powerful_vassal = {
				count = all
				root = { has_strong_hook = prev }
			}
		}
	}

	ai_potential = {
		always = no
	}

	ai_will_do = {
		base = 0
	}

	effect = {
		convert_to_feudalism_from_administrative_effect = yes
		end_diarchy = yes
	}

	cost = { prestige = 2500 }

	cooldown = { years = 10 }
}

agot_form_undisputed_lands = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_found_kingdom.dds"
	}
	decision_group_type = major

	ai_check_interval = 120

	desc = agot_form_undisputed_lands_decision_desc
	selection_tooltip = agot_form_undisputed_lands_decision_tooltip

	is_shown = {
		is_landed = yes
		exists = dynasty
		#Must be in the vague region.
		any_held_county = {
			title_province = { geographical_region = world_essos_disputed_lands }
		}
	}

	is_valid = {
		#Must be independent.
		is_independent_ruler = yes
		#Has to be around for the ceremony.
		is_imprisoned = no
		#Should have the highest prestige level.
		prestige_level >= max_prestige_level
		has_title = title:d_ibonanne
		has_title = title:d_izuloktia
		has_title = title:d_silkhead
		has_title = title:d_aesomyr
		has_title = title:d_hells_barrens
		has_title = title:d_the_shambles
		has_title = title:d_battle_hills
	}

	is_valid_showing_failures_only = {
		is_alive = yes
		NOT = { exists = involved_activity }
		is_imprisoned = no
		#Can't already be a kingdom.
		NOT = { highest_held_title_tier = tier_kingdom }
		NOT = { has_primary_title = title:e_blackfyre_rebellion }
		NOR = {
			exists = title:e_three_daughters.holder
			exists = global_var:three_daughters_confederation
		}
		NOT = { exists = title:k_disputed_lands.holder }
	}

	effect = {
		save_scope_as = founder
		# Trigger effects.
		show_as_tooltip = {
			scope:founder = {
				show_as_tooltip = {
					create_title_and_vassal_change = {
						type = created
						save_scope_as = title_change
					}
					title:k_disputed_lands = {
						change_title_holder = {
							holder = scope:founder
							change = scope:title_change
						}
					}
					resolve_title_and_vassal_change = scope:title_change
				}
			}
		}
		trigger_event = { id = agot_decisions_events.0001 }

		#Notify other players.
		every_player = {
			limit = {
				capital_province = { geographical_region = world_essos_free_cities }
				#Obviously, we exempt scope:founder themselves.
				NOT = { this = scope:founder }
			}
			#Vassal players get a separate event.
			if = {
				limit = {
					any_liege_or_above = { this = scope:founder }
				}
				trigger_event = agot_decisions_events.0002
			}
			#Everyone else within range gets a less personal version.
			else = { trigger_event = agot_decisions_events.0003 }
		}
	}

	cost = {
		prestige = 2000
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

agot_break_braavos_pentos_treaty = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major
	ai_check_interval = 120
	desc = agot_break_braavos_pentos_treaty_desc

	is_shown = {
		has_title = title:k_pentos
		exists = global_var:braavos_treaty
		exists = title:k_braavos.holder
	}

	is_valid = {
		is_at_war = no
		is_imprisoned = no
	}

	cost = {
		prestige = 5000
		gold = 500
	}

	ai_potential = {
		is_independent_ruler = yes
		is_at_war = no
	}

	ai_will_do = {
		base = 15
	}

	effect = {
		custom_tooltip = agot_break_braavos_pentos_treaty_effect_tt
		custom_tooltip = agot_break_braavos_pentos_treaty_effect_2_tt
		trigger_event = agot_decisions_events.0202
		show_as_tooltip = {
			remove_character_modifier = agot_pentos_braavos_treaty
		}
		hidden_effect = {
			every_living_character = {
				limit = {
					has_character_modifier = agot_pentos_braavos_treaty
				}
				remove_character_modifier = agot_pentos_braavos_treaty
				if = {
					limit = {
						this != root
					}
					trigger_event = { id = agot_decisions_events.0201 days = 1 }
				}
			}
			remove_global_variable = braavos_treaty
			set_global_variable = {
				name = braavos_treaty_broken
				value = yes
				years = 15
			}
		}
		title:k_braavos.holder = { trigger_event = { id = agot_decisions_events.0200 days = 1 } }
	}
}

agot_break_braavos_pentos_treaty_as_braavos = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major
	ai_check_interval = 120
	desc = agot_break_braavos_pentos_treaty_as_braavos_desc

	is_shown = {
		has_title = title:k_braavos
		exists = global_var:braavos_treaty
		exists = title:k_pentos.holder
	}

	is_valid_showing_failures_only = {
		is_at_war = no
		is_imprisoned = no
		NOT = {
			culture = {
				has_cultural_tradition = tradition_astute_diplomats
			}
		}
	}

	cost = {
		prestige = 5000
		gold = 500
	}

	ai_potential = {
		is_independent_ruler = yes
		is_at_war = no
	}

	ai_will_do = {
		base = 5
		modifier = {
			add = 10
			ai_has_warlike_personality = yes
		}
	}

	effect = {
		custom_tooltip = agot_break_braavos_pentos_treaty_effect_tt
		custom_tooltip = agot_break_braavos_pentos_treaty_as_braavos_effect_tt
		remove_global_variable = braavos_treaty
		add_prestige_level = -1
		if = {
			limit = {
				is_ai = no
			}
			trigger_event = agot_decisions_events.0205
		}
		hidden_effect = {
			title:k_pentos.holder = {
				if = {
					limit = {
						has_character_modifier = agot_pentos_braavos_treaty
					}
					remove_character_modifier = agot_pentos_braavos_treaty
				}
				every_vassal_or_below = {
					limit = {
						has_character_modifier = agot_pentos_braavos_treaty
					}
					remove_character_modifier = agot_pentos_braavos_treaty
				}
				if = {
					limit = {
						is_ai = no
					}
					trigger_event = agot_decisions_events.0205
				}
				every_vassal_or_below = {
					limit = {
						is_ai = no
					}
					trigger_event = agot_decisions_events.0205
				}
			}
		}
	}
}