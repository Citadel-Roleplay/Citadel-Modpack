laughing_storm_rebellion_scopes_effect = {
	### Baratheons

	#Lyonel Baratheon - Baratheon_71
	character:Baratheon_71 = {
		save_scope_as = lyonel
	}
	#Cassandra Baratheon - Baratheon_76
	character:Baratheon_76 = {
		save_scope_as = cassandra
	}
	#Ormund Baratheon - Baratheon_75
	character:Baratheon_75 = {
		save_scope_as = ormund
	}
	#Harbert Baratheon - Baratheon_77
	character:Baratheon_77 = {
		save_scope_as = harbert
	}

	### King's Landing

	#Aegon V - Targaryen_122
	character:Targaryen_122 = {
		save_scope_as = aegonv
	}
	#Duncan Targaryen - Targaryen_126
	character:Targaryen_126 = {
		save_scope_as = duncansmall
	}
	#Jaehaerys Targaryen - Targaryen_127
	character:Targaryen_127 = {
		save_scope_as = jaehaerys
	}
	#Shaera Targaryen - Targaryen_128
	character:Targaryen_128 = {
		save_scope_as = shaera
	}
	#Daeron Targaryen - Targaryen_129
	character:Targaryen_129 = {
		save_scope_as = daeron
	}
	#Rhaelle Targaryen - Targaryen_130
	character:Targaryen_130 = {
		save_scope_as = rhaelle
	}
	#Vaella Targaryen - Targaryen_124
	character:Targaryen_124 = {
		save_scope_as = vaella
	}
	#Duncan Tall - Tall_1
	character:Tall_1 = {
		save_scope_as = duncantall
	}
	#Jenny of Oldstones - Targaryen_hh_10
	character:Targaryen_hh_10 = {
		save_scope_as = jenny
	}

	### Targaryen Betrothed Houses

	#Garlan Tyrell - Tyrell_1
	character:Tyrell_1 = {
		save_scope_as = garlan
	}
	#Luthor Tyrell - Tyrell_4
	character:Tyrell_4 = {
		save_scope_as = luthor
	}
	#Runceford Redwyne - Redwyne_43
	character:Redwyne_43 = {
		save_scope_as = runceford
	}
	#Olenna Redwyne - Redwyne_2
	character:Redwyne_2 = {
		save_scope_as = olenna
	}
	#Steffon Tully - Tully_66
	character:Tully_66 = {
		save_scope_as = steffon
	}
	#Celia Tully - Tully_68
	character:Tully_68 = {
		save_scope_as = celia
	}

	### Tytos & Ellyn Story

	#Gerold Lannister - Lannister_120
	character:Lannister_120 = {
		save_scope_as = gerold
	}
	#Tytos Lannister - Lannister_129
	character:Lannister_129 = {
		save_scope_as = tytos
	}
	#Jeyne Marbrand - Marbrand_51
	character:Marbrand_51 = {
		save_scope_as = jeyne
	}
	#Ellyn Reyne - Reyne_46
	character:Reyne_46 = {
		save_scope_as = ellyn
	}
	#Roger Reyne - Reyne_45
	character:Reyne_45 = {
		save_scope_as = roger
	}
	#High Septon - Most_Devout_19
	character:Most_Devout_19 = {
		save_scope_as = high_septon
	}

	### Bloodraven Story

	#Bloodraven - Targaryen_96
	character:Targaryen_96 = {
		save_scope_as = bloodraven
	}
	#Aemon Targaryen - Targaryen_120
	character:Targaryen_120 = {
		save_scope_as = aemon
	}
	#Jack Musgood - Musgood_25
	character:Musgood_25 = {
		save_scope_as = jack
	}
	#Aerion Targaryen - Targaryen_119
	character:Targaryen_119 = {
		save_scope_as = aerion
	}
}

agot_8239_1_11_laughing_storm_setup = {
	##### SCENARIO STORY CYCLES SETUP #####

	#The Laughing Storm Rebellion Story Cycle
	if = {
		limit = { title:k_the_stormlands.holder = character:Baratheon_71 }
		title:k_the_stormlands.holder = {
			create_story = { # Initialize The Laughing Storm Rebellion
				type = story_agot_laughing_storm_rebellion
				save_scope_as = laughing_storm_rebellion_story
			}
		}
	}

	#Laughing Storm - Targaryen Children Story Cycle
	if = {
		limit = { exists = character:Targaryen_127 }
		character:Targaryen_127 = {
			create_story = { # Initialize The Laughing Storm Rebellion
				type = story_agot_targaryen_children_lsr
				save_scope_as = laughing_storm_targaryen_children_story
			}
		}
	}

	#Maelys Story Cycle
	if = {
		limit = { exists = character:Blackfyre_14 }
		character:Blackfyre_14 = {
			create_story = { # Initialize Maelys Story
				type = story_maelys_lsr
				save_scope_as = maelys_story
			}
		}
	}

	#Bittersteel Start Event
	if = {
		limit = { exists = character:Targaryen_95 }
		character:Targaryen_95 = {
			add_character_flag = {
				flag = block_laamp_starting_event
				weeks = 1
			}
			trigger_event = agot_laughing_storm_rebellion.0105
		}
	}

	#Bloodraven Story Cycle
	if = {
		limit = { exists = character:Targaryen_96 }
		character:Targaryen_96 = {
			create_story = { # Initialize Bloodraven Story
				type = story_bloodraven_lsr
				save_scope_as = bloodraven_story
			}
		}
	}

	#Tytos & Ellyn Story
	if = {
		limit = { exists = character:Reyne_46 }
		character:Reyne_46 = {
			add_trait = refusing_marriage
			trigger_event = {
				id = agot_laughing_storm_rebellion.0300
				days = { 7 60 }
			}
		}
	}

	#The Scaly Story
	if = {
		limit = { exists = title:b_ruins.holder }
		title:b_ruins.holder = {
			trigger_event = {
				id = agot_laughing_storm_rebellion.0200
				days = 1085
			}
		}
	}

	### CANON CHILDREN STORY CYCLE SETUP ###
	agot_canon_children_setup_story_cycles_effect = yes
	######
}

create_laughing_storm_rebel_alliances_effect = {
	if = {
		limit = {
			character:Baratheon_71 = { is_alive = yes }
			character:Baratheon_71 = { is_ruler = yes }
			character:Baratheon_71 = { NOT = { is_allied_to = character:Tully_66 } }
			character:Tully_66 = { is_alive = yes }
			character:Tully_66 = { has_character_flag = rebellion_in_the_making }
			character:Tully_66 = { has_character_flag = ally }
			character:Tully_66 = { is_ruler = yes }
		}

		character:Tully_66 = {
			add_opinion = {
				target = character:Baratheon_71
				modifier = event_negotiated_alliance_opinion
			}
		}

		character:Baratheon_71 = {
			create_alliance = {
				target = character:Tully_66
				allied_through_owner = character:Baratheon_71
				allied_through_target = character:Tully_66
			}
		}
	}
	if = {
		limit = {
			character:Baratheon_71 = { is_alive = yes }
			character:Baratheon_71 = { is_ruler = yes }
			character:Baratheon_71 = { NOT = { is_allied_to = character:Redwyne_43 } }
			character:Redwyne_43 = { is_alive = yes }
			character:Redwyne_43 = { has_character_flag = rebellion_in_the_making }
			character:Redwyne_43 = { has_character_flag = ally }
			character:Redwyne_43 = { is_ruler = yes }
		}

		character:Redwyne_43 = {
			add_opinion = {
				target = character:Baratheon_71
				modifier = event_negotiated_alliance_opinion
			}
		}

		character:Baratheon_71 = {
			create_alliance = {
				target = character:Redwyne_43
				allied_through_owner = character:Baratheon_71
				allied_through_target = character:Redwyne_43
			}
		}
	}
	if = {
		limit = {
			character:Baratheon_71 = { is_alive = yes }
			character:Baratheon_71 = { is_ruler = yes }
			character:Baratheon_71 = { NOT = { is_allied_to = character:Tyrell_1 } }
			character:Tyrell_1 = { is_alive = yes }
			character:Tyrell_1 = { has_character_flag = rebellion_in_the_making }
			character:Tyrell_1 = { has_character_flag = ally }
			character:Tyrell_1 = { is_ruler = yes }
		}

		character:Tyrell_1 = {
			add_opinion = {
				target = character:Baratheon_71
				modifier = event_negotiated_alliance_opinion
			}
		}

		character:Baratheon_71 = {
			create_alliance = {
				target = character:Tyrell_1
				allied_through_owner = character:Baratheon_71
				allied_through_target = character:Tyrell_1
			}
		}
	}
	if = {
		limit = {
			character:Targaryen_122 = { is_alive = yes }
			title:e_the_iron_throne.holder = character:Targaryen_122
			title:k_dragonstone.holder = character:Targaryen_122.primary_heir
		}
		title:k_dragonstone.holder = {
			create_alliance = {
				target = character:Targaryen_122
				allied_through_owner = title:k_dragonstone.holder
				allied_through_target = character:Targaryen_122
			}
		}
	}
}

agot_scaliest_effect = {
	if = {
		limit = { is_male = yes }
		change_first_name = "Allard"
	}
	else_if = {
		limit = { is_female = yes }
		change_first_name = "Alys"
	}
	make_trait_inactive = is_scaly_1
	#add_character_flag = is_scaly_allard
	copy_inheritable_appearance_from = character:Dummy_Scaly_1

	add_character_flag = has_scripted_appearance
	make_trait_inactive = scripted_appearance
}

agot_laughing_storm_instant_divorce_events_effect = {
	scope:daeron = {
		if = {
			limit = { has_character_flag = divorce_is_instant }
			add_character_flag = instant_divorce
			remove_character_flag = divorce_is_instant
		}
	}
	scope:jaehaerys = {
		if = {
			limit = { has_character_flag = divorce_is_instant }
			add_character_flag = instant_divorce
			remove_character_flag = divorce_is_instant
		}
	}

	if = {
		limit = {
			scope:jaehaerys = { has_character_flag = instant_divorce }
		}
		scope:jaehaerys = {
			trigger_event = {
				id = agot_laughing_storm_rebellion.0011
				days = { 5 15 }
			}
		}
	}
	else_if = {
		limit = {
			scope:daeron = { has_character_flag = instant_divorce }
			scope:jaehaerys = { NOT = { has_character_flag = instant_divorce } }
		}
		scope:daeron = {
			trigger_event = {
				id = agot_laughing_storm_rebellion.0012
				days = { 5 15 }
			}
		}
	}
}

agot_laughing_storm_instant_war_effect = {
	scope:lyonel = {
		add_character_flag = {
			flag = lyonel_instant_war
			days = 90
		}
	}
	scope:daeron = {
		if = {
			limit = { has_character_flag = divorce_is_instant }
			add_character_flag = instant_divorce
			remove_character_flag = divorce_is_instant
		}
	}
	scope:jaehaerys = {
		if = {
			limit = { has_character_flag = divorce_is_instant }
			add_character_flag = instant_divorce
			remove_character_flag = divorce_is_instant
		}
	}

	if = {
		limit = {
			scope:jaehaerys = { has_character_flag = instant_divorce }
		}
		scope:jaehaerys = { trigger_event = agot_laughing_storm_rebellion.0011 }
	}
	else_if = {
		limit = {
			scope:daeron = { has_character_flag = instant_divorce }
			scope:jaehaerys = { NOT = { has_character_flag = instant_divorce } }
		}
		scope:daeron = { trigger_event = agot_laughing_storm_rebellion.0012 }
	}
	else = {
		scope:lyonel = {
			trigger_event = {
				id = agot_laughing_storm_rebellion.0024
				days = 5
			}
		}
	}
}

agot_laughing_storm_flag_remove_effect = {
	scope:garlan = {
		if = {
			limit = { has_character_flag = rebellion_in_the_making }
			remove_character_flag = rebellion_in_the_making
		}
		if = {
			limit = { has_character_flag = ally }
			remove_character_flag = ally
		}
	}
	scope:steffon = {
		if = {
			limit = { has_character_flag = rebellion_in_the_making }
			remove_character_flag = rebellion_in_the_making
		}
		if = {
			limit = { has_character_flag = ally }
			remove_character_flag = ally
		}
	}
	scope:runceford = {
		if = {
			limit = { has_character_flag = rebellion_in_the_making }
			remove_character_flag = rebellion_in_the_making
		}
		if = {
			limit = { has_character_flag = ally }
			remove_character_flag = ally
		}
	}
	scope:jaehaerys = {
		if = {
			limit = { has_character_flag = instant_divorce }
			remove_character_flag = instant_divorce
		}
		if = {
			limit = { has_character_flag = no_divorce }
			remove_character_flag = no_divorce
		}
	}
	scope:daeron = {
		if = {
			limit = { has_character_flag = instant_divorce }
			remove_character_flag = instant_divorce
		}
		if = {
			limit = { has_character_flag = no_divorce }
			remove_character_flag = no_divorce
		}
	}
	scope:shaera = {
		if = {
			limit = { has_character_flag = instant_divorce }
			remove_character_flag = instant_divorce
		}
		if = {
			limit = { has_character_flag = no_divorce }
			remove_character_flag = no_divorce
		}
	}
}