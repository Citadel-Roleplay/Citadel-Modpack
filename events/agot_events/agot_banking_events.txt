namespace = agot_banking

##########################################
# Banking system by Ronko
##########################################

agot_banking.1001 = { # Select a bank
	type = character_event
	title = agot_banking.1001.t
	desc = agot_banking.1001.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = personality_greedy
	}

	trigger = {
		is_incapable = no
	}

	immediate = {
		every_in_global_list = {
			variable = IB_Shareholder
			limit = {
				has_character_flag = IB_Director
			}
			save_scope_as = director_IB
		}

		every_in_global_list = {
			variable = bank1_Shareholder
			limit = {
				has_character_flag = bank1_Director
			}
			save_scope_as = director_bank1
		}

		every_in_global_list = {
			variable = bank2_Shareholder
			limit = {
				has_character_flag = bank2_Director
			}
			save_scope_as = director_bank2
		}

		every_in_global_list = {
			variable = bank3_Shareholder
			limit = {
				has_character_flag = bank3_Director
			}
			save_scope_as = director_bank3
		}
	}

	option = {	# The Iron Bank of Braavos
		name = agot_banking.1001.a

		if = {
			limit = {
				global_var:IB_InterestLevel = -1
			}
			custom_tooltip = agot_banking.1001.low_interest
		}
		else_if = {
			limit = {
				global_var:IB_InterestLevel = 1
			}
			custom_tooltip = agot_banking.1001.high_interest
		}
		else = {
			custom_tooltip = agot_banking.1001.medium_interest
		}

		trigger = {
			any_in_global_list = {
				variable = IB_Shareholder
				has_character_flag = IB_Director
			}
			global_var:IB_FreeCapital > min_cash_reserve_IB
		}

		add_character_flag = IB_debtor

		trigger_event = {
			id = agot_banking.0001
			months = 1
		}

		ai_chance = {
			base = 1
			modifier = {
				add = {
					value = global_var:IB_BankValue
					divide = 1000
				}
			}
			modifier = {
				add = scope:director_IB.diplomacy
			}
			modifier = {
				global_var:IB_InterestLevel = -1
				factor = 2
			}
			modifier = {
				global_var:IB_InterestLevel = 1
				factor = 0.5
			}
		}
	}

	option = {	# Custom bank 1
		name = agot_banking.1001.b

		if = {
			limit = {
				global_var:bank1_InterestLevel = -1
			}
			custom_tooltip = agot_banking.1001.low_interest
		}
		else_if = {
			limit = {
				global_var:bank1_InterestLevel = 1
			}
			custom_tooltip = agot_banking.1001.high_interest
		}
		else = {
			custom_tooltip = agot_banking.1001.medium_interest
		}

		trigger = {
			any_in_global_list = {
				variable = bank1_Shareholder
				has_character_flag = bank1_Director
			}
			global_var:bank1_FreeCapital > min_cash_reserve_bank1
		}

		add_character_flag = bank1_debtor

		trigger_event = {
			id = agot_banking.0001
			months = 1
		}

		ai_chance = {
			base = 1
			modifier = {
				add = {
					value = global_var:bank1_BankValue
					divide = 1000
				}
			}
			modifier = {
				add = scope:director_bank1.diplomacy
			}
			modifier = {
				global_var:bank1_InterestLevel = -1
				factor = 2
			}
			modifier = {
				global_var:bank1_InterestLevel = 1
				factor = 0.5
			}
		}
	}

	option = {	# # Custom bank 2
		name = agot_banking.1001.c

		if = {
			limit = {
				global_var:bank2_InterestLevel = -1
			}
			custom_tooltip = agot_banking.1001.low_interest
		}
		else_if = {
			limit = {
				global_var:bank2_InterestLevel = 1
			}
			custom_tooltip = agot_banking.1001.high_interest
		}
		else = {
			custom_tooltip = agot_banking.1001.medium_interest
		}

		trigger = {
			any_in_global_list = {
				variable = bank2_Shareholder
				has_character_flag = bank2_Director
			}
			global_var:bank2_FreeCapital > min_cash_reserve_bank2
		}

		add_character_flag = bank2_debtor

		trigger_event = {
			id = agot_banking.0001
			months = 1
		}

		ai_chance = {
			base = 1
			modifier = {
				add = {
					value = global_var:bank2_BankValue
					divide = 1000
				}
			}
			modifier = {
				add = scope:director_bank2.diplomacy
			}
			modifier = {
				global_var:bank2_InterestLevel = -1
				factor = 2
			}
			modifier = {
				global_var:bank2_InterestLevel = 1
				factor = 0.5
			}
		}
	}

	option = {	# Custom bank 3
		name = agot_banking.1001.d

		if = {
			limit = {
				global_var:bank3_InterestLevel = -1
			}
			custom_tooltip = agot_banking.1001.low_interest
		}
		else_if = {
			limit = {
				global_var:bank3_InterestLevel = 1
			}
			custom_tooltip = agot_banking.1001.high_interest
		}
		else = {
			custom_tooltip = agot_banking.1001.medium_interest
		}

		trigger = {
			any_in_global_list = {
				variable = bank3_Shareholder
				has_character_flag = bank3_Director
			}
			global_var:bank3_FreeCapital > min_cash_reserve_bank3
		}

		add_character_flag = bank3_debtor

		trigger_event = {
			id = agot_banking.0001
			months = 1
		}

		ai_chance = {
			base = 1
			modifier = {
				add = {
					value = global_var:bank3_BankValue
					divide = 1000
				}
			}
			modifier = {
				add = scope:director_bank3.diplomacy
			}
			modifier = {
				global_var:bank3_InterestLevel = -1
				factor = 2
			}
			modifier = {
				global_var:bank3_InterestLevel = 1
				factor = 0.5
			}
		}
	}

	option = {	# I changed my mind
		name = agot_banking.1001.e
		remove_character_flag = loan_requested

		ai_chance = {
			base = 0
		}
	}
}

agot_banking.0001 = { # The envoys of the Bank are here. Decide on the main characteristics of your loan.
	type = character_event
	title = agot_banking.0001.t
	desc = agot_banking.0001.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = personality_greedy
	}

	trigger = {
		is_incapable = no
		is_alive = yes
		is_landed = yes
		is_human = yes
		NOR = {
			has_trait = kingsguard
			has_trait = nightswatch
			has_trait = dragon
			has_trait = devoted
		}
	}

	immediate = {
		set_variable = {
			name = credit_score
			value = 0
		}
		set_variable = {
			name = loaned_amount
			value = 0
		}
		set_variable = {
			name = loan_term
			value = 0
		}
		set_variable = {
			name = loan_interest_rate
			value = 0
		}
	}

	option = {	# I'd like a low amount long term loan.
		name = agot_banking.0001.a
		custom_tooltip = agot_banking.0001.a_tt
		add_character_flag = agot_loan_low_long
		agot_credit_score_effect = yes

		ai_chance = {
			base = 30
			modifier = {
				add = -10
				gold < -50
			}
			modifier = {
				add = -10
				age > 50
			}
			ai_value_modifier = {
				ai_greed = 0.1
			}
		}
	}

	option = {	# I'd like a low amount short term loan.
		name = agot_banking.0001.b
		custom_tooltip = agot_banking.0001.b_tt
		add_character_flag = agot_loan_low_short
		change_variable = {
			name = credit_score
			add = 1
		}
		agot_credit_score_effect = yes

		ai_chance = {
			base = 30
			modifier = {
				add = -10
				gold < -50
			}
		}
	}

	option = {	# I'd like a high amount long term loan.
		name = agot_banking.0001.c
		custom_tooltip = agot_banking.0001.c_tt
		add_character_flag = agot_loan_high_long
		change_variable = {
			name = credit_score
			add = 2
		}
		agot_credit_score_effect = yes

		ai_chance = {
			base = 20
			modifier = {
				add = 25
				gold < -50
			}
			modifier = {
				add = -10
				age > 50
			}
			ai_value_modifier = {
				ai_greed = -0.1
			}
		}
	}

	option = {	# I'd like a high amount short term loan.
		name = agot_banking.0001.d
		custom_tooltip = agot_banking.0001.d_tt
		add_character_flag = agot_loan_high_short
		change_variable = {
			name = credit_score
			add = 3
		}
		agot_credit_score_effect = yes

		ai_chance = {
			base = 20
			modifier = {
				add = 25
				gold < -50
			}
			ai_value_modifier = {
				ai_greed = -0.2
			}
		}
	}

	option = {	# I've thought it over and I don't think I'll be needing any loans anytime soon.
		name = agot_banking.0001.e
		custom_tooltip = agot_banking.0001.e_tt

		remove_character_flag = loan_requested
		remove_character_flag = agot_loan_high_long
		remove_character_flag = agot_loan_high_short
		remove_character_flag = agot_loan_low_long
		remove_character_flag = agot_loan_low_short
		remove_character_flag = IB_debtor
		remove_character_flag = bank1_debtor
		remove_character_flag = bank2_debtor
		remove_character_flag = bank3_debtor

		ai_chance = {
			base = 0
		}
	}
}

agot_banking.0002 = { # The bank refuses you
	type = character_event
	title = agot_banking.0002.t
	desc = agot_banking.0002.desc
	theme = stewardship
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = root
		animation = worry
	}

	option = {
		name = agot_banking.0002.a
		remove_character_flag = agot_loan_high_short
		remove_character_flag = agot_loan_high_long
		remove_character_flag = agot_loan_low_long
		remove_character_flag = agot_loan_low_short
		remove_character_flag = loan_requested
		remove_character_flag = IB_debtor
		remove_character_flag = bank1_debtor
		remove_character_flag = bank2_debtor
		remove_character_flag = bank3_debtor

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0003 = { # The bank makes an offer
	type = character_event
	title = agot_banking.0003.t
	desc = agot_banking.0003.desc
	theme = stewardship
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = root
		animation = personality_greedy
	}

	option = { #I refuse
		name = agot_banking.0003.a
		set_variable = {
			name = loaned_amount
			value = 0
		}
		set_variable = {
			name = loan_term
			value = 0
		}
		set_variable = {
			name = loan_interest_rate
			value = 0
		}
		remove_character_flag = loan_requested
		remove_character_flag = agot_loan_high_long
		remove_character_flag = agot_loan_high_short
		remove_character_flag = agot_loan_low_long
		remove_character_flag = agot_loan_low_short
		remove_character_flag = IB_debtor
		remove_character_flag = bank1_debtor
		remove_character_flag = bank2_debtor
		remove_character_flag = bank3_debtor

		ai_chance = {
			base = 0
		}
	}

	option = {	#I accept
		name = agot_banking.0003.b

		add_character_flag = has_a_loan_flag

		add_gold = var:loaned_amount

		save_scope_as = NewDebtor

		set_variable = {
			name = payable_interest
			value = var:loan_interest_rate
		}
		change_variable = {
			name = payable_interest
			divide = 100
		}
		change_variable = {
			name = payable_interest
			multiply = {
				value = var:loan_term
				multiply = var:loaned_amount
			}
		}

		set_variable = {
			name = total_repayment
			value = var:loaned_amount
		}
		change_variable = {
			name = total_repayment
			add = var:payable_interest
		}

		set_variable = {
			name = half_repayment
			value = var:total_repayment
		}
		change_variable = {
			name = half_repayment
			divide = 2
		}

		if = {
			limit = {
				has_character_flag = IB_debtor
			}
			change_global_variable = {
				name = IB_NofLoans
				add = 1
			}
			change_global_variable = {
				name = IB_FreeCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = IB_LoanedCapital
				add = var:loaned_amount
			}
			if = {
				limit = {
					var:loaned_amount >= 200

				}
				add_to_global_variable_list = {
					name = IB_Important_Debtors
					target = this
				}
				every_in_global_list = {
					variable = IB_Shareholder
					limit = {
						has_character_flag = IB_Director
					}
					save_scope_as = messaged_director
					play_sound_effect = "event:/SFX/Events/Themes/sfx_event_theme_type_stewardship"
					send_interface_message = {
						type = msg_bank_new_debtor
						title = agot_banking.0602.t
						desc = agot_banking.0602.desc
						right_icon = scope:NewDebtor
					}
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_debtor
			}
			change_global_variable = {
				name = bank1_NofLoans
				add = 1
			}
			change_global_variable = {
				name = bank1_FreeCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = bank1_LoanedCapital
				add = var:loaned_amount
			}
			if = {
				limit = {
					var:loaned_amount >= 200
				}
				add_to_global_variable_list = {
					name = bank1_Important_Debtors
					target = this
				}
				every_in_global_list = {
					variable = bank1_Shareholder
					limit = {
						has_character_flag = bank1_Director
					}
					save_scope_as = messaged_director
					play_sound_effect = "event:/SFX/Events/Themes/sfx_event_theme_type_stewardship"
					send_interface_message = {
						type = msg_bank_new_debtor
						title = agot_banking.0602.t
						desc = agot_banking.0602.desc
						right_icon = scope:NewDebtor
					}
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_debtor
			}
			change_global_variable = {
				name = bank2_NofLoans
				add = 1
			}
			change_global_variable = {
				name = bank2_FreeCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = bank2_LoanedCapital
				add = var:loaned_amount
			}
			if = {
				limit = {
					var:loaned_amount >= 200
				}
				add_to_global_variable_list = {
					name = bank2_Important_Debtors
					target = this
				}
				every_in_global_list = {
					variable = bank2_Shareholder
					limit = {
						has_character_flag = bank2_Director
					}
					save_scope_as = messaged_director
					play_sound_effect = "event:/SFX/Events/Themes/sfx_event_theme_type_stewardship"
					send_interface_message = {
						type = msg_bank_new_debtor
						title = agot_banking.0602.t
						desc = agot_banking.0602.desc
						right_icon = scope:NewDebtor
					}
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_debtor
			}
			change_global_variable = {
				name = bank3_NofLoans
				add = 1
			}
			change_global_variable = {
				name = bank3_FreeCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = bank3_LoanedCapital
				add = var:loaned_amount
			}
			if = {
				limit = {
					var:loaned_amount >= 200
				}
				add_to_global_variable_list = {
					name = bank3_Important_Debtors
					target = this
				}
				every_in_global_list = {
					variable = bank3_Shareholder
					limit = {
						has_character_flag = bank3_Director
					}
					save_scope_as = messaged_director
					play_sound_effect = "event:/SFX/Events/Themes/sfx_event_theme_type_stewardship"
					send_interface_message = {
						type = msg_bank_new_debtor
						title = agot_banking.0602.t
						desc = agot_banking.0602.desc
						right_icon = scope:NewDebtor
					}
				}
			}
		}

		remove_character_flag = loan_requested

		create_story = {
			type = story_agot_loan
		}

		ai_chance = {
			base = 100
		}
	}

	option = {	#Choose new conditions
		name = agot_banking.0003.c

		remove_character_flag = agot_loan_high_long
		remove_character_flag = agot_loan_high_short
		remove_character_flag = agot_loan_low_long
		remove_character_flag = agot_loan_low_short

		trigger_event = {
			id = agot_banking.0001
		}

		ai_chance = {
			base = 0
		}
	}
}

agot_banking.0004 = { # Your loan becomes due
	type = character_event
	title = agot_banking.0004.t
	desc = agot_banking.0004.desc
	theme = stewardship
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = root
		animation = worry
	}

	trigger = {
		has_character_flag = has_a_loan_flag
		OR = {
			AND = {
				has_character_flag = IB_debtor
				exists = global_var:IB_location
			}
			AND = {
				has_character_flag = bank1_debtor
				exists = global_var:bank1_location
			}
			AND = {
				has_character_flag = bank2_debtor
				exists = global_var:bank2_location
			}
			AND = {
				has_character_flag = bank3_debtor
				exists = global_var:bank3_location
			}
		}
	}

	option = {  #repay all
		name = agot_banking.0004.a
		custom_tooltip = agot_banking.0004.a_tt

		trigger = {
			gold >= var:total_repayment
		}

		remove_short_term_gold = var:total_repayment

		if = {
			limit = {
				has_character_flag = IB_debtor
			}
			change_global_variable = {
				name = IB_FreeCapital
				add = var:total_repayment
			}
			change_global_variable = {
				name = IB_LoanedCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = IB_BankValue
				add = var:payable_interest
			}
			change_global_variable = {
				name = IB_Earnings
				add = var:payable_interest
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_debtor
			}
			change_global_variable = {
				name = bank1_FreeCapital
				add = var:total_repayment
			}
			change_global_variable = {
				name = bank1_LoanedCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = bank1_BankValue
				add = var:payable_interest
			}
			change_global_variable = {
				name = bank1_Earnings
				add = var:payable_interest
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_debtor
			}
			change_global_variable = {
				name = bank2_FreeCapital
				add = var:total_repayment
			}
			change_global_variable = {
				name = bank2_LoanedCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = bank2_BankValue
				add = var:payable_interest
			}
			change_global_variable = {
				name = bank2_Earnings
				add = var:payable_interest
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_debtor
			}
			change_global_variable = {
				name = bank3_FreeCapital
				add = var:total_repayment
			}
			change_global_variable = {
				name = bank3_LoanedCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = bank3_BankValue
				add = var:payable_interest
			}
			change_global_variable = {
				name = bank3_Earnings
				add = var:payable_interest
			}
		}

		remove_list_global_variable = {
			name = IB_Important_Debtors
			target = this
		}
		remove_list_global_variable = {
			name = bank1_Important_Debtors
			target = this
		}
		remove_list_global_variable = {
			name = bank2_Important_Debtors
			target = this
		}
		remove_list_global_variable = {
			name = bank3_Important_Debtors
			target = this
		}
		set_variable = {
			name = total_repayment
			value = 0
		}
		set_variable = {
			name = half_repayment
			value = 0
		}
		set_variable = {
			name = payable_interest
			value = 0
		}
		set_variable = {
			name = loaned_amount
			value = 0
		}
		set_variable = {
			name = loan_interest_rate
			value = 0
		}
		set_variable = {
			name = loan_term
			value = 0
		}

		random_owned_story = {
			limit = {
				story_type = story_agot_loan
			}
			end_story = yes
		}


		remove_character_flag = has_a_loan_flag
		remove_character_flag = agot_loan_high_long
		remove_character_flag = agot_loan_high_short
		remove_character_flag = agot_loan_low_long
		remove_character_flag = agot_loan_low_short
		remove_character_flag = IB_debtor
		remove_character_flag = bank1_debtor
		remove_character_flag = bank2_debtor
		remove_character_flag = bank3_debtor

		ai_chance = {
			base = 200
			ai_value_modifier = {
				ai_greed = -0.5
				ai_rationality = 0.5
			}
		}
	}

	option = {  #pay only interest
		name = agot_banking.0004.b
		custom_tooltip = agot_banking.0004.b_tt

		trigger = {
			gold >= var:payable_interest
		}

		remove_short_term_gold = var:payable_interest

		if = {
			limit = {
				has_character_flag = IB_debtor
			}
			change_global_variable = {
				name = IB_FreeCapital
				add = var:payable_interest
			}
			change_global_variable = {
				name = IB_BankValue
				add = var:payable_interest
			}
			change_global_variable = {
				name = IB_Earnings
				add = var:payable_interest
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_debtor
			}
			change_global_variable = {
				name = bank1_FreeCapital
				add = var:payable_interest
			}
			change_global_variable = {
				name = bank1_BankValue
				add = var:payable_interest
			}
			change_global_variable = {
				name = bank1_Earnings
				add = var:payable_interest
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_debtor
			}
			change_global_variable = {
				name = bank2_FreeCapital
				add = var:payable_interest
			}
			change_global_variable = {
				name = bank2_BankValue
				add = var:payable_interest
			}
			change_global_variable = {
				name = bank2_Earnings
				add = var:payable_interest
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_debtor
			}
			change_global_variable = {
				name = bank3_FreeCapital
				add = var:payable_interest
			}
			change_global_variable = {
				name = bank3_BankValue
				add = var:payable_interest
			}
			change_global_variable = {
				name = bank3_Earnings
				add = var:payable_interest
			}
		}

		set_variable = {  #needs to be recalculated in case of a former default (option c)
			name = payable_interest
			value = var:loan_interest_rate
		}
		change_variable = {
			name = payable_interest
			divide = 100
		}
		change_variable = {
			name = payable_interest
			multiply = {
				value = var:loan_term
				multiply = var:loaned_amount
			}
		}
		set_variable = {
			name = total_repayment
			value = var:loaned_amount
		}
		change_variable = {
			name = total_repayment
			add = var:payable_interest
		}

		set_variable = {
			name = half_repayment
			value = var:total_repayment
		}
		change_variable = {
			name = half_repayment
			divide = 2
		}

		random_owned_story = {
			limit = {
				story_type = story_agot_loan
			}
			end_story = yes
		}

		create_story = {
			type = story_agot_loan
		}

		ai_chance = {
			base = 150
			#ai_value_modifier = {
			#	ai_greed = 0.25
			#	ai_rationality = -0.1
			#}
		}
	}

	option = {  #I cannot repay you yet. Please give me more time
		name = agot_banking.0004.c
		custom_tooltip = agot_banking.0004.c_tt

		trigger = {
			NOT = {
				has_character_flag = defaulted_on_loan
			}
		}

		add_character_flag = defaulted_on_loan

		set_variable = {
			name = loan_term
			value = 5
		}

		#change_variable = {
		#	name = loan_interest_rate
		#	add = 2
		#}

		change_variable = {
			name = payable_interest
			add = {
				value = 5
				multiply = var:loan_interest_rate
				divide = 100
				multiply = var:loaned_amount
			}
		}
		change_variable = {
			name = total_repayment
			add = {
				value = 5
				multiply = var:loan_interest_rate
				divide = 100
				multiply = var:loaned_amount
			}
		}

		set_variable = {
			name = half_repayment
			value = var:total_repayment
		}
		change_variable = {
			name = half_repayment
			divide = 2
		}

		random_owned_story = {
			limit = {
				story_type = story_agot_loan
			}
			end_story = yes
		}

		create_story = {
			type = story_agot_loan
		}

		ai_chance = {
			base = 11
			ai_value_modifier = {
				ai_greed = 0.05
				ai_rationality = -0.05
			}
			modifier = {
				gold < var:payable_interest
				add = 100
			}
		}
	}

	option = {  #I owe you nothing, out of my sight! All variables and flags stay as is to be inherited.
		name = agot_banking.0004.d
		custom_tooltip = agot_banking.0004.d_tt

		add_character_flag = defaulted_on_loan
		add_character_flag = final_default

		# inform director about final default
		save_scope_as = FinalDefaulter

		random_owned_story = {
			limit = {
				story_type = story_agot_loan
			}
			end_story = yes
		}

		if = {
			limit = {
				has_character_flag = IB_debtor
			}
			change_global_variable = {
				name = IB_NofDefaults
				add = 1
			}

			change_global_variable = {
				name = IB_LostLoans
				add = var:loaned_amount
			}
			change_global_variable = {
				name = IB_LoanedCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = IB_BankValue
				subtract = var:loaned_amount
			}

			every_in_global_list = {
				variable = IB_Shareholder
				limit = {
					has_character_flag = IB_Director
				}
				save_scope_as = director
				if = {
					limit = {
						OR = {
							is_incapable = yes
							has_character_flag = no_default_handling
						}
					}
					if = {
						limit = {
							any_in_global_list = {
								variable = IB_Shareholder
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = IB_Director }
								is_adult = yes
							}
						}
						random_in_global_list = {
							variable = IB_Shareholder

							limit = {
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = IB_Director }
								is_adult = yes
							}

							weight = {
								base = 100
								modifier = {
									has_trait = ambitious
									add = 50
								}
								modifier = {
									has_trait = diligent
									add = 50
								}
								modifier = {
									add = {
										value = var:IB_Shares
										multiply = 10
									}
								}
							}

							set_variable = {  # base amount for possible bonus payment
								name = recovered_amount
								value = scope:FinalDefaulter.var:total_repayment
							}

							add_character_flag = {
								flag = handling_default
								years = 1
							}
							save_scope_as = default_revisor
							trigger_event = {
								id =  agot_banking.0211   # initial action selection
							}
						}
					}
				}
				else = {
					trigger_event = {
						id = agot_banking.0210
					}
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_debtor
			}
			change_global_variable = {
				name = bank1_NofDefaults
				add = 1
			}

			change_global_variable = {
				name = bank1_LostLoans
				add = var:loaned_amount
			}
			change_global_variable = {
				name = bank1_LoanedCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = bank1_BankValue
				subtract = var:loaned_amount
			}

			every_in_global_list = {
				variable = bank1_Shareholder
				limit = {
					has_character_flag = bank1_Director
				}
				save_scope_as = director
				if = {
					limit = {
						OR = {
							is_incapable = yes
							has_character_flag = no_default_handling
						}
					}
					if = {
						limit = {
							any_in_global_list = {
								variable = bank1_Shareholder
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = bank1_Director }
								is_adult = yes
							}
						}
						random_in_global_list = {
							variable = bank1_Shareholder

							limit = {
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = bank1_Director }
								is_adult = yes
							}

							weight = {
								base = 100
								modifier = {
									has_trait = ambitious
									add = 50
								}
								modifier = {
									has_trait = diligent
									add = 50
								}
								modifier = {
									add = {
										value = var:bank1_Shares
										multiply = 10
									}
								}
							}

							set_variable = {  # base amount for possible bonus payment
								name = recovered_amount
								value = scope:FinalDefaulter.var:total_repayment
							}

							add_character_flag = {
								flag = handling_default
								years = 1
							}
							save_scope_as = default_revisor
							trigger_event = {
								id =  agot_banking.0211   # initial action selection
							}
						}
					}
				}
				else = {
					trigger_event = {
						id = agot_banking.0210
					}
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_debtor
			}
			change_global_variable = {
				name = bank2_NofDefaults
				add = 1
			}

			change_global_variable = {
				name = bank2_LostLoans
				add = var:loaned_amount
			}
			change_global_variable = {
				name = bank2_LoanedCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = bank2_BankValue
				subtract = var:loaned_amount
			}

			every_in_global_list = {
				variable = bank2_Shareholder
				limit = {
					has_character_flag = bank2_Director
				}
				save_scope_as = director
				if = {
					limit = {
						OR = {
							is_incapable = yes
							has_character_flag = no_default_handling
						}
					}
					if = {
						limit = {
							any_in_global_list = {
								variable = bank2_Shareholder
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = bank2_Director }
								is_adult = yes
							}
						}
						random_in_global_list = {
							variable = bank2_Shareholder

							limit = {
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = bank2_Director }
								is_adult = yes
							}

							weight = {
								base = 100
								modifier = {
									has_trait = ambitious
									add = 50
								}
								modifier = {
									has_trait = diligent
									add = 50
								}
								modifier = {
									add = {
										value = var:bank2_Shares
										multiply = 10
									}
								}
							}

							set_variable = {  # base amount for possible bonus payment
								name = recovered_amount
								value = scope:FinalDefaulter.var:total_repayment
							}

							add_character_flag = {
								flag = handling_default
								years = 1
							}
							save_scope_as = default_revisor
							trigger_event = {
								id =  agot_banking.0211   # initial action selection
							}
						}
					}
				}
				else = {
					trigger_event = {
						id = agot_banking.0210
					}
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_debtor
			}
			change_global_variable = {
				name = bank3_NofDefaults
				add = 1
			}

			change_global_variable = {
				name = bank3_LostLoans
				add = var:loaned_amount
			}
			change_global_variable = {
				name = bank3_LoanedCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = bank3_BankValue
				subtract = var:loaned_amount
			}

			every_in_global_list = {
				variable = bank3_Shareholder
				limit = {
					has_character_flag = bank3_Director
				}
				save_scope_as = director
				if = {
					limit = {
						OR = {
							is_incapable = yes
							has_character_flag = no_default_handling
						}
					}
					if = {
						limit = {
							any_in_global_list = {
								variable = bank3_Shareholder
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = bank3_Director }
								is_adult = yes
							}
						}
						random_in_global_list = {
							variable = bank3_Shareholder

							limit = {
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = bank3_Director }
								is_adult = yes
							}

							weight = {
								base = 100
								modifier = {
									has_trait = ambitious
									add = 50
								}
								modifier = {
									has_trait = diligent
									add = 50
								}
								modifier = {
									add = {
										value = var:bank3_Shares
										multiply = 10
									}
								}
							}

							set_variable = {  # base amount for possible bonus payment
								name = recovered_amount
								value = scope:FinalDefaulter.var:total_repayment
							}

							add_character_flag = {
								flag = handling_default
								years = 1
							}
							save_scope_as = default_revisor
							trigger_event = {
								id =  agot_banking.0211   # initial action selection
							}
						}
					}
				}
				else = {
					trigger_event = {
						id = agot_banking.0210
					}
				}
			}
		}

		ai_chance = {
			base = 5
			ai_value_modifier = {
				ai_greed = 0.02
				ai_rationality = -0.02
			}
		}
	}
}

agot_banking.0005 = { # Repay loan before duedate
	type = character_event
	title = agot_banking.0005.t
	desc = agot_banking.0005.desc
	theme = stewardship
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = root
		animation = personality_greedy
	}

	option = {  #repay all
		name = agot_banking.0005.a
		custom_tooltip = agot_banking.0005.a_tt

		trigger = {
			gold >= var:total_repayment
		}

		remove_short_term_gold = var:total_repayment

		if = {
			limit = {
				has_character_flag = IB_debtor
			}
			change_global_variable = {
				name = IB_FreeCapital
				add = var:total_repayment
			}
			change_global_variable = {
				name = IB_LoanedCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = IB_BankValue
				add = var:payable_interest
			}
			change_global_variable = {
				name = IB_Earnings
				add = var:payable_interest
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_debtor
			}
			change_global_variable = {
				name = bank1_FreeCapital
				add = var:total_repayment
			}
			change_global_variable = {
				name = bank1_LoanedCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = bank1_BankValue
				add = var:payable_interest
			}
			change_global_variable = {
				name = bank1_Earnings
				add = var:payable_interest
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_debtor
			}
			change_global_variable = {
				name = bank2_FreeCapital
				add = var:total_repayment
			}
			change_global_variable = {
				name = bank2_LoanedCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = bank2_BankValue
				add = var:payable_interest
			}
			change_global_variable = {
				name = bank2_Earnings
				add = var:payable_interest
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_debtor
			}
			change_global_variable = {
				name = bank3_FreeCapital
				add = var:total_repayment
			}
			change_global_variable = {
				name = bank3_LoanedCapital
				subtract = var:loaned_amount
			}
			change_global_variable = {
				name = bank3_BankValue
				add = var:payable_interest
			}
			change_global_variable = {
				name = bank3_Earnings
				add = var:payable_interest
			}
		}

		remove_list_global_variable = {
			name = IB_Important_Debtors
			target = this
		}
		remove_list_global_variable = {
			name = bank1_Important_Debtors
			target = this
		}
		remove_list_global_variable = {
			name = bank2_Important_Debtors
			target = this
		}
		remove_list_global_variable = {
			name = bank3_Important_Debtors
			target = this
		}
		set_variable = {
			name = total_repayment
			value = 0
		}
		set_variable = {
			name = half_repayment
			value = 0
		}
		set_variable = {
			name = payable_interest
			value = 0
		}
		set_variable = {
			name = loaned_amount
			value = 0
		}
		set_variable = {
			name = loan_interest_rate
			value = 0
		}
		set_variable = {
			name = loan_term
			value = 0
		}

		random_owned_story = {
			limit = {
				story_type = story_agot_loan
			}
			end_story = yes
		}

		remove_character_flag = has_a_loan_flag
		remove_character_flag = agot_loan_high_long
		remove_character_flag = agot_loan_high_short
		remove_character_flag = agot_loan_low_long
		remove_character_flag = agot_loan_low_short
		remove_character_flag = IB_debtor
		remove_character_flag = bank1_debtor
		remove_character_flag = bank2_debtor
		remove_character_flag = bank3_debtor

		ai_chance = {
			base = 150
			ai_value_modifier = {
				ai_greed = -0.25
				ai_rationality = 0.1
			}
		}
	}

	option = {  #pay half of the total amount
		name = agot_banking.0005.b
		custom_tooltip = agot_banking.0005.b_tt

		trigger = {
			gold >= var:half_repayment
		}

		remove_short_term_gold = var:half_repayment

		if = {
			limit = {
				has_character_flag = IB_debtor
			}
			change_global_variable = {
				name = IB_FreeCapital
				add = var:half_repayment
			}
			change_global_variable = {
				name = IB_LoanedCapital
				subtract = {
					value = var:loaned_amount
					divide = 2
				}
			}
			change_global_variable = {
				name = IB_BankValue
				add = {
					value = var:payable_interest
					divide = 2
				}
			}
			change_global_variable = {
				name = IB_Earnings
				add = {
					value = var:payable_interest
					divide = 2
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_debtor
			}
			change_global_variable = {
				name = bank1_FreeCapital
				add = var:half_repayment
			}
			change_global_variable = {
				name = bank1_LoanedCapital
				subtract = {
					value = var:loaned_amount
					divide = 2
				}
			}
			change_global_variable = {
				name = bank1_BankValue
				add = {
					value = var:payable_interest
					divide = 2
				}
			}
			change_global_variable = {
				name = bank1_Earnings
				add = {
					value = var:payable_interest
					divide = 2
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_debtor
			}
			change_global_variable = {
				name = bank2_FreeCapital
				add = var:half_repayment
			}
			change_global_variable = {
				name = bank2_LoanedCapital
				subtract = {
					value = var:loaned_amount
					divide = 2
				}
			}
			change_global_variable = {
				name = bank2_BankValue
				add = {
					value = var:payable_interest
					divide = 2
				}
			}
			change_global_variable = {
				name = bank2_Earnings
				add = {
					value = var:payable_interest
					divide = 2
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_debtor
			}
			change_global_variable = {
				name = bank3_FreeCapital
				add = var:half_repayment
			}
			change_global_variable = {
				name = bank3_LoanedCapital
				subtract = {
					value = var:loaned_amount
					divide = 2
				}
			}
			change_global_variable = {
				name = bank3_BankValue
				add = {
					value = var:payable_interest
					divide = 2
				}
			}
			change_global_variable = {
				name = bank3_Earnings
				add = {
					value = var:payable_interest
					divide = 2
				}
			}
		}

		change_variable = {
			name = total_repayment
			divide = 2
		}
		change_variable = {
			name = half_repayment
			divide = 2
		}
		change_variable = {
			name = payable_interest
			divide = 2
		}
		change_variable = {
			name = loaned_amount
			divide = 2
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = 0.25
				ai_rationality = -0.1
			}
		}
	}
	option = {  #pay 50
		name = agot_banking.0005.c
		custom_tooltip = agot_banking.0005.c_tt

		trigger = {
			AND = {
				var:half_repayment >= 50
				gold >= 50
			}
		}

		remove_short_term_gold = 50

		set_variable = {
			name = repay_ratio
			value = 50
		}
		change_variable = {
			name = repay_ratio
			divide = var:total_repayment
		}

		if = {
			limit = {
				has_character_flag = IB_debtor
			}
			change_global_variable = {
				name = IB_FreeCapital
				add = 50
			}
			change_global_variable = {
				name = IB_LoanedCapital
				subtract = {
					value = var:loaned_amount
					multiply = var:repay_ratio
				}
			}
			change_global_variable = {
				name = IB_BankValue
				add = {
					value = var:payable_interest
					multiply = var:repay_ratio
				}
			}
			change_global_variable = {
				name = IB_Earnings
				add = {
					value = var:payable_interest
					multiply = var:repay_ratio
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_debtor
			}
			change_global_variable = {
				name = bank1_FreeCapital
				add = 50
			}
			change_global_variable = {
				name = bank1_LoanedCapital
				subtract = {
					value = var:loaned_amount
					multiply = var:repay_ratio
				}
			}
			change_global_variable = {
				name = bank1_BankValue
				add = {
					value = var:payable_interest
					multiply = var:repay_ratio
				}
			}
			change_global_variable = {
				name = bank1_Earnings
				add = {
					value = var:payable_interest
					multiply = var:repay_ratio
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_debtor
			}
			change_global_variable = {
				name = bank2_FreeCapital
				add = 50
			}
			change_global_variable = {
				name = bank2_LoanedCapital
				subtract = {
					value = var:loaned_amount
					multiply = var:repay_ratio
				}
			}
			change_global_variable = {
				name = bank2_BankValue
				add = {
					value = var:payable_interest
					multiply = var:repay_ratio
				}
			}
			change_global_variable = {
				name = bank2_Earnings
				add = {
					value = var:payable_interest
					multiply = var:repay_ratio
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_debtor
			}
			change_global_variable = {
				name = bank3_FreeCapital
				add = 50
			}
			change_global_variable = {
				name = bank3_LoanedCapital
				subtract = {
					value = var:loaned_amount
					multiply = var:repay_ratio
				}
			}
			change_global_variable = {
				name = bank3_BankValue
				add = {
					value = var:payable_interest
					multiply = var:repay_ratio
				}
			}
			change_global_variable = {
				name = bank3_Earnings
				add = {
					value = var:payable_interest
					multiply = var:repay_ratio
				}
			}
		}

		change_variable = {
			name = total_repayment
			subtract = 50
		}
		change_variable = {
			name = half_repayment
			subtract = 25
		}
		change_variable = {
			name = payable_interest
			subtract = {
				value = var:payable_interest
				multiply = var:repay_ratio
			}
		}
		change_variable = {
			name = loaned_amount
			subtract = {
				value = var:loaned_amount
				multiply = var:repay_ratio
			}
		}

		ai_chance = {
			base = 50
			ai_value_modifier = {
				ai_greed = 0.25
				ai_rationality = -0.1
			}
		}
	}
	option = {
		name = agot_banking.0005.d
		ai_chance = {
			base = 0
		}
	}
}

agot_banking.0006 = { # You inherited another loan
	type = character_event
	title = agot_banking.0006.t
	desc = agot_banking.0006.desc
	theme = stewardship
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = root
		animation = worry
	}

	option = {
		name = agot_banking.0006.a
		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0007 = { # You inherited a loan
	type = character_event
	title = agot_banking.0007.t
	desc = agot_banking.0007.desc
	theme = stewardship
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = root
		animation = worry
	}

	option = {
		name = agot_banking.0007.a
		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0211 = { # defaulter handling
	type = character_event
	title = agot_banking.0211.t

	desc = {
		first_valid = {
			#triggered_desc = {
			#	trigger = {
			#		OR = {
			#			has_character_flag = attempted_raid
			#			has_character_flag = attempted_assassination
			#			has_character_flag = attempted_claim
			#			has_character_flag = attempted_letter
			#			has_character_flag = attempted_economy
			#		}
			#	}
			#	desc = agot_banking.0211.iteration_desc
			#}
			triggered_desc = {
				trigger = {
					has_character_flag = raid_failed
				}
				desc = agot_banking.0211.raid_failed_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = assassin_failed
				}
				desc = agot_banking.0211.assassin_failed_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = claim1_failed
				}
				desc = agot_banking.0211.claim1_failed_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = claim2_failed
				}
				desc = agot_banking.0211.claim2_failed_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = letter1_failed
				}
				desc = agot_banking.0211.letter1_failed_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = letter2_failed
				}
				desc = agot_banking.0211.letter2_failed_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = letter3_failed
				}
				desc = agot_banking.0211.letter3_failed_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = letter4_failed
				}
				desc = agot_banking.0211.letter4_failed_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = economy_failed
				}
				desc = agot_banking.0211.economy_failed_desc
			}
			triggered_desc = {
				trigger = {
					OR = {
						has_character_flag = IB_Director
						has_character_flag = bank1_Director
						has_character_flag = bank2_Director
						has_character_flag = bank3_Director
					}
				}
				desc = agot_banking.0211.director_desc
			}
			triggered_desc = {
				trigger = {
					AND = {
						NOT = { has_character_flag = IB_Director }
						NOT = { has_character_flag = bank1_Director }
						NOT = { has_character_flag = bank2_Director }
						NOT = { has_character_flag = bank3_Director }
					}
				}
				desc = agot_banking.0211.delegated_desc
			}
		}
	}

	theme = stewardship
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = worry
	}

	immediate = {
		set_variable = {
			name = HandledDefaulter
			value = scope:FinalDefaulter
		}

		set_variable = {
			name = RaiderCost
			value = 25
		}
		set_variable = {
			name = AssassinCost
			value = 75
		}
		set_variable = {
			name = ClaimCost
			value = 40
		}
		set_variable = {
			name = LetterCost
			value = 10
		}
		set_variable = {
			name = EconomyCost
			value = 50
		}
		if = {
			limit = { scope:FinalDefaulter.highest_held_title_tier > tier_county }
			change_variable = {
				name = RaiderCost
				multiply = {
					value = scope:FinalDefaulter.highest_held_title_tier
					subtract = 1
				}
			}
			change_variable = {
				name = AssassinCost
				multiply = {
					value = scope:FinalDefaulter.highest_held_title_tier
					subtract = 1
				}
			}
			change_variable = {
				name = ClaimCost
				multiply = {
					value = scope:FinalDefaulter.highest_held_title_tier
					subtract = 1
				}
			}
			change_variable = {
				name = LetterCost
				multiply = {
					value = scope:FinalDefaulter.highest_held_title_tier
					subtract = 1
				}
			}
			change_variable = {
				name = EconomyCost
				multiply = {
					value = scope:FinalDefaulter.highest_held_title_tier
					subtract = 1
				}
			}
		}
	}

	option = {  # send raiders
		name = agot_banking.0211.a
		custom_tooltip = agot_banking.0211.a_tt

		trigger = {
			NOT = { has_character_flag = attempted_raid }
			trigger_if = {
				limit = {
					has_variable = IB_Shares
					var:IB_Shares > 0
				}
				global_var:IB_FreeCapital >= var:RaiderCost
			}
			trigger_if = {
				limit = {
					has_variable = bank1_Shares
					var:bank1_Shares > 0
				}
				global_var:bank1_FreeCapital >= var:RaiderCost
			}
			trigger_if = {
				limit = {
					has_variable = bank2_Shares
					var:bank2_Shares > 0
				}
				global_var:bank2_FreeCapital >= var:RaiderCost
			}
			trigger_if = {
				limit = {
					has_variable = bank3_Shares
					var:bank3_Shares > 0
				}
				global_var:bank3_FreeCapital >= var:RaiderCost
			}
			#scope:FinalDefaulter.var:total_repayment > var:RaiderCost
			scope:FinalDefaulter = {
				is_landed = yes
				capital_county ?= {
					is_coastal_county = yes
					development_level >= 6
				}
				NOR = {
					has_trait = kingsguard
					has_trait = nightswatch
					has_trait = dragon
					has_trait = devoted
				}
			}
		}

		if = {
			limit = {
				has_variable = IB_Shares
				var:IB_Shares > 0
			}
			change_global_variable = {
				name = IB_FreeCapital
				subtract = var:RaiderCost
			}
			change_global_variable = {
				name = IB_BankValue
				subtract = var:RaiderCost
			}
			change_global_variable = {
				name = IB_Expenses
				add = var:RaiderCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank1_Shares
				var:bank1_Shares > 0
			}
			change_global_variable = {
				name = bank1_FreeCapital
				subtract = var:RaiderCost
			}
			change_global_variable = {
				name = bank1_BankValue
				subtract = var:RaiderCost
			}
			change_global_variable = {
				name = bank1_Expenses
				add = var:RaiderCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank2_Shares
				var:bank2_Shares > 0
			}
			change_global_variable = {
				name = bank2_FreeCapital
				subtract = var:RaiderCost
			}
			change_global_variable = {
				name = bank2_BankValue
				subtract = var:RaiderCost
			}
			change_global_variable = {
				name = bank2_Expenses
				add = var:RaiderCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank3_Shares
				var:bank3_Shares > 0
			}
			change_global_variable = {
				name = bank3_FreeCapital
				subtract = var:RaiderCost
			}
			change_global_variable = {
				name = bank3_BankValue
				subtract = var:RaiderCost
			}
			change_global_variable = {
				name = bank3_Expenses
				add = var:RaiderCost
			}
		}

		change_variable = {  # base amount for possible bonus payment
			name = recovered_amount
			subtract = var:RaiderCost
		}

		random_list = {  #50:50 base chance with martial 10
			100 = {
				desc = agot_banking.0211.a.success
				modifier = {
					factor = {
						value = 1.9
						subtract = {
							value = scope:FinalDefaulter.martial
							multiply = 0.09
						}
						add = {  # revisors skill weights in. Skill value of 10 being neutral.
							value = 0.09
							multiply = {
								value = martial
								subtract = 10
							}
						}
					}
				}
				scope:FinalDefaulter = {
					trigger_event = {
						id = agot_banking.0102    # raiders successful
						months = 2
					}
				}
			}
			100 = {
				desc = agot_banking.0211.a.failure
				modifier = {
					factor = {
						value = 0.1
						add = {
							value = scope:FinalDefaulter.martial
							multiply = 0.09
						}
					}
				}
				scope:FinalDefaulter = {
					trigger_event = {
						id = agot_banking.0101    # raiders failed
						months = 2
					}
				}
			}
		}

		remove_character_flag = raid_failed
		remove_character_flag = assassin_failed
		remove_character_flag = claim1_failed
		remove_character_flag = claim2_failed
		remove_character_flag = letter1_failed
		remove_character_flag = letter2_failed
		remove_character_flag = letter3_failed
		remove_character_flag = letter4_failed
		remove_character_flag = economy_failed

		ai_chance = {
			base = 100
			modifier = {
				add = {
					value = martial
					multiply = 5
				}
			}
		}
	}

	option = {  # send assassin
		name = agot_banking.0211.b
		custom_tooltip = agot_banking.0211.b_tt

		trigger = {
			NOT = { has_character_flag = attempted_assassination }
			trigger_if = {
				limit = {
					has_variable = IB_Shares
					var:IB_Shares > 0
				}
				global_var:IB_FreeCapital >= var:AssassinCost
			}
			trigger_if = {
				limit = {
					has_variable = bank1_Shares
					var:bank1_Shares > 0
				}
				global_var:bank1_FreeCapital >= var:AssassinCost
			}
			trigger_if = {
				limit = {
					has_variable = bank2_Shares
					var:bank2_Shares > 0
				}
				global_var:bank2_FreeCapital >= var:AssassinCost
			}
			trigger_if = {
				limit = {
					has_variable = bank3_Shares
					var:bank3_Shares > 0
				}
				global_var:bank3_FreeCapital >= var:AssassinCost
			}
			#scope:FinalDefaulter.var:total_repayment > var:AssassinCost
			scope:FinalDefaulter = {
				#highest_held_title_tier <= tier_kingdom
				exists = player_heir
				NOR = {
					has_trait = kingsguard
					has_trait = nightswatch
					has_trait = dragon
					has_trait = devoted
				}
			}
		}

		if = {
			limit = {
				has_variable = IB_Shares
				var:IB_Shares > 0
			}
			change_global_variable = {
				name = IB_FreeCapital
				subtract = var:AssassinCost
			}
			change_global_variable = {
				name = IB_BankValue
				subtract = var:AssassinCost
			}
			change_global_variable = {
				name = IB_Expenses
				add = var:AssassinCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank1_Shares
				var:bank1_Shares > 0
			}
			change_global_variable = {
				name = bank1_FreeCapital
				subtract = var:AssassinCost
			}
			change_global_variable = {
				name = bank1_BankValue
				subtract = var:AssassinCost
			}
			change_global_variable = {
				name = bank1_Expenses
				add = var:AssassinCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank2_Shares
				var:bank2_Shares > 0
			}
			change_global_variable = {
				name = bank2_FreeCapital
				subtract = var:AssassinCost
			}
			change_global_variable = {
				name = bank2_BankValue
				subtract = var:AssassinCost
			}
			change_global_variable = {
				name = bank2_Expenses
				add = var:AssassinCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank3_Shares
				var:bank3_Shares > 0
			}
			change_global_variable = {
				name = bank3_FreeCapital
				subtract = var:AssassinCost
			}
			change_global_variable = {
				name = bank3_BankValue
				subtract = var:AssassinCost
			}
			change_global_variable = {
				name = bank3_Expenses
				add = var:AssassinCost
			}
		}

		change_variable = {  # base amount for possible bonus payment
			name = recovered_amount
			subtract = var:AssassinCost
		}

		random_list = {  #50:50 base chance with intrigue 15
			100 = {
				desc = agot_banking.0211.b.success
				modifier = {
					factor = {
						value = 1.9
						subtract = {
							value = scope:FinalDefaulter.intrigue
							multiply = 0.06
						}
						add = {  # revisors skill weights in. Skill value of 10 being neutral.
							value = 0.06
							multiply = {
								value = intrigue
								subtract = 10
							}
						}
					}
				}
				scope:FinalDefaulter = {
					trigger_event = {
						id = agot_banking.0104    # assassin successful
						months = 1
					}
				}
			}
			100 = {
				desc = agot_banking.0211.b.failure
				modifier = {
					factor = {
						value = 0.1
						add = {
							value = scope:FinalDefaulter.intrigue
							multiply = 0.06
						}
					}
				}
				modifier = {
					add = 50
					scope:FinalDefaulter = {
						highest_held_title_tier = tier_kingdom
					}
				}
				modifier = {
					add = 100
					scope:FinalDefaulter = {
						highest_held_title_tier = tier_empire
					}
				}
				scope:FinalDefaulter = {
					trigger_event = {
						id = agot_banking.0103    # assassin failed
						months = 1
					}
				}
			}
		}

		remove_character_flag = raid_failed
		remove_character_flag = assassin_failed
		remove_character_flag = claim1_failed
		remove_character_flag = claim2_failed
		remove_character_flag = letter1_failed
		remove_character_flag = letter2_failed
		remove_character_flag = letter3_failed
		remove_character_flag = letter4_failed
		remove_character_flag = economy_failed

		ai_chance = {
			base = 25
			modifier = {
				add = {
					value = intrigue
					multiply = 5
				}
			}
			modifier = {
				has_character_flag = raided_bank
				factor = 2
			}
		}
	}

	option = {  # sell claim
		name = agot_banking.0211.c
		custom_tooltip = agot_banking.0211.c_tt

		trigger = {
			NOT = { has_character_flag = attempted_claim }
			trigger_if = {
				limit = {
					has_variable = IB_Shares
					var:IB_Shares > 0
				}
				global_var:IB_FreeCapital >= var:ClaimCost
			}
			trigger_if = {
				limit = {
					has_variable = bank1_Shares
					var:bank1_Shares > 0
				}
				global_var:bank1_FreeCapital >= var:ClaimCost
			}
			trigger_if = {
				limit = {
					has_variable = bank2_Shares
					var:bank2_Shares > 0
				}
				global_var:bank2_FreeCapital >= var:ClaimCost
			}
			trigger_if = {
				limit = {
					has_variable = bank3_Shares
					var:bank3_Shares > 0
				}
				global_var:bank3_FreeCapital >= var:ClaimCost
			}
			#scope:FinalDefaulter.var:total_repayment > var:ClaimCost
			scope:FinalDefaulter.highest_held_title_tier >= tier_county
			scope:FinalDefaulter = {
				is_landed = yes
				NOT = { liege = scope:FinalDefaulter }
				NOR = {
					has_trait = kingsguard
					has_trait = nightswatch
					has_trait = dragon
					has_trait = devoted
				}
				highest_held_title_tier <= tier_kingdom
				liege ?= {
					any_vassal = {
						NOT = { this = scope:FinalDefaulter }
						gold >= scope:FinalDefaulter.var:total_repayment
						NOT = { has_claim_on = scope:FinalDefaulter.primary_title }
					}
				}
			}
		}

		if = {
			limit = {
				has_variable = IB_Shares
				var:IB_Shares > 0
			}
			change_global_variable = {
				name = IB_FreeCapital
				subtract = var:ClaimCost
			}
			change_global_variable = {
				name = IB_BankValue
				subtract = var:ClaimCost
			}
			change_global_variable = {
				name = IB_Expenses
				add = var:ClaimCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank1_Shares
				var:bank1_Shares > 0
			}
			change_global_variable = {
				name = bank1_FreeCapital
				subtract = var:ClaimCost
			}
			change_global_variable = {
				name = bank1_BankValue
				subtract = var:ClaimCost
			}
			change_global_variable = {
				name = bank1_Expenses
				add = var:ClaimCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank2_Shares
				var:bank2_Shares > 0
			}
			change_global_variable = {
				name = bank2_FreeCapital
				subtract = var:ClaimCost
			}
			change_global_variable = {
				name = bank2_BankValue
				subtract = var:ClaimCost
			}
			change_global_variable = {
				name = bank2_Expenses
				add = var:ClaimCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank3_Shares
				var:bank3_Shares > 0
			}
			change_global_variable = {
				name = bank3_FreeCapital
				subtract = var:ClaimCost
			}
			change_global_variable = {
				name = bank3_BankValue
				subtract = var:ClaimCost
			}
			change_global_variable = {
				name = bank3_Expenses
				add = var:ClaimCost
			}
		}

		change_variable = {  # base amount for possible bonus payment
			name = recovered_amount
			subtract = var:ClaimCost
		}

		random_list = {  #50:50 base chance with learning 20
			100 = {
				desc = agot_banking.0211.c.success
				modifier = {
					factor = {
						value = 1.9
						subtract = {
							value = scope:FinalDefaulter.learning
							multiply = 0.045
						}
						add = {  # revisors skill weights in. Skill value of 10 being neutral.
							value = 0.045
							multiply = {
								value = learning
								subtract = 10
							}
						}
					}
				}
				scope:FinalDefaulter = {
					liege = {
						random_vassal = {
							limit = {
								NOT = { this = scope:FinalDefaulter }
								gold >= scope:FinalDefaulter.var:total_repayment
								NOT = { has_claim_on = scope:FinalDefaulter.primary_title }
							}
							trigger_event = {
								id = agot_banking.0116    # claim selling successful
								months = 1
							}
						}
					}
				}
			}
			100 = {
				desc = agot_banking.0211.c.failure
				modifier = {
					factor = {
						value = 0.1
						add = {
							value = scope:FinalDefaulter.learning
							multiply = 0.045
						}
					}
				}
				scope:FinalDefaulter = {
					trigger_event = {
						id = agot_banking.0105    # claim selling failed
						months = 1
					}
				}
			}
		}

		remove_character_flag = raid_failed
		remove_character_flag = assassin_failed
		remove_character_flag = claim1_failed
		remove_character_flag = claim2_failed
		remove_character_flag = letter1_failed
		remove_character_flag = letter2_failed
		remove_character_flag = letter3_failed
		remove_character_flag = letter4_failed
		remove_character_flag = economy_failed

		ai_chance = {
			base = 200
			modifier = {
				add = {
					value = learning
					multiply = 5
				}
			}
		}
	}

	option = {  # send letter to liege
		name = agot_banking.0211.d
		custom_tooltip = agot_banking.0211.d_tt

		trigger = {
			NOT = { has_character_flag = attempted_letter }
			trigger_if = {
				limit = {
					has_variable = IB_Shares
					var:IB_Shares > 0
				}
				global_var:IB_FreeCapital >= var:LetterCost
			}
			trigger_if = {
				limit = {
					has_variable = bank1_Shares
					var:bank1_Shares > 0
				}
				global_var:bank1_FreeCapital >= var:LetterCost
			}
			trigger_if = {
				limit = {
					has_variable = bank2_Shares
					var:bank2_Shares > 0
				}
				global_var:bank2_FreeCapital >= var:LetterCost
			}
			trigger_if = {
				limit = {
					has_variable = bank3_Shares
					var:bank3_Shares > 0
				}
				global_var:bank3_FreeCapital >= var:LetterCost
			}
			#scope:FinalDefaulter.var:total_repayment > var:LetterCost
			scope:FinalDefaulter = {
				is_independent_ruler = no
				liege ?= {
					NOT = { this = scope:FinalDefaulter }
					NOT = { this = scope:default_revisor }
					is_adult = yes
					is_incapable = no
				}
				NOR = {
					has_trait = kingsguard
					has_trait = nightswatch
					has_trait = dragon
					has_trait = devoted
				}
			}
		}

		if = {
			limit = {
				has_variable = IB_Shares
				var:IB_Shares > 0
			}
			change_global_variable = {
				name = IB_FreeCapital
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = IB_BankValue
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = IB_Expenses
				add = var:LetterCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank1_Shares
				var:bank1_Shares > 0
			}
			change_global_variable = {
				name = bank1_FreeCapital
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = bank1_BankValue
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = bank1_Expenses
				add = var:LetterCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank2_Shares
				var:bank2_Shares > 0
			}
			change_global_variable = {
				name = bank2_FreeCapital
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = bank2_BankValue
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = bank2_Expenses
				add = var:LetterCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank3_Shares
				var:bank3_Shares > 0
			}
			change_global_variable = {
				name = bank3_FreeCapital
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = bank3_BankValue
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = bank3_Expenses
				add = var:LetterCost
			}
		}

		change_variable = {  # base amount for possible bonus payment
			name = recovered_amount
			subtract = var:LetterCost
		}

		random_list = {  #50:50 chance with diplomacy 20
			100 = {
				desc = agot_banking.0211.d.success
				modifier = {
					factor = {
						value = 1.9
						subtract = {
							value = scope:FinalDefaulter.diplomacy
							multiply = 0.045
						}
						add = {  # revisors skill weights in. Skill value of 10 being neutral.
							value = 0.045
							multiply = {
								value = diplomacy
								subtract = 10
							}
						}
					}
				}
				scope:FinalDefaulter = {
					liege = {
						save_scope_as = debtors_liege
						trigger_event = {
							id = agot_banking.0108    # liege reacts to letter
							months = 1
						}
					}
				}
			}
			100 = {
				desc = agot_banking.0211.d.failure
				modifier = {
					factor = {
						value = 0.1
						add = {
							value = scope:FinalDefaulter.diplomacy
							multiply = 0.045
						}
					}
				}
				scope:FinalDefaulter = {
					liege = {
						save_scope_as = debtors_liege
					}
					trigger_event = {
						id = agot_banking.0107    # liege letter failed
						months = 1
					}
				}
			}
		}

		remove_character_flag = raid_failed
		remove_character_flag = assassin_failed
		remove_character_flag = claim1_failed
		remove_character_flag = claim2_failed
		remove_character_flag = letter1_failed
		remove_character_flag = letter2_failed
		remove_character_flag = letter3_failed
		remove_character_flag = letter4_failed
		remove_character_flag = economy_failed

		ai_chance = {
			base = 300
			modifier = {
				add = {
					value = diplomacy
					multiply = 5
				}
			}
			modifier = {
				has_character_flag = raided_bank
				factor = 0.5
			}
		}
	}

	option = {  # economic collapse
		name = agot_banking.0211.e
		custom_tooltip = agot_banking.0211.e_tt

		trigger = {
			NOT = { has_character_flag = attempted_economy }
			trigger_if = {
				limit = {
					has_variable = IB_Shares
					var:IB_Shares > 0
				}
				global_var:IB_FreeCapital >= var:EconomyCost
			}
			trigger_if = {
				limit = {
					has_variable = bank1_Shares
					var:bank1_Shares > 0
				}
				global_var:bank1_FreeCapital >= var:EconomyCost
			}
			trigger_if = {
				limit = {
					has_variable = bank2_Shares
					var:bank2_Shares > 0
				}
				global_var:bank2_FreeCapital >= var:EconomyCost
			}
			trigger_if = {
				limit = {
					has_variable = bank3_Shares
					var:bank3_Shares > 0
				}
				global_var:bank3_FreeCapital >= var:EconomyCost
			}
			#scope:FinalDefaulter.var:total_repayment > var:EconomyCost
			scope:FinalDefaulter = {
				is_landed = yes
				NOR = {
					has_trait = kingsguard
					has_trait = nightswatch
					has_trait = dragon
					has_trait = devoted
				}
			}
		}

		if = {
			limit = {
				has_variable = IB_Shares
				var:IB_Shares > 0
			}
			change_global_variable = {
				name = IB_FreeCapital
				subtract = var:EconomyCost
			}
			change_global_variable = {
				name = IB_BankValue
				subtract = var:EconomyCost
			}
			change_global_variable = {
				name = IB_Expenses
				add = var:EconomyCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank1_Shares
				var:bank1_Shares > 0
			}
			change_global_variable = {
				name = bank1_FreeCapital
				subtract = var:EconomyCost
			}
			change_global_variable = {
				name = bank1_BankValue
				subtract = var:EconomyCost
			}
			change_global_variable = {
				name = bank1_Expenses
				add = var:EconomyCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank2_Shares
				var:bank2_Shares > 0
			}
			change_global_variable = {
				name = bank2_FreeCapital
				subtract = var:EconomyCost
			}
			change_global_variable = {
				name = bank2_BankValue
				subtract = var:EconomyCost
			}
			change_global_variable = {
				name = bank2_Expenses
				add = var:EconomyCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank3_Shares
				var:bank3_Shares > 0
			}
			change_global_variable = {
				name = bank3_FreeCapital
				subtract = var:EconomyCost
			}
			change_global_variable = {
				name = bank3_BankValue
				subtract = var:EconomyCost
			}
			change_global_variable = {
				name = bank3_Expenses
				add = var:EconomyCost
			}
		}

		change_variable = {  # base amount for possible bonus payment
			name = recovered_amount
			subtract = var:EconomyCost
		}

		random_list = {  #50:50 chance with stewardship 10
			100  = {
				desc = agot_banking.0211.e.success
				modifier = {
					factor = {
						value = 1.9
						subtract = {
							value = scope:FinalDefaulter.stewardship
							multiply = 0.09
						}
						add = {  # revisors skill weights in. Skill value of 10 being neutral.
							value = 0.09
							multiply = {
								value = stewardship
								subtract = 10
							}
						}
					}
				}
				scope:FinalDefaulter = {
					trigger_event = {
						id = agot_banking.0114    # economic collapse successful
						months = 6
					}
				}
			}
			100 = {
				desc = agot_banking.0211.e.failure
				modifier = {
					factor = {
						value = 0.1
						add = {
							value = scope:FinalDefaulter.stewardship
							multiply = 0.09
						}
					}
				}
				scope:FinalDefaulter = {
					trigger_event = {
						id = agot_banking.0113    # economic collapse failed
						months = 6
					}
				}
			}
		}

		remove_character_flag = raid_failed
		remove_character_flag = assassin_failed
		remove_character_flag = claim1_failed
		remove_character_flag = claim2_failed
		remove_character_flag = letter1_failed
		remove_character_flag = letter2_failed
		remove_character_flag = letter3_failed
		remove_character_flag = letter4_failed
		remove_character_flag = economy_failed

		ai_chance = {
			base = 100
			modifier = {
				add = {
					value = stewardship
					multiply = 5
				}
			}
		}
	}

	option = {  # negotiate with independent ruler
		name = agot_banking.0211.f
		custom_tooltip = agot_banking.0211.f_tt

		trigger = {
			NOT = { has_character_flag = attempted_letter }
			trigger_if = {
				limit = {
					has_variable = IB_Shares
					var:IB_Shares > 0
				}
				global_var:IB_FreeCapital >= var:LetterCost
			}
			trigger_if = {
				limit = {
					has_variable = bank1_Shares
					var:bank1_Shares > 0
				}
				global_var:bank1_FreeCapital >= var:LetterCost
			}
			trigger_if = {
				limit = {
					has_variable = bank2_Shares
					var:bank2_Shares > 0
				}
				global_var:bank2_FreeCapital >= var:LetterCost
			}
			trigger_if = {
				limit = {
					has_variable = bank3_Shares
					var:bank3_Shares > 0
				}
				global_var:bank3_FreeCapital >= var:LetterCost
			}
			#scope:FinalDefaulter.var:total_repayment > var:LetterCost
			scope:FinalDefaulter = {
				OR = {
					is_independent_ruler = yes
					liege = {
						OR = {
							is_adult = no
							is_incapable = yes
						}
					}
				}
				NOR = {
					has_trait = kingsguard
					has_trait = nightswatch
					has_trait = dragon
					has_trait = devoted
				}
			}
		}

		if = {
			limit = {
				has_variable = IB_Shares
				var:IB_Shares > 0
			}
			change_global_variable = {
				name = IB_FreeCapital
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = IB_BankValue
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = IB_Expenses
				add = var:LetterCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank1_Shares
				var:bank1_Shares > 0
			}
			change_global_variable = {
				name = bank1_FreeCapital
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = bank1_BankValue
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = bank1_Expenses
				add = var:LetterCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank2_Shares
				var:bank2_Shares > 0
			}
			change_global_variable = {
				name = bank2_FreeCapital
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = bank2_BankValue
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = bank2_Expenses
				add = var:LetterCost
			}
		}
		else_if = {
			limit = {
				has_variable = bank3_Shares
				var:bank3_Shares > 0
			}
			change_global_variable = {
				name = bank3_FreeCapital
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = bank3_BankValue
				subtract = var:LetterCost
			}
			change_global_variable = {
				name = bank3_Expenses
				add = var:LetterCost
			}
		}

		change_variable = {  # base amount for possible bonus payment
			name = recovered_amount
			subtract = var:LetterCost
		}

		scope:FinalDefaulter = {
			trigger_event = {
				id = agot_banking.1108    # debtor reacts to letter
				months = 1
			}
		}


		remove_character_flag = raid_failed
		remove_character_flag = assassin_failed
		remove_character_flag = claim1_failed
		remove_character_flag = claim2_failed
		remove_character_flag = letter1_failed
		remove_character_flag = letter2_failed
		remove_character_flag = letter3_failed
		remove_character_flag = letter4_failed
		remove_character_flag = economy_failed

		ai_chance = {
			base = 300
			modifier = {
				add = {
					value = diplomacy
					multiply = 5
				}
			}
		}
	}

	option = {  # do nothing
		name = agot_banking.0211.g
		custom_tooltip = agot_banking.0211.g_tt

		remove_character_flag = handling_default
		remove_character_flag = attempted_raid
		remove_character_flag = attempted_assassination
		remove_character_flag = attempted_claim
		remove_character_flag = attempted_letter
		remove_character_flag = attempted_economy

		remove_character_flag = raid_failed
		remove_character_flag = assassin_failed
		remove_character_flag = claim1_failed
		remove_character_flag = claim2_failed
		remove_character_flag = letter1_failed
		remove_character_flag = letter2_failed
		remove_character_flag = letter3_failed
		remove_character_flag = letter4_failed
		remove_character_flag = economy_failed

		ai_chance = {
			base = 0
		}
	}
}

agot_banking.0101 = { # raiders failed
	type = character_event
	title = agot_banking.0101.t
	desc = agot_banking.0101.desc
	theme = martial
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = war_over_win
	}

	option = {
		name = agot_banking.0101.a

		if = {
			limit = {
				is_alive = yes
			}
			# inform revisor about failed attempt
			scope:default_revisor = {
				add_character_flag = attempted_raid
				add_character_flag = raid_failed
				trigger_event = {
					id =  agot_banking.0211   # follow-up attempt
				}
			}
		}

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0102 = { # raiders successful
	type = character_event
	title = agot_banking.0102.t
	desc = agot_banking.0102.desc
	theme = martial
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = war_over_loss
	}

	option = {
		name = agot_banking.0102.a

		if = {
			limit = {
				is_alive = yes
			}
			# inform revisor about success
			scope:default_revisor = {
				add_character_flag = raid_success
				trigger_event = {
					id =  agot_banking.0212
				}
			}

			capital_county = {
				change_development_level = {
					value = 0
					subtract = 3
					#add = development_level
					#multiply = -0.5
				}
				change_county_control = -50
			}

			if = {
				limit = {
					has_character_flag = IB_debtor
				}
				change_global_variable = {
					name = IB_FreeCapital
					add = var:total_repayment
				}
				change_global_variable = {
					name = IB_BankValue
					add = var:total_repayment
				}

				if = {
					limit = {
						global_var:IB_LostLoans >= scope:FinalDefaulter.var:loaned_amount
					}
					change_global_variable = {
						name = IB_LostLoans
						subtract = scope:FinalDefaulter.var:loaned_amount
					}
				}
				else = {
					set_global_variable = {
						name = IB_LostLoans
						value = 0
					}
				}

				change_global_variable = {
					name = IB_Earnings
					add = var:payable_interest
				}
			}
			else_if = {
				limit = {
					has_character_flag = bank1_debtor
				}
				change_global_variable = {
					name = bank1_FreeCapital
					add = var:total_repayment
				}
				change_global_variable = {
					name = bank1_BankValue
					add = var:total_repayment
				}

				if = {
					limit = {
						global_var:bank1_LostLoans >= scope:FinalDefaulter.var:loaned_amount
					}
					change_global_variable = {
						name = bank1_LostLoans
						subtract = scope:FinalDefaulter.var:loaned_amount
					}
				}
				else = {
					set_global_variable = {
						name = bank1_LostLoans
						value = 0
					}
				}

				change_global_variable = {
					name = bank1_Earnings
					add = var:payable_interest
				}
			}
			else_if = {
				limit = {
					has_character_flag = bank2_debtor
				}
				change_global_variable = {
					name = bank2_FreeCapital
					add = var:total_repayment
				}
				change_global_variable = {
					name = bank2_BankValue
					add = var:total_repayment
				}

				if = {
					limit = {
						global_var:bank2_LostLoans >= scope:FinalDefaulter.var:loaned_amount
					}
					change_global_variable = {
						name = bank2_LostLoans
						subtract = scope:FinalDefaulter.var:loaned_amount
					}
				}
				else = {
					set_global_variable = {
						name = bank2_LostLoans
						value = 0
					}
				}

				change_global_variable = {
					name = bank2_Earnings
					add = var:payable_interest
				}
			}
			else_if = {
				limit = {
					has_character_flag = bank3_debtor
				}
				change_global_variable = {
					name = bank3_FreeCapital
					add = var:total_repayment
				}
				change_global_variable = {
					name = bank3_BankValue
					add = var:total_repayment
				}

				if = {
					limit = {
						global_var:bank3_LostLoans >= scope:FinalDefaulter.var:loaned_amount
					}
					change_global_variable = {
						name = bank3_LostLoans
						subtract = scope:FinalDefaulter.var:loaned_amount
					}
				}
				else = {
					set_global_variable = {
						name = bank3_LostLoans
						value = 0
					}
				}

				change_global_variable = {
					name = bank3_Earnings
					add = var:payable_interest
				}
			}

			remove_list_global_variable = {
				name = IB_Important_Debtors
				target = this
			}
			remove_list_global_variable = {
				name = bank1_Important_Debtors
				target = this
			}
			remove_list_global_variable = {
				name = bank2_Important_Debtors
				target = this
			}
			remove_list_global_variable = {
				name = bank3_Important_Debtors
				target = this
			}
			set_variable = {
				name = total_repayment
				value = 0
			}
			set_variable = {
				name = half_repayment
				value = 0
			}
			set_variable = {
				name = payable_interest
				value = 0
			}
			set_variable = {
				name = loaned_amount
				value = 0
			}
			set_variable = {
				name = loan_interest_rate
				value = 0
			}
			set_variable = {
				name = loan_term
				value = 0
			}

			remove_character_flag = has_a_loan_flag
			remove_character_flag = agot_loan_high_long
			remove_character_flag = agot_loan_high_short
			remove_character_flag = agot_loan_low_long
			remove_character_flag = agot_loan_low_short
			remove_character_flag = IB_debtor
			remove_character_flag = bank1_debtor
			remove_character_flag = bank2_debtor
			remove_character_flag = bank3_debtor
		}

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0103 = { # assassin failed
	type = character_event
	title = agot_banking.0103.t
	desc = agot_banking.0103.desc
	theme = intrigue
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = paranoia
	}

	option = {
		name = agot_banking.0103.a

		if = {
			limit = {
				is_alive = yes
			}
			# inform revisor about failed attempt
			scope:default_revisor = {
				add_character_flag = attempted_assassination
				add_character_flag = assassin_failed
				trigger_event = {
					id =  agot_banking.0211   # follow-up attempt
				}
			}
		}

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0104 = { # assassin successful
	type = character_event
	title = agot_banking.0104.t
	desc = agot_banking.0104.desc
	theme = intrigue
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = pain
	}

	immediate = {
		add_character_flag = assassinated  # prevents event triggered by "normal" defaulter death
	}

	option = {
		name = agot_banking.0104.a

		if = {
			limit = {
				is_alive = yes
			}

			# inform revisor about success
			scope:default_revisor = {
				add_character_flag = assassin_success
				trigger_event = {
					id =  agot_banking.0212
				}
			}

			death = { death_reason = death_murder }
		}

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0105 = { # sell claim failed
	type = character_event
	title = agot_banking.0105.t
	desc = agot_banking.0105.desc
	theme = learning
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = disapproval
	}

	option = {
		name = agot_banking.0105.a

		if = {
			limit = {
				is_alive = yes
			}
			# inform revisor about failed attempt
			scope:default_revisor = {
				add_character_flag = attempted_claim
				add_character_flag = claim1_failed
				trigger_event = {
					id =  agot_banking.0211   # follow-up attempt
				}
			}
		}

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0106 = { # sell claim successful
	type = character_event
	title = agot_banking.0106.t
	desc = agot_banking.0106.desc
	theme = learning
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = rage
	}

	option = {
		name = agot_banking.0106.a

		# inform revisor about success
		scope:default_revisor = {
			add_character_flag = claim_success
			trigger_event = {
				id =  agot_banking.0212
			}
		}

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0116 = { # sell claim, offer to vassal
	type = character_event
	title = agot_banking.0116.t
	desc = agot_banking.0116.desc
	theme = learning
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = personality_greedy
	}

	immediate = {
		save_scope_as = buyer
	}

	option = {  # agree
		name = agot_banking.0116.a

		trigger = {
			scope:FinalDefaulter = { is_alive = yes }
		}

		remove_short_term_gold = scope:FinalDefaulter.var:total_repayment
		add_pressed_claim = scope:FinalDefaulter.primary_title


		if = {
			limit = {
				scope:FinalDefaulter = {
					has_character_flag = IB_debtor
				}
			}
			change_global_variable = {
				name = IB_FreeCapital
				add = scope:FinalDefaulter.var:total_repayment
			}
			change_global_variable = {
				name = IB_BankValue
				add = scope:FinalDefaulter.var:total_repayment
			}

			if = {
				limit = {
					global_var:IB_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = IB_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = IB_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = IB_Earnings
				add = scope:FinalDefaulter.var:payable_interest
			}
		}
		else_if = {
			limit = {
				scope:FinalDefaulter = {
					has_character_flag = bank1_debtor
				}
			}
			change_global_variable = {
				name = bank1_FreeCapital
				add = scope:FinalDefaulter.var:total_repayment
			}
			change_global_variable = {
				name = bank1_BankValue
				add = scope:FinalDefaulter.var:total_repayment
			}

			if = {
				limit = {
					global_var:bank1_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = bank1_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = bank1_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = bank1_Earnings
				add = scope:FinalDefaulter.var:payable_interest
			}
		}
		else_if = {
			limit = {
				scope:FinalDefaulter = {
					has_character_flag = bank2_debtor
				}
			}
			change_global_variable = {
				name = bank2_FreeCapital
				add = scope:FinalDefaulter.var:total_repayment
			}
			change_global_variable = {
				name = bank2_BankValue
				add = scope:FinalDefaulter.var:total_repayment
			}

			if = {
				limit = {
					global_var:bank2_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = bank2_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = bank2_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = bank2_Earnings
				add = scope:FinalDefaulter.var:payable_interest
			}
		}
		else_if = {
			limit = {
				scope:FinalDefaulter = {
					has_character_flag = bank3_debtor
				}
			}
			change_global_variable = {
				name = bank3_FreeCapital
				add = scope:FinalDefaulter.var:total_repayment
			}
			change_global_variable = {
				name = bank3_BankValue
				add = scope:FinalDefaulter.var:total_repayment
			}

			if = {
				limit = {
					global_var:bank3_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = bank3_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = bank3_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = bank3_Earnings
				add = scope:FinalDefaulter.var:payable_interest
			}
		}


		scope:FinalDefaulter = {
			remove_list_global_variable = {
				name = IB_Important_Debtors
				target = this
			}
			remove_list_global_variable = {
				name = bank1_Important_Debtors
				target = this
			}
			remove_list_global_variable = {
				name = bank2_Important_Debtors
				target = this
			}
			remove_list_global_variable = {
				name = bank3_Important_Debtors
				target = this
			}
			set_variable = {
				name = total_repayment
				value = 0
			}
			set_variable = {
				name = half_repayment
				value = 0
			}
			set_variable = {
				name = payable_interest
				value = 0
			}
			set_variable = {
				name = loaned_amount
				value = 0
			}
			set_variable = {
				name = loan_interest_rate
				value = 0
			}
			set_variable = {
				name = loan_term
				value = 0
			}

			remove_character_flag = has_a_loan_flag
			remove_character_flag = agot_loan_high_long
			remove_character_flag = agot_loan_high_short
			remove_character_flag = agot_loan_low_long
			remove_character_flag = agot_loan_low_short
			remove_character_flag = IB_debtor
			remove_character_flag = bank1_debtor
			remove_character_flag = bank2_debtor
			remove_character_flag = bank3_debtor

			trigger_event = {  # inform FinalDefaulter
				id =  agot_banking.0106
			}
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = 1
				ai_honor = -0.5
				ai_energy = 0.5
				ai_compassion = -0.5
			}
		}
	}

	option = {  # disagree
		name = agot_banking.0116.b

		if = {
			limit = {
				scope:FinalDefaulter = { is_alive = yes }
			}
			# inform revisor about failed attempt
			scope:default_revisor = {
				add_character_flag = attempted_claim
				add_character_flag = claim2_failed
				trigger_event = {
					id =  agot_banking.0211   # follow-up attempt
				}
			}
		}

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0107 = { # liege letter failed
	type = character_event
	title = agot_banking.0107.t
	desc = agot_banking.0107.desc
	theme = diplomacy
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = disapproval
	}

	option = {
		name = agot_banking.0107.a

		if = {
			limit = {
				is_alive = yes
			}
			# inform revisor about failed attempt
			scope:default_revisor = {
				add_character_flag = attempted_letter
				add_character_flag = letter1_failed
				trigger_event = {
					id =  agot_banking.0211   # follow-up attempt
				}
			}
		}

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0108 = { # liege reacts to letter
	type = character_event
	title = agot_banking.0108.t
	desc = agot_banking.0108.desc
	theme = diplomacy
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = personality_greedy
	}

	option = {  # liege orders vassal to pay
		name = agot_banking.0108.a
		custom_tooltip = agot_banking.0108.a_tt

		trigger = {
			scope:FinalDefaulter = { is_alive = yes }
		}

		scope:FinalDefaulter = {
			add_opinion = {
				target = liege
				modifier = intrusive_liege_opinion
			}

			trigger_event = {
				id =  agot_banking.0109   # inform vassal
				days = 1
			}
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = 0.5
				ai_compassion = -1
			}
		}
	}

	option = {  # liege pays
		name = agot_banking.0108.b

		trigger = {
			scope:FinalDefaulter = { is_alive = yes }
		}

		# inform revisor about success
		scope:default_revisor = {
			add_character_flag = letter1_success
			trigger_event = {
				id =  agot_banking.0212
			}
		}

		remove_short_term_gold = scope:FinalDefaulter.var:total_repayment


		if = {
			limit = {
				scope:FinalDefaulter = {
					has_character_flag = IB_debtor
				}
			}
			change_global_variable = {
				name = IB_FreeCapital
				add = scope:FinalDefaulter.var:total_repayment
			}
			change_global_variable = {
				name = IB_BankValue
				add = scope:FinalDefaulter.var:total_repayment
			}

			if = {
				limit = {
					global_var:IB_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = IB_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = IB_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = IB_Earnings
				add = scope:FinalDefaulter.var:payable_interest
			}
		}
		else_if = {
			limit = {
				scope:FinalDefaulter = {
					has_character_flag = bank1_debtor
				}
			}
			change_global_variable = {
				name = bank1_FreeCapital
				add = scope:FinalDefaulter.var:total_repayment
			}
			change_global_variable = {
				name = bank1_BankValue
				add = scope:FinalDefaulter.var:total_repayment
			}

			if = {
				limit = {
					global_var:bank1_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = bank1_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = bank1_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = bank1_Earnings
				add = scope:FinalDefaulter.var:payable_interest
			}
		}
		else_if = {
			limit = {
				scope:FinalDefaulter = {
					has_character_flag = bank2_debtor
				}
			}
			change_global_variable = {
				name = bank2_FreeCapital
				add = scope:FinalDefaulter.var:total_repayment
			}
			change_global_variable = {
				name = bank2_BankValue
				add = scope:FinalDefaulter.var:total_repayment
			}

			if = {
				limit = {
					global_var:bank2_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = bank2_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = bank2_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = bank2_Earnings
				add = scope:FinalDefaulter.var:payable_interest
			}
		}
		else_if = {
			limit = {
				scope:FinalDefaulter = {
					has_character_flag = bank3_debtor
				}
			}
			change_global_variable = {
				name = bank3_FreeCapital
				add = scope:FinalDefaulter.var:total_repayment
			}
			change_global_variable = {
				name = bank3_BankValue
				add = scope:FinalDefaulter.var:total_repayment
			}

			if = {
				limit = {
					global_var:bank3_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = bank3_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = bank3_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = bank3_Earnings
				add = scope:FinalDefaulter.var:payable_interest
			}
		}

		add_hook = {
			type = favor_hook
			target = scope:FinalDefaulter
		}

		scope:FinalDefaulter = {
			remove_list_global_variable = {
				name = IB_Important_Debtors
				target = this
			}
			remove_list_global_variable = {
				name = bank1_Important_Debtors
				target = this
			}
			remove_list_global_variable = {
				name = bank2_Important_Debtors
				target = this
			}
			remove_list_global_variable = {
				name = bank3_Important_Debtors
				target = this
			}
			set_variable = {
				name = total_repayment
				value = 0
			}
			set_variable = {
				name = half_repayment
				value = 0
			}
			set_variable = {
				name = payable_interest
				value = 0
			}
			set_variable = {
				name = loaned_amount
				value = 0
			}
			set_variable = {
				name = loan_interest_rate
				value = 0
			}
			set_variable = {
				name = loan_term
				value = 0
			}

			remove_character_flag = has_a_loan_flag
			remove_character_flag = agot_loan_high_long
			remove_character_flag = agot_loan_high_short
			remove_character_flag = agot_loan_low_long
			remove_character_flag = agot_loan_low_short
			remove_character_flag = IB_debtor
			remove_character_flag = bank1_debtor
			remove_character_flag = bank2_debtor
			remove_character_flag = bank3_debtor

			trigger_event = {
				id =  agot_banking.0112   # inform vassal
				days = 1
			}
		}

		ai_chance = {
			base = 50
			ai_value_modifier = {
				ai_greed = -1
				ai_compassion = 1
			}
			modifier = {
				factor = 0
				gold < scope:FinalDefaulter.var:total_repayment
			}
		}
	}

	option = {  # liege refuses
		name = agot_banking.0108.c
		custom_tooltip = agot_banking.0108.c_tt

		if = {
			limit = {
				scope:FinalDefaulter = { is_alive = yes }
			}
			add_character_flag = bank_punishment

			# inform revisor about failed attempt
			scope:default_revisor = {
				add_character_flag = attempted_letter
				add_character_flag = letter2_failed
				trigger_event = {
					id =  agot_banking.0211   # follow-up attempt
				}
			}
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_boldness = 1
				ai_rationality = -1
			}
		}
	}
}

agot_banking.0109 = { # vassal reacts to order
	type = character_event
	title = agot_banking.0109.t
	desc = agot_banking.0109.desc
	theme = diplomacy
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = thinking
	}

	immediate = {
		set_variable = {
			name = loan_penalty_payment
			value = var:payable_interest
		}
		change_variable = {
			name = loan_penalty_payment
			multiply = 0.5
		}
	}

	option = {   # accept
		name = agot_banking.0109.a
		custom_tooltip = agot_banking.0109.a_tt

		liege = {
			trigger_event = {
				id =  agot_banking.0110   # inform liege
				days = 1
			}
		}

		# inform revisor about success
		scope:default_revisor = {
			add_character_flag = letter2_success
			trigger_event = {
				id =  agot_banking.0212
			}
		}


		if = {
			limit = {
				has_character_flag = IB_debtor
			}
			change_global_variable = {
				name = IB_LoanedCapital
				add = scope:FinalDefaulter.var:loaned_amount
			}
			change_global_variable = {
				name = IB_BankValue
				add = scope:FinalDefaulter.var:loaned_amount
			}

			if = {
				limit = {
					global_var:IB_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = IB_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = IB_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = IB_FreeCapital
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = IB_BankValue
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = IB_Earnings
				add = var:loan_penalty_payment
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_debtor
			}
			change_global_variable = {
				name = bank1_LoanedCapital
				add = scope:FinalDefaulter.var:loaned_amount
			}
			change_global_variable = {
				name = bank1_BankValue
				add = scope:FinalDefaulter.var:loaned_amount
			}

			if = {
				limit = {
					global_var:bank1_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = bank1_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = bank1_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = bank1_FreeCapital
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = bank1_BankValue
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = bank1_Earnings
				add = var:loan_penalty_payment
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_debtor
			}
			change_global_variable = {
				name = bank2_LoanedCapital
				add = scope:FinalDefaulter.var:loaned_amount
			}
			change_global_variable = {
				name = bank2_BankValue
				add = scope:FinalDefaulter.var:loaned_amount
			}

			if = {
				limit = {
					global_var:bank2_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = bank2_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = bank2_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = bank2_FreeCapital
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = bank2_BankValue
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = bank2_Earnings
				add = var:loan_penalty_payment
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_debtor
			}
			change_global_variable = {
				name = bank3_LoanedCapital
				add = scope:FinalDefaulter.var:loaned_amount
			}
			change_global_variable = {
				name = bank3_BankValue
				add = scope:FinalDefaulter.var:loaned_amount
			}

			if = {
				limit = {
					global_var:bank3_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = bank3_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = bank3_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = bank3_FreeCapital
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = bank3_BankValue
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = bank3_Earnings
				add = var:loan_penalty_payment
			}
		}


		remove_character_flag = final_default

		remove_short_term_gold = var:loan_penalty_payment

		set_variable = {
			name = loan_term
			value = 3
		}

		create_story = {
			type = story_agot_loan
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_boldness = -0.5
				ai_rationality = 1
			}
		}
	}

	option = {   # refuse
		name = agot_banking.0109.b
		custom_tooltip = agot_banking.0109.b_tt

		liege = {
			add_opinion = {
				target = scope:FinalDefaulter
				modifier = treachery_opinion
			}

			trigger_event = {
				id =  agot_banking.0111   # inform liege
				days = 1
			}
		}

		# inform revisor about failed attempt
		scope:default_revisor = {
			add_character_flag = attempted_letter
			add_character_flag = letter3_failed
			trigger_event = {
				id =  agot_banking.0211   # follow-up attempt
			}
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_boldness = 0.5
				ai_rationality = -1
			}
		}
	}
}

agot_banking.0110 = { # liege informed about vassals confirmation
	type = character_event
	title = agot_banking.0110.t
	desc = agot_banking.0110.desc
	theme = diplomacy
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = personality_bold
	}

	option = {
		name = agot_banking.0110.a

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0112 = { # vassal informed that liege paid
	type = character_event
	title = agot_banking.0112.t
	desc = agot_banking.0112.desc
	theme = diplomacy
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = thinking
	}

	option = {
		name = agot_banking.0112.a

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0111 = { # liege informed about vassals refusal
	type = character_event
	title = agot_banking.0111.t
	desc = agot_banking.0111.desc
	theme = diplomacy
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:debtors_liege
		animation = rage
	}

	option = {
		name = agot_banking.0111.a

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0113 = { # economic collapse failed
	type = character_event
	title = agot_banking.0113.t
	desc = agot_banking.0113.desc
	theme = stewardship
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = disapproval
	}

	option = {
		name = agot_banking.0113.a

		if = {
			limit = {
				is_alive = yes
			}
			# inform revisor about failed attempt
			scope:default_revisor = {
				add_character_flag = attempted_economy
				add_character_flag = economy_failed
				trigger_event = {
					id =  agot_banking.0211   # follow-up attempt
				}
			}
		}

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0114 = { # economic collapse successful
	type = character_event
	title = agot_banking.0114.t
	desc = agot_banking.0114.desc
	theme = stewardship
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = rage
	}

	option = {
		name = agot_banking.0114.a

		if = {
			limit = {
				is_alive = yes
			}
			# inform revisor about success
			scope:default_revisor = {
				add_character_flag = economy_success
				trigger_event = {
					id =  agot_banking.0212
				}
			}

			capital_county ?= {
				add_county_modifier = {
					modifier = economically_undermined_modifier
					years = 10
				}
			}


			if = {
				limit = {
					has_character_flag = IB_debtor
				}
				change_global_variable = {
					name = IB_FreeCapital
					add = scope:FinalDefaulter.var:total_repayment
				}
				change_global_variable = {
					name = IB_BankValue
					add = scope:FinalDefaulter.var:total_repayment
				}

				if = {
					limit = {
						global_var:IB_LostLoans >= scope:FinalDefaulter.var:loaned_amount
					}
					change_global_variable = {
						name = IB_LostLoans
						subtract = scope:FinalDefaulter.var:loaned_amount
					}
				}
				else = {
					set_global_variable = {
						name = IB_LostLoans
						value = 0
					}
				}

				change_global_variable = {
					name = IB_Earnings
					add = scope:FinalDefaulter.var:payable_interest
				}
			}
			else_if = {
				limit = {
					has_character_flag = bank1_debtor
				}
				change_global_variable = {
					name = bank1_FreeCapital
					add = scope:FinalDefaulter.var:total_repayment
				}
				change_global_variable = {
					name = bank1_BankValue
					add = scope:FinalDefaulter.var:total_repayment
				}

				if = {
					limit = {
						global_var:bank1_LostLoans >= scope:FinalDefaulter.var:loaned_amount
					}
					change_global_variable = {
						name = bank1_LostLoans
						subtract = scope:FinalDefaulter.var:loaned_amount
					}
				}
				else = {
					set_global_variable = {
						name = bank1_LostLoans
						value = 0
					}
				}

				change_global_variable = {
					name = bank1_Earnings
					add = scope:FinalDefaulter.var:payable_interest
				}
			}
			else_if = {
				limit = {
					has_character_flag = bank2_debtor
				}
				change_global_variable = {
					name = bank2_FreeCapital
					add = scope:FinalDefaulter.var:total_repayment
				}
				change_global_variable = {
					name = bank2_BankValue
					add = scope:FinalDefaulter.var:total_repayment
				}

				if = {
					limit = {
						global_var:bank2_LostLoans >= scope:FinalDefaulter.var:loaned_amount
					}
					change_global_variable = {
						name = bank2_LostLoans
						subtract = scope:FinalDefaulter.var:loaned_amount
					}
				}
				else = {
					set_global_variable = {
						name = bank2_LostLoans
						value = 0
					}
				}

				change_global_variable = {
					name = bank2_Earnings
					add = scope:FinalDefaulter.var:payable_interest
				}
			}
			else_if = {
				limit = {
					has_character_flag = bank3_debtor
				}
				change_global_variable = {
					name = bank3_FreeCapital
					add = scope:FinalDefaulter.var:total_repayment
				}
				change_global_variable = {
					name = bank3_BankValue
					add = scope:FinalDefaulter.var:total_repayment
				}

				if = {
					limit = {
						global_var:bank3_LostLoans >= scope:FinalDefaulter.var:loaned_amount
					}
					change_global_variable = {
						name = bank3_LostLoans
						subtract = scope:FinalDefaulter.var:loaned_amount
					}
				}
				else = {
					set_global_variable = {
						name = bank3_LostLoans
						value = 0
					}
				}

				change_global_variable = {
					name = bank3_Earnings
					add = scope:FinalDefaulter.var:payable_interest
				}
			}

			remove_list_global_variable = {
				name = IB_Important_Debtors
				target = this
			}
			remove_list_global_variable = {
				name = bank1_Important_Debtors
				target = this
			}
			remove_list_global_variable = {
				name = bank2_Important_Debtors
				target = this
			}
			remove_list_global_variable = {
				name = bank3_Important_Debtors
				target = this
			}
			set_variable = {
				name = total_repayment
				value = 0
			}
			set_variable = {
				name = half_repayment
				value = 0
			}
			set_variable = {
				name = payable_interest
				value = 0
			}
			set_variable = {
				name = loaned_amount
				value = 0
			}
			set_variable = {
				name = loan_interest_rate
				value = 0
			}
			set_variable = {
				name = loan_term
				value = 0
			}

			remove_character_flag = has_a_loan_flag
			remove_character_flag = agot_loan_high_long
			remove_character_flag = agot_loan_high_short
			remove_character_flag = agot_loan_low_long
			remove_character_flag = agot_loan_low_short
			remove_character_flag = IB_debtor
			remove_character_flag = bank1_debtor
			remove_character_flag = bank2_debtor
			remove_character_flag = bank3_debtor
		}

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0115 = { # defaulter died
	type = character_event
	title = agot_banking.0115.t
	desc = agot_banking.0115.desc
	theme = stewardship
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:DeadDefaulter
		animation = disapproval
	}

	trigger = {
		has_character_flag = handling_default
		var:HandledDefaulter = { scope:DeadDefaulter = this }
	}

	option = {
		name = agot_banking.0115.a

		remove_character_flag = handling_default
		remove_character_flag = attempted_raid
		remove_character_flag = attempted_assassination
		remove_character_flag = attempted_claim
		remove_character_flag = attempted_letter
		remove_character_flag = attempted_economy

		remove_character_flag = raid_success
		remove_character_flag = assassin_success
		remove_character_flag = claim_success
		remove_character_flag = letter1_success
		remove_character_flag = letter2_success
		remove_character_flag = economy_success

		set_variable = {
			name = recovered_amount
			value = 0
		}

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0201 = { # 5 year bookkeeping and dividend payout
	hidden = yes

	trigger = {
		OR = {
			has_character_flag = IB_Director
			has_character_flag = bank1_Director
			has_character_flag = bank2_Director
			has_character_flag = bank3_Director
		}
	}

	immediate = {
		save_scope_as = director

		if = {
			limit = {
				has_character_flag = IB_Director
			}
			# Calculate and subtract general running cost (1-3% of bank value per year = 5-15% per bookkeeping period)
			change_global_variable = {
				name = IB_Expenses
				add = { # 5-15% running cost for clerks, vault wardens etc.
					value = global_var:IB_BankValue
					multiply = {
						value = 0.15
						subtract = {
							value = 0.005
							multiply = scope:director.stewardship
						}
						min = 0.05
					}
				}
			}
			change_global_variable = {
				name = IB_FreeCapital
				subtract = {  # 5-15% running cost for clerks, vault wardens etc.. If the FreeCapital becomes negative after this, it means the bank is bankrupt (TODO)
					value = global_var:IB_BankValue
					multiply = {
						value = 0.15
						subtract = {
							value = 0.005
							multiply = scope:director.stewardship
						}
						min = 0.05
					}
				}
			}
			change_global_variable = {
				name = IB_BankValue
				multiply = {
					value = 0.85
					add = {
						value = 0.005
						multiply = scope:director.stewardship
					}
					max = 0.95
				}
			}

			# TODO: bankruptcy event
			#if = {
			#	limit = {
			#		global_var:IB_FreeCapital < 0
			#	}
			#	trigger_event = {
			#
			#	}
			#}


			# calculate value per share to check for stock split
			set_global_variable = {
				name = IB_ValuePerShare
				value = global_var:IB_BankValue
			}
			change_global_variable = {
				name = IB_ValuePerShare
				divide = global_var:IB_NofShares
			}

			# stock split: If the value per share becomes too high each share will be split into 2, reducing the buy in price for new investors to something between 100 and 200.
			if = {
				limit = {
					global_var:IB_ValuePerShare > 200
				}
				change_global_variable = {
					name = IB_NofShares
					multiply = 2
				}
				change_global_variable = {
					name = IB_ValuePerShare
					divide = 2
				}
				every_in_global_list = {
					variable = IB_Shareholder
					change_variable = {
						name = IB_Shares
						multiply = 2
					}
					trigger_event = {
						id =  agot_banking.0213
					}
				}
			}


			# profit calculation
			set_global_variable = {
				name = IB_Profit
				value = global_var:IB_Earnings
			}
			change_global_variable = {
				name = IB_Profit
				subtract = {
					value = global_var:IB_Expenses
					add = global_var:IB_LostLoans
				}
			}
			set_global_variable = {
				name = IB_ProfitPerShare
				value = global_var:IB_Profit
			}
			change_global_variable = {
				name = IB_ProfitPerShare
				divide = global_var:IB_NofShares
			}


			# calculate dividend per share
			if = {  # This case should never happen, but who knows...
				limit = {
					global_var:IB_FreeCapital < 0
				}
				set_global_variable = {
					name = IB_DividendPerShare
					value = 0
				}
			}
			else_if = {  # Less cash than profit. This calculation makes sure that a positive ratio of the available cash remains available for running expenses after dividends are paid. Depends on the DividendLevel.
				limit = {
					global_var:IB_FreeCapital < global_var:IB_Profit
				}
				set_global_variable = {
					name = IB_DividendPerShare
					value = global_var:IB_FreeCapital
				}
				change_global_variable = {
					name = IB_DividendPerShare
					divide = {
						value = global_var:IB_NofShares
						divide = global_var:IB_DividendLevel
					}
				}
			}
			else_if = {  # no profit = no dividend
				limit = {
					global_var:IB_Profit <= 0
				}
				set_global_variable = {
					name = IB_DividendPerShare
					value = 0
				}
			}
			else = {   # "normal" case
				set_global_variable = {
					name = IB_DividendPerShare
					value = global_var:IB_Profit
				}
				change_global_variable = {
					name = IB_DividendPerShare
					divide = {
						value = global_var:IB_NofShares
						divide = global_var:IB_DividendLevel
					}
				}
			}


			# remove dividend money from bank and reset bookkeeping values
			change_global_variable = {
				name = IB_FreeCapital
				subtract = {
					value = global_var:IB_DividendPerShare
					multiply = global_var:IB_NofShares
				}
			}
			change_global_variable = {
				name = IB_BankValue
				subtract = {
					value = global_var:IB_DividendPerShare
					multiply = global_var:IB_NofShares
				}
			}

			every_in_global_list = {  # inform shareholder about current numbers + pay out the dividend
				variable = IB_Shareholder

				# Transfer global variables to character in order to show them in the locs
				set_variable = {
					name = IB_FreeCapital
					value = global_var:IB_FreeCapital
				}
				set_variable = {
					name = IB_LoanedCapital
					value = global_var:IB_LoanedCapital
				}
				set_variable = {
					name = IB_InvestmentFund
					value = global_var:IB_InvestmentFund
				}
				set_variable = {
					name = IB_BankValue
					value = global_var:IB_BankValue
				}
				set_variable = {
					name = IB_NofShares
					value = global_var:IB_NofShares
				}
				set_variable = {
					name = IB_Earnings
					value = global_var:IB_Earnings
				}
				set_variable = {
					name = IB_Expenses
					value = global_var:IB_Expenses
				}
				set_variable = {
					name = IB_LostLoans
					value = global_var:IB_LostLoans
				}
				set_variable = {
					name = IB_Profit
					value = global_var:IB_Profit
				}
				set_variable = {
					name = IB_ProfitPerShare
					value = global_var:IB_ProfitPerShare
				}
				set_variable = {
					name = IB_DividendPerShare
					value = global_var:IB_DividendPerShare
				}

				trigger_event = {
					id =  agot_banking.0202
				}
			}

			#set_global_variable = {
			#	name = IB_Profit
			#	value = 0
			#}
			#set_global_variable = {
			#	name = IB_ProfitPerShare
			#	value = 0
			#}
			#set_global_variable = {
			#	name = IB_DividendPerShare
			#	value = 0
			#}
			set_global_variable = {
				name = IB_Earnings
				value = 0
			}
			set_global_variable = {
				name = IB_Expenses
				value = 0
			}
			set_global_variable = {
				name = IB_LostLoans
				value = 0
			}
		}

		else_if = {
			limit = {
				has_character_flag = bank1_Director
			}
			# Calculate and subtract general running cost (1-3% of bank value per year = 5-15% per bookkeeping period)
			change_global_variable = {
				name = bank1_Expenses
				add = {
					value = global_var:bank1_BankValue
					multiply = {
						value = 0.15
						subtract = {
							value = 0.005
							multiply = scope:director.stewardship
						}
						min = 0.05
					}
				}
			}
			change_global_variable = {
				name = bank1_FreeCapital
				subtract = {
					value = global_var:bank1_BankValue
					multiply = {
						value = 0.15
						subtract = {
							value = 0.005
							multiply = scope:director.stewardship
						}
						min = 0.05
					}
				}
			}
			change_global_variable = {
				name = bank1_BankValue
				multiply = {
					value = 0.85
					add = {
						value = 0.005
						multiply = scope:director.stewardship
					}
					max = 0.95
				}
			}

			# TODO: bankruptcy event
			#if = {
			#	limit = {
			#		global_var:bank1_FreeCapital < 0
			#	}
			#	trigger_event = {
			#
			#	}
			#}


			# calculate value per share to check for stock split
			set_global_variable = {
				name = bank1_ValuePerShare
				value = global_var:bank1_BankValue
			}
			change_global_variable = {
				name = bank1_ValuePerShare
				divide = global_var:bank1_NofShares
			}

			# stock split: If the value per share becomes too high each share will be split into 2, reducing the buy in price for new investors to something between 100 and 200.
			if = {
				limit = {
					global_var:bank1_ValuePerShare > 200
				}
				change_global_variable = {
					name = bank1_NofShares
					multiply = 2
				}
				change_global_variable = {
					name = bank1_ValuePerShare
					divide = 2
				}
				every_in_global_list = {
					variable = bank1_Shareholder
					change_variable = {
						name = bank1_Shares
						multiply = 2
					}
					trigger_event = {
						id =  agot_banking.0213
					}
				}
			}


			# profit calculation
			set_global_variable = {
				name = bank1_Profit
				value = global_var:bank1_Earnings
			}
			change_global_variable = {
				name = bank1_Profit
				subtract = {
					value = global_var:bank1_Expenses
					add = global_var:bank1_LostLoans
				}
			}
			set_global_variable = {
				name = bank1_ProfitPerShare
				value = global_var:bank1_Profit
			}
			change_global_variable = {
				name = bank1_ProfitPerShare
				divide = global_var:bank1_NofShares
			}


			# calculate dividend per share
			if = {  # This case should never happen, but who knows...
				limit = {
					global_var:bank1_FreeCapital < 0
				}
				set_global_variable = {
					name = bank1_DividendPerShare
					value = 0
				}
			}
			else_if = {  # Less cash than profit. This calculation makes sure that a positive ratio of the available cash remains available for running expenses after dividends are paid. Depends on the DividendLevel.
				limit = {
					global_var:bank1_FreeCapital < global_var:bank1_Profit
				}
				set_global_variable = {
					name = bank1_DividendPerShare
					value = global_var:bank1_FreeCapital
				}
				change_global_variable = {
					name = bank1_DividendPerShare
					divide = {
						value = global_var:bank1_NofShares
						divide = global_var:bank1_DividendLevel
					}
				}
			}
			else_if = {  # no profit = no dividend
				limit = {
					global_var:bank1_Profit <= 0
				}
				set_global_variable = {
					name = bank1_DividendPerShare
					value = 0
				}
			}
			else = {   # "normal" case
				set_global_variable = {
					name = bank1_DividendPerShare
					value = global_var:bank1_Profit
				}
				change_global_variable = {
					name = bank1_DividendPerShare
					divide = {
						value = global_var:bank1_NofShares
						divide = global_var:bank1_DividendLevel
					}
				}
			}


			# remove dividend money from bank and reset bookkeeping values
			change_global_variable = {
				name = bank1_FreeCapital
				subtract = {
					value = global_var:bank1_DividendPerShare
					multiply = global_var:bank1_NofShares
				}
			}
			change_global_variable = {
				name = bank1_BankValue
				subtract = {
					value = global_var:bank1_DividendPerShare
					multiply = global_var:bank1_NofShares
				}
			}

			every_in_global_list = {  # inform shareholder about current numbers + pay out the dividend
				variable = bank1_Shareholder

				# Transfer global variables to character in order to show them in the locs
				set_variable = {
					name = bank1_FreeCapital
					value = global_var:bank1_FreeCapital
				}
				set_variable = {
					name = bank1_LoanedCapital
					value = global_var:bank1_LoanedCapital
				}
				set_variable = {
					name = bank1_InvestmentFund
					value = global_var:bank1_InvestmentFund
				}
				set_variable = {
					name = bank1_BankValue
					value = global_var:bank1_BankValue
				}
				set_variable = {
					name = bank1_NofShares
					value = global_var:bank1_NofShares
				}
				set_variable = {
					name = bank1_Earnings
					value = global_var:bank1_Earnings
				}
				set_variable = {
					name = bank1_Expenses
					value = global_var:bank1_Expenses
				}
				set_variable = {
					name = bank1_LostLoans
					value = global_var:bank1_LostLoans
				}
				set_variable = {
					name = bank1_Profit
					value = global_var:bank1_Profit
				}
				set_variable = {
					name = bank1_ProfitPerShare
					value = global_var:bank1_ProfitPerShare
				}
				set_variable = {
					name = bank1_DividendPerShare
					value = global_var:bank1_DividendPerShare
				}

				trigger_event = {
					id =  agot_banking.0202
				}
			}

			#set_global_variable = {
			#	name = bank1_Profit
			#	value = 0
			#}
			#set_global_variable = {
			#	name = bank1_ProfitPerShare
			#	value = 0
			#}
			#set_global_variable = {
			#	name = bank1_DividendPerShare
			#	value = 0
			#}
			set_global_variable = {
				name = bank1_Earnings
				value = 0
			}
			set_global_variable = {
				name = bank1_Expenses
				value = 0
			}
			set_global_variable = {
				name = bank1_LostLoans
				value = 0
			}
		}

		else_if = {
			limit = {
				has_character_flag = bank2_Director
			}
			# Calculate and subtract general running cost (1-3% of bank value per year = 5-15% per bookkeeping period)
			change_global_variable = {
				name = bank2_Expenses
				add = {
					value = global_var:bank2_BankValue
					multiply = {
						value = 0.15
						subtract = {
							value = 0.005
							multiply = scope:director.stewardship
						}
						min = 0.05
					}
				}
			}
			change_global_variable = {
				name = bank2_FreeCapital
				subtract = {
					value = global_var:bank2_BankValue
					multiply = {
						value = 0.15
						subtract = {
							value = 0.005
							multiply = scope:director.stewardship
						}
						min = 0.05
					}
				}
			}
			change_global_variable = {
				name = bank2_BankValue
				multiply = {
					value = 0.85
					add = {
						value = 0.005
						multiply = scope:director.stewardship
					}
					max = 0.95
				}
			}

			# TODO: bankruptcy event
			#if = {
			#	limit = {
			#		global_var:bank2_FreeCapital < 0
			#	}
			#	trigger_event = {
			#
			#	}
			#}


			# calculate value per share to check for stock split
			set_global_variable = {
				name = bank2_ValuePerShare
				value = global_var:bank2_BankValue
			}
			change_global_variable = {
				name = bank2_ValuePerShare
				divide = global_var:bank2_NofShares
			}

			# stock split: If the value per share becomes too high each share will be split into 2, reducing the buy in price for new investors to something between 100 and 200.
			if = {
				limit = {
					global_var:bank2_ValuePerShare > 200
				}
				change_global_variable = {
					name = bank2_NofShares
					multiply = 2
				}
				change_global_variable = {
					name = bank2_ValuePerShare
					divide = 2
				}
				every_in_global_list = {
					variable = bank2_Shareholder
					change_variable = {
						name = bank2_Shares
						multiply = 2
					}
					trigger_event = {
						id =  agot_banking.0213
					}
				}
			}


			# profit calculation
			set_global_variable = {
				name = bank2_Profit
				value = global_var:bank2_Earnings
			}
			change_global_variable = {
				name = bank2_Profit
				subtract = {
					value = global_var:bank2_Expenses
					add = global_var:bank2_LostLoans
				}
			}
			set_global_variable = {
				name = bank2_ProfitPerShare
				value = global_var:bank2_Profit
			}
			change_global_variable = {
				name = bank2_ProfitPerShare
				divide = global_var:bank2_NofShares
			}


			# calculate dividend per share
			if = {  # This case should never happen, but who knows...
				limit = {
					global_var:bank2_FreeCapital < 0
				}
				set_global_variable = {
					name = bank2_DividendPerShare
					value = 0
				}
			}
			else_if = {  # Less cash than profit. This calculation makes sure that a positive ratio of the available cash remains available for running expenses after dividends are paid. Depends on the DividendLevel.
				limit = {
					global_var:bank2_FreeCapital < global_var:bank2_Profit
				}
				set_global_variable = {
					name = bank2_DividendPerShare
					value = global_var:bank2_FreeCapital
				}
				change_global_variable = {
					name = bank2_DividendPerShare
					divide = {
						value = global_var:bank2_NofShares
						divide = global_var:bank2_DividendLevel
					}
				}
			}
			else_if = {  # no profit = no dividend
				limit = {
					global_var:bank2_Profit <= 0
				}
				set_global_variable = {
					name = bank2_DividendPerShare
					value = 0
				}
			}
			else = {   # "normal" case
				set_global_variable = {
					name = bank2_DividendPerShare
					value = global_var:bank2_Profit
				}
				change_global_variable = {
					name = bank2_DividendPerShare
					divide = {
						value = global_var:bank2_NofShares
						divide = global_var:bank2_DividendLevel
					}
				}
			}


			# remove dividend money from bank and reset bookkeeping values
			change_global_variable = {
				name = bank2_FreeCapital
				subtract = {
					value = global_var:bank2_DividendPerShare
					multiply = global_var:bank2_NofShares
				}
			}
			change_global_variable = {
				name = bank2_BankValue
				subtract = {
					value = global_var:bank2_DividendPerShare
					multiply = global_var:bank2_NofShares
				}
			}

			every_in_global_list = {  # inform shareholder about current numbers + pay out the dividend
				variable = bank2_Shareholder

				# Transfer global variables to character in order to show them in the locs
				set_variable = {
					name = bank2_FreeCapital
					value = global_var:bank2_FreeCapital
				}
				set_variable = {
					name = bank2_LoanedCapital
					value = global_var:bank2_LoanedCapital
				}
				set_variable = {
					name = bank2_InvestmentFund
					value = global_var:bank2_InvestmentFund
				}
				set_variable = {
					name = bank2_BankValue
					value = global_var:bank2_BankValue
				}
				set_variable = {
					name = bank2_NofShares
					value = global_var:bank2_NofShares
				}
				set_variable = {
					name = bank2_Earnings
					value = global_var:bank2_Earnings
				}
				set_variable = {
					name = bank2_Expenses
					value = global_var:bank2_Expenses
				}
				set_variable = {
					name = bank2_LostLoans
					value = global_var:bank2_LostLoans
				}
				set_variable = {
					name = bank2_Profit
					value = global_var:bank2_Profit
				}
				set_variable = {
					name = bank2_ProfitPerShare
					value = global_var:bank2_ProfitPerShare
				}
				set_variable = {
					name = bank2_DividendPerShare
					value = global_var:bank2_DividendPerShare
				}

				trigger_event = {
					id =  agot_banking.0202
				}
			}

			#set_global_variable = {
			#	name = bank2_Profit
			#	value = 0
			#}
			#set_global_variable = {
			#	name = bank2_ProfitPerShare
			#	value = 0
			#}
			#set_global_variable = {
			#	name = bank2_DividendPerShare
			#	value = 0
			#}
			set_global_variable = {
				name = bank2_Earnings
				value = 0
			}
			set_global_variable = {
				name = bank2_Expenses
				value = 0
			}
			set_global_variable = {
				name = bank2_LostLoans
				value = 0
			}
		}

		else_if = {
			limit = {
				has_character_flag = bank3_Director
			}
			# Calculate and subtract general running cost (1-3% of bank value per year = 5-15% per bookkeeping period)
			change_global_variable = {
				name = bank3_Expenses
				add = {
					value = global_var:bank3_BankValue
					multiply = {
						value = 0.15
						subtract = {
							value = 0.005
							multiply = scope:director.stewardship
						}
						min = 0.05
					}
				}
			}
			change_global_variable = {
				name = bank3_FreeCapital
				subtract = {
					value = global_var:bank3_BankValue
					multiply = {
						value = 0.15
						subtract = {
							value = 0.005
							multiply = scope:director.stewardship
						}
						min = 0.05
					}
				}
			}
			change_global_variable = {
				name = bank3_BankValue
				multiply = {
					value = 0.85
					add = {
						value = 0.005
						multiply = scope:director.stewardship
					}
					max = 0.95
				}
			}

			# TODO: bankruptcy event
			#if = {
			#	limit = {
			#		global_var:bank3_FreeCapital < 0
			#	}
			#	trigger_event = {
			#
			#	}
			#}


			# calculate value per share to check for stock split
			set_global_variable = {
				name = bank3_ValuePerShare
				value = global_var:bank3_BankValue
			}
			change_global_variable = {
				name = bank3_ValuePerShare
				divide = global_var:bank3_NofShares
			}

			# stock split: If the value per share becomes too high each share will be split into 2, reducing the buy in price for new investors to something between 100 and 200.
			if = {
				limit = {
					global_var:bank3_ValuePerShare > 200
				}
				change_global_variable = {
					name = bank3_NofShares
					multiply = 2
				}
				change_global_variable = {
					name = bank3_ValuePerShare
					divide = 2
				}
				every_in_global_list = {
					variable = bank3_Shareholder
					change_variable = {
						name = bank3_Shares
						multiply = 2
					}
					trigger_event = {
						id =  agot_banking.0213
					}
				}
			}


			# profit calculation
			set_global_variable = {
				name = bank3_Profit
				value = global_var:bank3_Earnings
			}
			change_global_variable = {
				name = bank3_Profit
				subtract = {
					value = global_var:bank3_Expenses
					add = global_var:bank3_LostLoans
				}
			}
			set_global_variable = {
				name = bank3_ProfitPerShare
				value = global_var:bank3_Profit
			}
			change_global_variable = {
				name = bank3_ProfitPerShare
				divide = global_var:bank3_NofShares
			}


			# calculate dividend per share
			if = {  # This case should never happen, but who knows...
				limit = {
					global_var:bank3_FreeCapital < 0
				}
				set_global_variable = {
					name = bank3_DividendPerShare
					value = 0
				}
			}
			else_if = {  # Less cash than profit. This calculation makes sure that a positive ratio of the available cash remains available for running expenses after dividends are paid. Depends on the DividendLevel.
				limit = {
					global_var:bank3_FreeCapital < global_var:bank3_Profit
				}
				set_global_variable = {
					name = bank3_DividendPerShare
					value = global_var:bank3_FreeCapital
				}
				change_global_variable = {
					name = bank3_DividendPerShare
					divide = {
						value = global_var:bank3_NofShares
						divide = global_var:bank3_DividendLevel
					}
				}
			}
			else_if = {  # no profit = no dividend
				limit = {
					global_var:bank3_Profit <= 0
				}
				set_global_variable = {
					name = bank3_DividendPerShare
					value = 0
				}
			}
			else = {   # "normal" case
				set_global_variable = {
					name = bank3_DividendPerShare
					value = global_var:bank3_Profit
				}
				change_global_variable = {
					name = bank3_DividendPerShare
					divide = {
						value = global_var:bank3_NofShares
						divide = global_var:bank3_DividendLevel
					}
				}
			}


			# remove dividend money from bank and reset bookkeeping values
			change_global_variable = {
				name = bank3_FreeCapital
				subtract = {
					value = global_var:bank3_DividendPerShare
					multiply = global_var:bank3_NofShares
				}
			}
			change_global_variable = {
				name = bank3_BankValue
				subtract = {
					value = global_var:bank3_DividendPerShare
					multiply = global_var:bank3_NofShares
				}
			}

			every_in_global_list = {  # inform shareholder about current numbers + pay out the dividend
				variable = bank3_Shareholder

				# Transfer global variables to character in order to show them in the locs
				set_variable = {
					name = bank3_FreeCapital
					value = global_var:bank3_FreeCapital
				}
				set_variable = {
					name = bank3_LoanedCapital
					value = global_var:bank3_LoanedCapital
				}
				set_variable = {
					name = bank3_InvestmentFund
					value = global_var:bank3_InvestmentFund
				}
				set_variable = {
					name = bank3_BankValue
					value = global_var:bank3_BankValue
				}
				set_variable = {
					name = bank3_NofShares
					value = global_var:bank3_NofShares
				}
				set_variable = {
					name = bank3_Earnings
					value = global_var:bank3_Earnings
				}
				set_variable = {
					name = bank3_Expenses
					value = global_var:bank3_Expenses
				}
				set_variable = {
					name = bank3_LostLoans
					value = global_var:bank3_LostLoans
				}
				set_variable = {
					name = bank3_Profit
					value = global_var:bank3_Profit
				}
				set_variable = {
					name = bank3_ProfitPerShare
					value = global_var:bank3_ProfitPerShare
				}
				set_variable = {
					name = bank3_DividendPerShare
					value = global_var:bank3_DividendPerShare
				}

				trigger_event = {
					id =  agot_banking.0202
				}
			}

			#set_global_variable = {
			#	name = bank3_Profit
			#	value = 0
			#}
			#set_global_variable = {
			#	name = bank3_ProfitPerShare
			#	value = 0
			#}
			#set_global_variable = {
			#	name = bank3_DividendPerShare
			#	value = 0
			#}
			set_global_variable = {
				name = bank3_Earnings
				value = 0
			}
			set_global_variable = {
				name = bank3_Expenses
				value = 0
			}
			set_global_variable = {
				name = bank3_LostLoans
				value = 0
			}
		}
	}
}

agot_banking.0213 = {  # Shareholder informed about stock split
	type = character_event
	title = agot_banking.0213.t
	desc = agot_banking.0213.desc
	theme = stewardship
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:director
		animation = steward
	}

	option = {
		name = agot_banking.0213.a
		custom_tooltip = agot_banking.0213.a_tt

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0202 = {  # Shareholder informed about banks performance and dividend payout
	type = character_event
	title = agot_banking.0202.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					AND = {
						has_variable = IB_Shares
						var:IB_Shares > 0
					}
				}
				desc = agot_banking.0202.IB.desc
			}
			triggered_desc = {
				trigger = {
					AND = {
						has_variable = bank1_Shares
						var:bank1_Shares > 0
					}
				}
				desc = agot_banking.0202.bank1.desc
			}
			triggered_desc = {
				trigger = {
					AND = {
						has_variable = bank2_Shares
						var:bank2_Shares > 0
					}
				}
				desc = agot_banking.0202.bank2.desc
			}
			triggered_desc = {
				trigger = {
					AND = {
						has_variable = bank3_Shares
						var:bank3_Shares > 0
					}
				}
				desc = agot_banking.0202.bank3.desc
			}
		}
	}

	theme = stewardship
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:director
		animation = steward
	}

	option = {
		name = agot_banking.0202.a

		if = {
			limit = {
				has_variable = IB_Shares
				var:IB_Shares > 0
			}
			if = {
				limit = {
					var:IB_DividendPerShare > 0
				}
				add_gold = {
					value = var:IB_DividendPerShare
					multiply = var:IB_Shares
				}
			}

			if = {   # reward the director for good profits
				limit = {
					has_character_flag = IB_Director
				}
				if = {
					limit = {
						government_has_flag = government_is_administrative
					}
					change_influence = {
						value = var:IB_Profit
						multiply = 1000
						divide = var:IB_BankValue

						#Rounds up to the closest number divisible by 5
						divide = 5
						ceiling = yes
						multiply = 5
					}
				}
				else = {
					add_prestige = {
						value = var:IB_Profit
						multiply = 1000
						divide = var:IB_BankValue

						#Rounds up to the closest number divisible by 5
						divide = 5
						ceiling = yes
						multiply = 5
					}
				}
			}
		}
		else_if = {
			limit = {
				has_variable = bank1_Shares
				var:bank1_Shares > 0
			}
			if = {
				limit = {
					var:bank1_DividendPerShare > 0
				}
				add_gold = {
					value = var:bank1_DividendPerShare
					multiply = var:bank1_Shares
				}
			}

			if = {   # reward the director for good profits
				limit = {
					has_character_flag = bank1_Director
				}
				if = {
					limit = {
						government_has_flag = government_is_administrative
					}
					change_influence = {
						value = var:bank1_Profit
						multiply = 1000
						divide = var:bank1_BankValue

						#Rounds up to the closest number divisible by 5
						divide = 5
						ceiling = yes
						multiply = 5
					}
				}
				else = {
					add_prestige = {
						value = var:bank1_Profit
						multiply = 1000
						divide = var:bank1_BankValue

						#Rounds up to the closest number divisible by 5
						divide = 5
						ceiling = yes
						multiply = 5
					}
				}
			}
		}
		else_if = {
			limit = {
				has_variable = bank2_Shares
				var:bank2_Shares > 0
			}
			if = {
				limit = {
					var:bank2_DividendPerShare > 0
				}
				add_gold = {
					value = var:bank2_DividendPerShare
					multiply = var:bank2_Shares
				}
			}

			if = {   # reward the director for good profits
				limit = {
					has_character_flag = bank2_Director
				}
				if = {
					limit = {
						government_has_flag = government_is_administrative
					}
					change_influence = {
						value = var:bank2_Profit
						multiply = 1000
						divide = var:bank2_BankValue

						#Rounds up to the closest number divisible by 5
						divide = 5
						ceiling = yes
						multiply = 5
					}
				}
				else = {
					add_prestige = {
						value = var:bank2_Profit
						multiply = 1000
						divide = var:bank2_BankValue

						#Rounds up to the closest number divisible by 5
						divide = 5
						ceiling = yes
						multiply = 5
					}
				}
			}
		}
		else_if = {
			limit = {
				has_variable = bank3_Shares
				var:bank3_Shares > 0
			}
			if = {
				limit = {
					var:bank3_DividendPerShare > 0
				}
				add_gold = {
					value = var:bank3_DividendPerShare
					multiply = var:bank3_Shares
				}
			}

			if = {   # reward the director for good profits
				limit = {
					has_character_flag = bank3_Director
				}
				if = {
					limit = {
						government_has_flag = government_is_administrative
					}
					change_influence = {
						value = var:bank3_Profit
						multiply = 1000
						divide = var:bank3_BankValue

						#Rounds up to the closest number divisible by 5
						divide = 5
						ceiling = yes
						multiply = 5
					}
				}
				else = {
					add_prestige = {
						value = var:bank3_Profit
						multiply = 1000
						divide = var:bank3_BankValue

						#Rounds up to the closest number divisible by 5
						divide = 5
						ceiling = yes
						multiply = 5
					}
				}
			}
		}

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0203 = { # Buy a share
	type = character_event
	title = agot_banking.0203.t
	desc = agot_banking.0203.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = personality_greedy
	}

	immediate = {
		save_scope_as = NewShareholder
		if = {
			limit = {
				exists = global_var:IB_location
				OR = {
					top_liege = global_var:IB_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:IB_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:IB_location.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:IB_location.de_jure_liege.holder
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = bank1_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank2_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank3_Shares }
					var:bank3_Shares ?= 0
				}
			}
			set_global_variable = {
				name = IB_ValuePerShare
				value = global_var:IB_BankValue
			}
			change_global_variable = {
				name = IB_ValuePerShare
				divide = global_var:IB_NofShares
			}
			set_variable = {
				name = ShareBuyingPrice
				value = global_var:IB_ValuePerShare
			}

			# Needs to be increased to avoid buy-sell exploit for infinite money
			change_variable = {
				name = ShareBuyingPrice
				multiply = 1.05
			}
		}
		else_if = {
			limit = {
				exists = global_var:bank1_location
				OR = {
					top_liege = global_var:bank1_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank1_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank1_location.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank1_location.de_jure_liege.holder
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = IB_Shares }
					var:IB_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank2_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank3_Shares }
					var:bank3_Shares ?= 0
				}
			}
			set_global_variable = {
				name = bank1_ValuePerShare
				value = global_var:bank1_BankValue
			}
			change_global_variable = {
				name = bank1_ValuePerShare
				divide = global_var:bank1_NofShares
			}
			set_variable = {
				name = ShareBuyingPrice
				value = global_var:bank1_ValuePerShare
			}

			# Needs to be increased to avoid buy-sell exploit for infinite money
			change_variable = {
				name = ShareBuyingPrice
				multiply = 1.05
			}
		}
		else_if = {
			limit = {
				exists = global_var:bank2_location
				OR = {
					top_liege = global_var:bank2_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank2_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank2_location.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank2_location.de_jure_liege.holder
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = bank1_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = IB_Shares }
					var:IB_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank3_Shares }
					var:bank3_Shares ?= 0
				}
			}
			set_global_variable = {
				name = bank2_ValuePerShare
				value = global_var:bank2_BankValue
			}
			change_global_variable = {
				name = bank2_ValuePerShare
				divide = global_var:bank2_NofShares
			}
			set_variable = {
				name = ShareBuyingPrice
				value = global_var:bank2_ValuePerShare
			}

			# Needs to be increased to avoid buy-sell exploit for infinite money
			change_variable = {
				name = ShareBuyingPrice
				multiply = 1.05
			}
		}
		else_if = {
			limit = {
				exists = global_var:bank3_location
				OR = {
					top_liege = global_var:bank3_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank3_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank3_location.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank3_location.de_jure_liege.holder
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = bank1_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank2_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = IB_Shares }
					var:IB_Shares ?= 0
				}
			}
			set_global_variable = {
				name = bank3_ValuePerShare
				value = global_var:bank3_BankValue
			}
			change_global_variable = {
				name = bank3_ValuePerShare
				divide = global_var:bank3_NofShares
			}
			set_variable = {
				name = ShareBuyingPrice
				value = global_var:bank3_ValuePerShare
			}

			# Needs to be increased to avoid buy-sell exploit for infinite money
			change_variable = {
				name = ShareBuyingPrice
				multiply = 1.05
			}
		}
	}

	option = {	# I cannot afford
		name = agot_banking.0203.a

		trigger = {
			trigger_if = {
				limit = {
					exists = global_var:IB_location
					OR = {
						top_liege = global_var:IB_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:IB_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:IB_location.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:IB_location.de_jure_liege.holder
					}
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = bank1_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank2_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank3_Shares }
					var:bank3_Shares ?= 0
				}
				gold < var:ShareBuyingPrice
			}
			trigger_if = {
				limit = {
					exists = global_var:bank1_location
					OR = {
						top_liege = global_var:bank1_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank1_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank1_location.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank1_location.de_jure_liege.holder
					}
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = IB_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank2_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank3_Shares }
					var:bank3_Shares ?= 0
				}
				gold < var:ShareBuyingPrice
			}
			trigger_if = {
				limit = {
					exists = global_var:bank2_location
					OR = {
						top_liege = global_var:bank2_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank2_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank2_location.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank2_location.de_jure_liege.holder
					}
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = bank1_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = IB_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank3_Shares }
					var:bank3_Shares ?= 0
				}
				gold < var:ShareBuyingPrice
			}
			trigger_if = {
				limit = {
					exists = global_var:bank3_location
					OR = {
						top_liege = global_var:bank3_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank3_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank3_location.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank3_location.de_jure_liege.holder
					}
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = bank1_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank2_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = IB_Shares }
					var:bank3_Shares ?= 0
				}
				gold < var:ShareBuyingPrice
			}
		}

		ai_chance = {
			base = 100
		}
	}

	option = {	# I can afford
		name = agot_banking.0203.b

		trigger = {
			trigger_if = {
				limit = {
					exists = global_var:IB_location
					OR = {
						top_liege = global_var:IB_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:IB_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:IB_location.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:IB_location.de_jure_liege.holder
					}
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = bank1_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank2_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank3_Shares }
					var:bank3_Shares ?= 0
				}
				gold >= var:ShareBuyingPrice
			}
			trigger_if = {
				limit = {
					exists = global_var:bank1_location
					OR = {
						top_liege = global_var:bank1_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank1_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank1_location.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank1_location.de_jure_liege.holder
					}
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = IB_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank2_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank3_Shares }
					var:bank3_Shares ?= 0
				}
				gold >= var:ShareBuyingPrice
			}
			trigger_if = {
				limit = {
					exists = global_var:bank2_location
					OR = {
						top_liege = global_var:bank2_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank2_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank2_location.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank2_location.de_jure_liege.holder
					}
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = bank1_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = IB_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank3_Shares }
					var:bank3_Shares ?= 0
				}
				gold >= var:ShareBuyingPrice
			}
			trigger_if = {
				limit = {
					exists = global_var:bank3_location
					OR = {
						top_liege = global_var:bank3_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank3_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank3_location.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank3_location.de_jure_liege.holder
					}
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = bank1_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank2_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = IB_Shares }
					var:bank3_Shares ?= 0
				}
				gold >= var:ShareBuyingPrice
			}
		}

		if = {
			limit = {
				exists = global_var:IB_location
				OR = {
					top_liege = global_var:IB_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:IB_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:IB_location.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:IB_location.de_jure_liege.holder
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = bank1_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank2_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank3_Shares }
					var:bank3_Shares ?= 0
				}
			}

			change_global_variable = {
				name = IB_NofShares
				add = 1
			}
			change_global_variable = {
				name = IB_FreeCapital
				add = var:ShareBuyingPrice
			}
			change_global_variable = {
				name = IB_BankValue
				add = var:ShareBuyingPrice
			}

			remove_short_term_gold = var:ShareBuyingPrice

			if = {
				limit = {
					has_variable = IB_Shares
					var:IB_Shares > 0
				}
				change_variable = {
					name = IB_Shares
					add = 1
				}
			}
			else = {
				set_variable = {
					name = IB_Shares
					value = 1
				}
				add_to_global_variable_list = {
					name = IB_Shareholder
					target = this
				}
				add_to_global_variable_list = {
					name = Shareholder
					target = this
				}
				set_variable = {
					name = BankName
					value = global_var:IB_founder
				}
			}

			every_in_global_list = {
				variable = IB_Shareholder
				limit = {
					has_character_flag = IB_Director
					is_ai = no
				}
				play_sound_effect = "event:/SFX/Events/Themes/sfx_event_theme_type_stewardship"
				send_interface_message = {
					type = msg_bank_new_shareholder
					title = agot_banking.0606.t
					desc = agot_banking.0606.desc
					right_icon = scope:NewShareholder
				}
			}
		}
		else_if = {
			limit = {
				exists = global_var:bank1_location
				OR = {
					top_liege = global_var:bank1_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank1_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank1_location.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank1_location.de_jure_liege.holder
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = IB_Shares }
					var:IB_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank2_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank3_Shares }
					var:bank3_Shares ?= 0
				}
			}

			change_global_variable = {
				name = bank1_NofShares
				add = 1
			}
			change_global_variable = {
				name = bank1_FreeCapital
				add = var:ShareBuyingPrice
			}
			change_global_variable = {
				name = bank1_BankValue
				add = var:ShareBuyingPrice
			}

			remove_short_term_gold = var:ShareBuyingPrice

			if = {
				limit = {
					has_variable = bank1_Shares
					var:bank1_Shares > 0
				}
				change_variable = {
					name = bank1_Shares
					add = 1
				}
			}
			else = {
				set_variable = {
					name = bank1_Shares
					value = 1
				}
				add_to_global_variable_list = {
					name = bank1_Shareholder
					target = this
				}
				add_to_global_variable_list = {
					name = Shareholder
					target = this
				}
				set_variable = {
					name = BankName
					value = global_var:bank1_founder
				}
			}

			every_in_global_list = {
				variable = bank1_Shareholder
				limit = {
					has_character_flag = bank1_Director
					is_ai = no
				}
				var:BankName = {
					save_scope_as = BankName
				}
				play_sound_effect = "event:/SFX/Events/Themes/sfx_event_theme_type_stewardship"
				send_interface_message = {
					type = msg_bank_new_shareholder
					title = agot_banking.0606.t
					desc = agot_banking.0606.desc
					right_icon = scope:NewShareholder
				}
			}
		}
		else_if = {
			limit = {
				exists = global_var:bank2_location
				OR = {
					top_liege = global_var:bank2_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank2_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank2_location.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank2_location.de_jure_liege.holder
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = bank1_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = IB_Shares }
					var:IB_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank3_Shares }
					var:bank3_Shares ?= 0
				}
			}

			change_global_variable = {
				name = bank2_NofShares
				add = 1
			}
			change_global_variable = {
				name = bank2_FreeCapital
				add = var:ShareBuyingPrice
			}
			change_global_variable = {
				name = bank2_BankValue
				add = var:ShareBuyingPrice
			}

			remove_short_term_gold = var:ShareBuyingPrice

			if = {
				limit = {
					has_variable = bank2_Shares
					var:bank2_Shares > 0
				}
				change_variable = {
					name = bank2_Shares
					add = 1
				}
			}
			else = {
				set_variable = {
					name = bank2_Shares
					value = 1
				}
				add_to_global_variable_list = {
					name = bank2_Shareholder
					target = this
				}
				add_to_global_variable_list = {
					name = Shareholder
					target = this
				}
				set_variable = {
					name = BankName
					value = global_var:bank2_founder
				}
			}

			every_in_global_list = {
				variable = bank2_Shareholder
				limit = {
					has_character_flag = bank2_Director
					is_ai = no
				}
				var:BankName = {
					save_scope_as = BankName
				}
				play_sound_effect = "event:/SFX/Events/Themes/sfx_event_theme_type_stewardship"
				send_interface_message = {
					type = msg_bank_new_shareholder
					title = agot_banking.0606.t
					desc = agot_banking.0606.desc
					right_icon = scope:NewShareholder
				}
			}
		}
		else_if = {
			limit = {
				exists = global_var:bank3_location
				OR = {
					top_liege = global_var:bank3_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank3_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank3_location.de_jure_liege.de_jure_liege.holder
					top_liege = global_var:bank3_location.de_jure_liege.holder
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = bank1_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank2_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = IB_Shares }
					var:IB_Shares ?= 0
				}
			}

			change_global_variable = {
				name = bank3_NofShares
				add = 1
			}
			change_global_variable = {
				name = bank3_FreeCapital
				add = var:ShareBuyingPrice
			}
			change_global_variable = {
				name = bank3_BankValue
				add = var:ShareBuyingPrice
			}

			remove_short_term_gold = var:ShareBuyingPrice

			if = {
				limit = {
					has_variable = bank3_Shares
					var:bank3_Shares > 0
				}
				change_variable = {
					name = bank3_Shares
					add = 1
				}
			}
			else = {
				set_variable = {
					name = bank3_Shares
					value = 1
				}
				add_to_global_variable_list = {
					name = bank3_Shareholder
					target = this
				}
				add_to_global_variable_list = {
					name = Shareholder
					target = this
				}
				set_variable = {
					name = BankName
					value = global_var:bank3_founder
				}
			}

			every_in_global_list = {
				variable = bank3_Shareholder
				limit = {
					has_character_flag = bank3_Director
					is_ai = no
				}
				var:BankName = {
					save_scope_as = BankName
				}
				play_sound_effect = "event:/SFX/Events/Themes/sfx_event_theme_type_stewardship"
				send_interface_message = {
					type = msg_bank_new_shareholder
					title = agot_banking.0606.t
					desc = agot_banking.0606.desc
					right_icon = scope:NewShareholder
				}
			}
		}

		ai_chance = {
			base = 100
		}
	}

	option = {	# I can afford but changed my mind
		name = agot_banking.0203.c

		trigger = {
			trigger_if = {
				limit = {
					exists = global_var:IB_location
					OR = {
						top_liege = global_var:IB_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:IB_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:IB_location.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:IB_location.de_jure_liege.holder
					}
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = bank1_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank2_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank3_Shares }
					var:bank3_Shares ?= 0
				}
				gold >= var:ShareBuyingPrice
			}
			trigger_if = {
				limit = {
					exists = global_var:bank1_location
					OR = {
						top_liege = global_var:bank1_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank1_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank1_location.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank1_location.de_jure_liege.holder
					}
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = IB_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank2_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank3_Shares }
					var:bank3_Shares ?= 0
				}
				gold >= var:ShareBuyingPrice
			}
			trigger_if = {
				limit = {
					exists = global_var:bank2_location
					OR = {
						top_liege = global_var:bank2_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank2_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank2_location.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank2_location.de_jure_liege.holder
					}
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = bank1_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = IB_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank3_Shares }
					var:bank3_Shares ?= 0
				}
				gold >= var:ShareBuyingPrice
			}
			trigger_if = {
				limit = {
					exists = global_var:bank3_location
					OR = {
						top_liege = global_var:bank3_location.de_jure_liege.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank3_location.de_jure_liege.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank3_location.de_jure_liege.de_jure_liege.holder
						top_liege = global_var:bank3_location.de_jure_liege.holder
					}
				}

				#You hold no shares of another bank, even if in the same realm
				OR = {
					NOT = { has_variable = bank1_Shares }
					var:bank1_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = bank2_Shares }
					var:bank2_Shares ?= 0
				}
				OR = {
					NOT = { has_variable = IB_Shares }
					var:bank3_Shares ?= 0
				}
				gold >= var:ShareBuyingPrice
			}
		}

		ai_chance = {
			base = 0
		}
	}
}

agot_banking.0204 = { # Sell a share
	type = character_event
	title = agot_banking.0204.t
	desc = agot_banking.0204.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = personality_greedy
	}

	immediate = {
		if = {
			limit = {
				has_variable = IB_Shares
				var:IB_Shares > 0
			}
			set_global_variable = {
				name = IB_ValuePerShare
				value = global_var:IB_BankValue
			}
			change_global_variable = {
				name = IB_ValuePerShare
				divide = global_var:IB_NofShares
			}
			set_variable = {
				name = ShareSellingPrice
				value = global_var:IB_ValuePerShare
			}
			if = {  # avoid negative cash
				limit = {
					exists = global_var:IB_FreeCapital
					has_variable = ShareSellingPrice
					global_var:IB_FreeCapital < var:ShareSellingPrice
				}
				set_variable = {
					name = ShareSellingPrice
					value = global_var:IB_FreeCapital
				}
			}
		}
		else_if = {
			limit = {
				has_variable = bank1_Shares
				var:bank1_Shares > 0
			}
			set_global_variable = {
				name = bank1_ValuePerShare
				value = global_var:bank1_BankValue
			}
			change_global_variable = {
				name = bank1_ValuePerShare
				divide = global_var:bank1_NofShares
			}
			set_variable = {
				name = ShareSellingPrice
				value = global_var:bank1_ValuePerShare
			}
			if = {  # avoid negative cash
				limit = {
					exists = global_var:bank1_FreeCapital
					has_variable = ShareSellingPrice
					global_var:bank1_FreeCapital < var:ShareSellingPrice
				}
				set_variable = {
					name = ShareSellingPrice
					value = global_var:bank1_FreeCapital
				}
			}
		}
		else_if = {
			limit = {
				has_variable = bank2_Shares
				var:bank2_Shares > 0
			}
			set_global_variable = {
				name = bank2_ValuePerShare
				value = global_var:bank2_BankValue
			}
			change_global_variable = {
				name = bank2_ValuePerShare
				divide = global_var:bank2_NofShares
			}
			set_variable = {
				name = ShareSellingPrice
				value = global_var:bank2_ValuePerShare
			}
			if = {  # avoid negative cash
				limit = {
					exists = global_var:bank2_FreeCapital
					has_variable = ShareSellingPrice
					global_var:bank2_FreeCapital < var:ShareSellingPrice
				}
				set_variable = {
					name = ShareSellingPrice
					value = global_var:bank2_FreeCapital
				}
			}
		}
		else_if = {
			limit = {
				has_variable = bank3_Shares
				var:bank3_Shares > 0
			}
			set_global_variable = {
				name = bank3_ValuePerShare
				value = global_var:bank3_BankValue
			}
			change_global_variable = {
				name = bank3_ValuePerShare
				divide = global_var:bank3_NofShares
			}
			set_variable = {
				name = ShareSellingPrice
				value = global_var:bank3_ValuePerShare
			}
			if = {  # avoid negative cash
				limit = {
					exists = global_var:bank3_FreeCapital
					has_variable = ShareSellingPrice
					global_var:bank3_FreeCapital < var:ShareSellingPrice
				}
				set_variable = {
					name = ShareSellingPrice
					value = global_var:bank3_FreeCapital
				}
			}
		}
	}

	option = {
		name = agot_banking.0204.a

		if = {
			limit = {
				has_variable = IB_Shares
				var:IB_Shares > 0
			}
			change_global_variable = {
				name = IB_NofShares
				subtract = 1
			}
			change_global_variable = {
				name = IB_FreeCapital
				subtract = var:ShareSellingPrice
			}
			change_global_variable = {
				name = IB_BankValue
				subtract = var:ShareSellingPrice
			}

			add_gold = var:ShareSellingPrice

			change_variable = {
				name = IB_Shares
				subtract = 1
			}

			if = {
				limit = {
					var:IB_Shares ?= 0
				}
				remove_list_global_variable = {
					name = IB_Shareholder
					target = this
				}
				remove_list_global_variable = {
					name = Shareholder
					target = this
				}
			}
		}
		else_if = {
			limit = {
				has_variable = bank1_Shares
				var:bank1_Shares > 0
			}
			change_global_variable = {
				name = bank1_NofShares
				subtract = 1
			}
			change_global_variable = {
				name = bank1_FreeCapital
				subtract = var:ShareSellingPrice
			}
			change_global_variable = {
				name = bank1_BankValue
				subtract = var:ShareSellingPrice
			}

			add_gold = var:ShareSellingPrice

			change_variable = {
				name = bank1_Shares
				subtract = 1
			}

			if = {
				limit = {
					var:bank1_Shares ?= 0
				}
				remove_list_global_variable = {
					name = bank1_Shareholder
					target = this
				}
				remove_list_global_variable = {
					name = Shareholder
					target = this
				}
			}
		}
		else_if = {
			limit = {
				has_variable = bank2_Shares
				var:bank2_Shares > 0
			}
			change_global_variable = {
				name = bank2_NofShares
				subtract = 1
			}
			change_global_variable = {
				name = bank2_FreeCapital
				subtract = var:ShareSellingPrice
			}
			change_global_variable = {
				name = bank2_BankValue
				subtract = var:ShareSellingPrice
			}

			add_gold = var:ShareSellingPrice

			change_variable = {
				name = bank2_Shares
				subtract = 1
			}

			if = {
				limit = {
					var:bank2_Shares ?= 0
				}
				remove_list_global_variable = {
					name = bank2_Shareholder
					target = this
				}
				remove_list_global_variable = {
					name = Shareholder
					target = this
				}
			}
		}
		else_if = {
			limit = {
				has_variable = bank3_Shares
				var:bank3_Shares > 0
			}
			change_global_variable = {
				name = bank3_NofShares
				subtract = 1
			}
			change_global_variable = {
				name = bank3_FreeCapital
				subtract = var:ShareSellingPrice
			}
			change_global_variable = {
				name = bank3_BankValue
				subtract = var:ShareSellingPrice
			}

			add_gold = var:ShareSellingPrice

			change_variable = {
				name = bank3_Shares
				subtract = 1
			}

			if = {
				limit = {
					var:bank3_Shares ?= 0
				}
				remove_list_global_variable = {
					name = bank3_Shareholder
					target = this
				}
				remove_list_global_variable = {
					name = Shareholder
					target = this
				}
			}
		}

		ai_chance = {
			base = 100
		}
	}

	option = {	# I changed my mind
		name = agot_banking.0204.b

		ai_chance = {
			base = 0
		}
	}
}

agot_banking.0205 = { # inform about new director
	type = character_event
	title = agot_banking.0205.t
	desc = agot_banking.0205.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = scope:director
		animation = steward
	}

	option = {
		name = agot_banking.0205.a
		if = {
			limit = {
				NOT = { this = scope:director }
				OR = {
					scope:director_candidate1 ?= this
					scope:director_candidate2 ?= this
					scope:director_candidate3 ?= this
					scope:director_candidate4 ?= this
				}
			}
			custom_tooltip = agot_banking.0205.a_tt
		}

		remove_variable = director_winner_votes
		remove_variable = director_votes


		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0206 = { # decide on risk level
	type = character_event
	title = agot_banking.0206.t
	desc = agot_banking.0206.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = steward
	}

	option = {  # low
		name = agot_banking.0206.a

		if = {
			limit = {
				has_character_flag = IB_Director
			}
			set_global_variable = {
				name = IB_RiskLevel
				value = 3
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_Director
			}
			set_global_variable = {
				name = bank1_RiskLevel
				value = 3
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_Director
			}
			set_global_variable = {
				name = bank2_RiskLevel
				value = 3
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_Director
			}
			set_global_variable = {
				name = bank3_RiskLevel
				value = 3
			}
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_boldness = -1
			}
		}
	}

	option = {  # medium
		name = agot_banking.0206.b

		if = {
			limit = {
				has_character_flag = IB_Director
			}
			set_global_variable = {
				name = IB_RiskLevel
				value = 6
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_Director
			}
			set_global_variable = {
				name = bank1_RiskLevel
				value = 6
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_Director
			}
			set_global_variable = {
				name = bank2_RiskLevel
				value = 6
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_Director
			}
			set_global_variable = {
				name = bank3_RiskLevel
				value = 6
			}
		}

		ai_chance = {
			base = 100
		}
	}

	option = {  # high
		name = agot_banking.0206.c

		if = {
			limit = {
				has_character_flag = IB_Director
			}
			set_global_variable = {
				name = IB_RiskLevel
				value = 18
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_Director
			}
			set_global_variable = {
				name = bank1_RiskLevel
				value = 18
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_Director
			}
			set_global_variable = {
				name = bank2_RiskLevel
				value = 18
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_Director
			}
			set_global_variable = {
				name = bank3_RiskLevel
				value = 18
			}
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_boldness = 1
			}
			modifier = {
				has_character_flag = IB_Director
				global_var:IB_FreeCapital > global_var:IB_LoanedCapital
				add = 100
			}
			modifier = {
				has_character_flag = bank1_Director
				global_var:bank1_FreeCapital > global_var:bank1_LoanedCapital
				add = 100
			}
			modifier = {
				has_character_flag = bank2_Director
				global_var:bank2_FreeCapital > global_var:bank2_LoanedCapital
				add = 100
			}
			modifier = {
				has_character_flag = bank3_Director
				global_var:bank3_FreeCapital > global_var:bank3_LoanedCapital
				add = 100
			}
		}
	}
}

agot_banking.0207 = { # decide on dividend level
	type = character_event
	title = agot_banking.0207.t
	desc = agot_banking.0207.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = steward
	}

	option = {  # low
		name = agot_banking.0207.a
		custom_tooltip = agot_banking.0207.a_tt

		if = {
			limit = {
				has_character_flag = IB_Director
			}
			set_global_variable = {
				name = IB_DividendLevel
				value = 0.5
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_Director
			}
			set_global_variable = {
				name = bank1_DividendLevel
				value = 0.5
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_Director
			}
			set_global_variable = {
				name = bank2_DividendLevel
				value = 0.5
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_Director
			}
			set_global_variable = {
				name = bank3_DividendLevel
				value = 0.5
			}
		}


		ai_chance = {
			base = 50
			ai_value_modifier = {
				ai_greed = -0.5
			}
		}
	}

	option = {  # medium
		name = agot_banking.0207.b
		custom_tooltip = agot_banking.0207.b_tt

		if = {
			limit = {
				has_character_flag = IB_Director
			}
			set_global_variable = {
				name = IB_DividendLevel
				value = 0.75
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_Director
			}
			set_global_variable = {
				name = bank1_DividendLevel
				value = 0.75
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_Director
			}
			set_global_variable = {
				name = bank2_DividendLevel
				value = 0.75
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_Director
			}
			set_global_variable = {
				name = bank3_DividendLevel
				value = 0.75
			}
		}

		ai_chance = {
			base = 100
		}
	}

	option = {  # high
		name = agot_banking.0207.c
		custom_tooltip = agot_banking.0207.c_tt

		if = {
			limit = {
				has_character_flag = IB_Director
			}
			set_global_variable = {
				name = IB_DividendLevel
				value = 1
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_Director
			}
			set_global_variable = {
				name = bank1_DividendLevel
				value = 1
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_Director
			}
			set_global_variable = {
				name = bank2_DividendLevel
				value = 1
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_Director
			}
			set_global_variable = {
				name = bank3_DividendLevel
				value = 1
			}
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = 0.5
			}
			modifier = {
				has_character_flag = IB_Director
				global_var:IB_FreeCapital > global_var:IB_LoanedCapital
				add = 100
			}
			modifier = {
				has_character_flag = bank1_Director
				global_var:bank1_FreeCapital > global_var:bank1_LoanedCapital
				add = 100
			}
			modifier = {
				has_character_flag = bank2_Director
				global_var:bank2_FreeCapital > global_var:bank2_LoanedCapital
				add = 100
			}
			modifier = {
				has_character_flag = bank3_Director
				global_var:bank3_FreeCapital > global_var:bank3_LoanedCapital
				add = 100
			}
		}
	}
}

agot_banking.0208 = { # decide on interest level
	type = character_event
	title = agot_banking.0208.t
	desc = agot_banking.0208.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = steward
	}

	option = {  # low
		name = agot_banking.0208.a
		custom_tooltip = agot_banking.0208.a_tt

		if = {
			limit = {
				has_character_flag = IB_Director
			}
			set_global_variable = {
				name = IB_InterestLevel
				value = -1
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_Director
			}
			set_global_variable = {
				name = bank1_InterestLevel
				value = -1
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_Director
			}
			set_global_variable = {
				name = bank2_InterestLevel
				value = -1
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_Director
			}
			set_global_variable = {
				name = bank3_InterestLevel
				value = -1
			}
		}


		ai_chance = {
			base = 50
			ai_value_modifier = {
				ai_greed = -1
			}
			modifier = {
				has_character_flag = IB_Director
				global_var:IB_FreeCapital > global_var:IB_LoanedCapital
				add = 100
			}
			modifier = {
				has_character_flag = bank1_Director
				global_var:bank1_FreeCapital > global_var:bank1_LoanedCapital
				add = 100
			}
			modifier = {
				has_character_flag = bank2_Director
				global_var:bank2_FreeCapital > global_var:bank2_LoanedCapital
				add = 100
			}
			modifier = {
				has_character_flag = bank3_Director
				global_var:bank3_FreeCapital > global_var:bank3_LoanedCapital
				add = 100
			}
		}
	}

	option = {  # medium
		name = agot_banking.0208.b
		custom_tooltip = agot_banking.0208.b_tt

		if = {
			limit = {
				has_character_flag = IB_Director
			}
			set_global_variable = {
				name = IB_InterestLevel
				value = 0
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_Director
			}
			set_global_variable = {
				name = bank1_InterestLevel
				value = 0
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_Director
			}
			set_global_variable = {
				name = bank2_InterestLevel
				value = 0
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_Director
			}
			set_global_variable = {
				name = bank3_InterestLevel
				value = 0
			}
		}

		ai_chance = {
			base = 100
		}
	}

	option = {  # high
		name = agot_banking.0208.c
		custom_tooltip = agot_banking.0208.c_tt

		if = {
			limit = {
				has_character_flag = IB_Director
			}
			set_global_variable = {
				name = IB_InterestLevel
				value = 1
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_Director
			}
			set_global_variable = {
				name = bank1_InterestLevel
				value = 1
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_Director
			}
			set_global_variable = {
				name = bank2_InterestLevel
				value = 1
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_Director
			}
			set_global_variable = {
				name = bank3_InterestLevel
				value = 1
			}
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = 1
			}
			modifier = {
				has_character_flag = IB_Director
				global_var:IB_FreeCapital < invest_threshold_IB
				add = 100
			}
			modifier = {
				has_character_flag = bank1_Director
				global_var:bank1_FreeCapital < invest_threshold_bank1
				add = 100
			}
			modifier = {
				has_character_flag = bank2_Director
				global_var:bank2_FreeCapital < invest_threshold_bank2
				add = 100
			}
			modifier = {
				has_character_flag = bank3_Director
				global_var:bank3_FreeCapital < invest_threshold_bank3
				add = 100
			}
		}
	}
}

agot_banking.0210 = { # Director decides who will handle defaulter
	type = character_event
	title = agot_banking.0210.t
	desc = agot_banking.0210.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = personality_greedy
	}

	immediate = {
		set_variable = {
			name = show_loan
			value = scope:FinalDefaulter.var:total_repayment
		}
	}

	option = {  # handle it yourself
		name = agot_banking.0210.a
		custom_tooltip = agot_banking.0210.a_tt

		trigger = {
			NOT = { has_character_flag = handling_default }
		}

		set_variable = {  # base amount for possible bonus payment
			name = recovered_amount
			value = scope:FinalDefaulter.var:total_repayment
		}

		add_character_flag = {
			flag = handling_default
			years = 1
		}

		save_scope_as = default_revisor
		trigger_event = {
			id =  agot_banking.0211   # initial action selection
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_energy = 0.5
			}
		}
	}

	option = {  # delegate to another shareholder
		name = agot_banking.0210.b
		custom_tooltip = agot_banking.0210.b_tt

		trigger = {
			OR = {
				AND = {
					has_character_flag = IB_Director
					any_in_global_list = {
						variable = IB_Shareholder
						NOT = { has_character_flag = handling_default }
						NOT = { has_character_flag = IB_Director }
						is_adult = yes
					}
				}
				AND = {
					has_character_flag = bank1_Director
					any_in_global_list = {
						variable = bank1_Shareholder
						NOT = { has_character_flag = handling_default }
						NOT = { has_character_flag = bank1_Director }
						is_adult = yes
					}
				}
				AND = {
					has_character_flag = bank2_Director
					any_in_global_list = {
						variable = bank2_Shareholder
						NOT = { has_character_flag = handling_default }
						NOT = { has_character_flag = bank2_Director }
						is_adult = yes
					}
				}
				AND = {
					has_character_flag = bank3_Director
					any_in_global_list = {
						variable = bank3_Shareholder
						NOT = { has_character_flag = handling_default }
						NOT = { has_character_flag = bank3_Director }
						is_adult = yes
					}
				}
			}
		}

		save_scope_as = director

		if = {
			limit = {
				has_character_flag = IB_Director
			}
			random_in_global_list = {
				variable = IB_Shareholder

				limit = {
					NOT = { has_character_flag = handling_default }
					NOT = { has_character_flag = IB_Director }
					is_adult = yes
				}

				weight = {
					base = 100
					modifier = {
						has_trait = ambitious
						add = 50
					}
					modifier = {
						has_trait = diligent
						add = 50
					}
					modifier = {
						add = {
							value = var:IB_Shares
							multiply = 10
						}
					}
				}

				set_variable = {  # base amount for possible bonus payment
					name = recovered_amount
					value = scope:FinalDefaulter.var:total_repayment
				}

				add_character_flag = {
					flag = handling_default
					years = 1
				}
				save_scope_as = default_revisor
				trigger_event = {
					id =  agot_banking.0211   # initial action selection
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_Director
			}
			random_in_global_list = {
				variable = bank1_Shareholder

				limit = {
					NOT = { has_character_flag = handling_default }
					NOT = { has_character_flag = bank1_Director }
					is_adult = yes
				}

				weight = {
					base = 100
					modifier = {
						has_trait = ambitious
						add = 50
					}
					modifier = {
						has_trait = diligent
						add = 50
					}
					modifier = {
						add = {
							value = var:bank1_Shares
							multiply = 10
						}
					}
				}

				set_variable = {  # base amount for possible bonus payment
					name = recovered_amount
					value = scope:FinalDefaulter.var:total_repayment
				}

				add_character_flag = {
					flag = handling_default
					years = 1
				}
				save_scope_as = default_revisor
				trigger_event = {
					id =  agot_banking.0211   # initial action selection
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_Director
			}
			random_in_global_list = {
				variable = bank2_Shareholder

				limit = {
					NOT = { has_character_flag = handling_default }
					NOT = { has_character_flag = bank2_Director }
					is_adult = yes
				}

				weight = {
					base = 100
					modifier = {
						has_trait = ambitious
						add = 50
					}
					modifier = {
						has_trait = diligent
						add = 50
					}
					modifier = {
						add = {
							value = var:bank2_Shares
							multiply = 10
						}
					}
				}

				set_variable = {  # base amount for possible bonus payment
					name = recovered_amount
					value = scope:FinalDefaulter.var:total_repayment
				}

				add_character_flag = {
					flag = handling_default
					years = 1
				}
				save_scope_as = default_revisor
				trigger_event = {
					id =  agot_banking.0211   # initial action selection
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_Director
			}
			random_in_global_list = {
				variable = bank3_Shareholder

				limit = {
					NOT = { has_character_flag = handling_default }
					NOT = { has_character_flag = bank3_Director }
					is_adult = yes
				}

				weight = {
					base = 100
					modifier = {
						has_trait = ambitious
						add = 50
					}
					modifier = {
						has_trait = diligent
						add = 50
					}
					modifier = {
						add = {
							value = var:bank3_Shares
							multiply = 10
						}
					}
				}

				set_variable = {  # base amount for possible bonus payment
					name = recovered_amount
					value = scope:FinalDefaulter.var:total_repayment
				}

				add_character_flag = {
					flag = handling_default
					years = 1
				}
				save_scope_as = default_revisor
				trigger_event = {
					id =  agot_banking.0211   # initial action selection
				}
			}
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_energy = -0.5
			}
			modifier = {
				has_character_flag = handling_default
				add = 100
			}
		}
	}

	option = {  # don't bother me with defaulters anymore
		name = agot_banking.0210.c
		custom_tooltip = agot_banking.0210.c_tt

		add_character_flag = no_default_handling

		ai_chance = {
			base = 0
		}
	}

	option = {  # nothing is to be done
		name = agot_banking.0210.d
		custom_tooltip = agot_banking.0210.d_tt

		ai_chance = {
			base = 0
		}
	}
}

agot_banking.0212 = {   # inform revisor about success
	type = character_event
	title = agot_banking.0212.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = raid_success
				}
				desc = agot_banking.0212.raid_success_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = assassin_success
				}
				desc = agot_banking.0212.assassin_success_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = claim_success
				}
				desc = agot_banking.0212.claim_success_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = letter1_success
				}
				desc = agot_banking.0212.letter1_success_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = letter2_success
				}
				desc = agot_banking.0212.letter2_success_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = letter3_success
				}
				desc = agot_banking.0212.letter3_success_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = economy_success
				}
				desc = agot_banking.0212.economy_success_desc
			}
		}
	}

	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = fear
	}

	immediate = {
		if = {
			limit = {  # should never happen, but who knows...
				var:recovered_amount <= 0
			}
			set_variable = {
				name = recovered_amount
				value = 0
			}
		}
		else = {   # 5% of the remaining recovered amount after costs is paid as a bonus
			change_variable = {
				name = recovered_amount
				multiply = 0.05
			}
		}
	}

	option = {
		name = agot_banking.0212.a

		if = {
			limit = {
				var:recovered_amount > 0
			}

			add_gold = var:recovered_amount

			if = {
				limit = {
					has_variable = IB_Shares
					var:IB_Shares > 0
				}
				change_global_variable = {
					name = IB_FreeCapital
					subtract = var:recovered_amount
				}
				change_global_variable = {
					name = IB_BankValue
					subtract = var:recovered_amount
				}
				change_global_variable = {
					name = IB_Expenses
					add = var:recovered_amount
				}
			}
			else_if = {
				limit = {
					has_variable = bank1_Shares
					var:bank1_Shares > 0
				}
				change_global_variable = {
					name = bank1_FreeCapital
					subtract = var:recovered_amount
				}
				change_global_variable = {
					name = bank1_BankValue
					subtract = var:recovered_amount
				}
				change_global_variable = {
					name = bank1_Expenses
					add = var:recovered_amount
				}
			}
			else_if = {
				limit = {
					has_variable = bank2_Shares
					var:bank2_Shares > 0
				}
				change_global_variable = {
					name = bank2_FreeCapital
					subtract = var:recovered_amount
				}
				change_global_variable = {
					name = bank2_BankValue
					subtract = var:recovered_amount
				}
				change_global_variable = {
					name = bank2_Expenses
					add = var:recovered_amount
				}
			}
			else_if = {
				limit = {
					has_variable = bank3_Shares
					var:bank3_Shares > 0
				}
				change_global_variable = {
					name = bank3_FreeCapital
					subtract = var:recovered_amount
				}
				change_global_variable = {
					name = bank3_BankValue
					subtract = var:recovered_amount
				}
				change_global_variable = {
					name = bank3_Expenses
					add = var:recovered_amount
				}
			}
		}

		remove_character_flag = handling_default
		remove_character_flag = attempted_raid
		remove_character_flag = attempted_assassination
		remove_character_flag = attempted_claim
		remove_character_flag = attempted_letter
		remove_character_flag = attempted_economy

		remove_character_flag = raid_success
		remove_character_flag = assassin_success
		remove_character_flag = claim_success
		remove_character_flag = letter1_success
		remove_character_flag = letter2_success
		remove_character_flag = letter3_success
		remove_character_flag = economy_success

		set_variable = {
			name = recovered_amount
			value = 0
		}

		ai_chance = {
			base = 100
		}
	}
}


agot_banking.0301 = {  # Shareholder informed about banks performance
	type = character_event
	title = agot_banking.0301.t

	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					AND = {
						has_variable = IB_Shares
						var:IB_Shares > 0
					}
				}
				desc = agot_banking.0301.IB.desc
			}
			triggered_desc = {
				trigger = {
					AND = {
						has_variable = bank1_Shares
						var:bank1_Shares > 0
					}
				}
				desc = agot_banking.0301.bank1.desc
			}
			triggered_desc = {
				trigger = {
					AND = {
						has_variable = bank2_Shares
						var:bank2_Shares > 0
					}
				}
				desc = agot_banking.0301.bank2.desc
			}
			triggered_desc = {
				trigger = {
					AND = {
						has_variable = bank3_Shares
						var:bank3_Shares > 0
					}
				}
				desc = agot_banking.0301.bank3.desc
			}
		}
	}

	theme = stewardship
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:director
		animation = steward
	}

	immediate = {
		if = {
			limit = {
				has_variable = IB_Shares
				var:IB_Shares > 0
			}
			every_in_global_list = {
				variable = IB_Shareholder
				limit = {
					has_character_flag = IB_Director
				}
				save_scope_as = director
			}
			# Transfer global variables to character in order to show them in the locs
			set_variable = {
				name = IB_FreeCapital
				value = global_var:IB_FreeCapital
			}
			set_variable = {
				name = IB_LoanedCapital
				value = global_var:IB_LoanedCapital
			}
			set_variable = {
				name = IB_InvestmentFund
				value = global_var:IB_InvestmentFund
			}
			set_variable = {
				name = IB_BankValue
				value = global_var:IB_BankValue
			}
			set_variable = {
				name = IB_NofShares
				value = global_var:IB_NofShares
			}
			set_variable = {
				name = IB_Earnings
				value = global_var:IB_Earnings
			}
			set_variable = {
				name = IB_Expenses
				value = global_var:IB_Expenses
			}
			set_variable = {
				name = IB_LostLoans
				value = global_var:IB_LostLoans
			}
		}
		else_if = {
			limit = {
				has_variable = bank1_Shares
				var:bank1_Shares > 0
			}
			every_in_global_list = {
				variable = bank1_Shareholder
				limit = {
					has_character_flag = bank1_Director
				}
				save_scope_as = director
			}
			# Transfer global variables to character in order to show them in the locs
			set_variable = {
				name = bank1_FreeCapital
				value = global_var:bank1_FreeCapital
			}
			set_variable = {
				name = bank1_LoanedCapital
				value = global_var:bank1_LoanedCapital
			}
			set_variable = {
				name = bank1_InvestmentFund
				value = global_var:bank1_InvestmentFund
			}
			set_variable = {
				name = bank1_BankValue
				value = global_var:bank1_BankValue
			}
			set_variable = {
				name = bank1_NofShares
				value = global_var:bank1_NofShares
			}
			set_variable = {
				name = bank1_Earnings
				value = global_var:bank1_Earnings
			}
			set_variable = {
				name = bank1_Expenses
				value = global_var:bank1_Expenses
			}
			set_variable = {
				name = bank1_LostLoans
				value = global_var:bank1_LostLoans
			}
		}
		else_if = {
			limit = {
				has_variable = bank2_Shares
				var:bank2_Shares > 0
			}
			every_in_global_list = {
				variable = bank2_Shareholder
				limit = {
					has_character_flag = bank2_Director
				}
				save_scope_as = director
			}
			# Transfer global variables to character in order to show them in the locs
			set_variable = {
				name = bank2_FreeCapital
				value = global_var:bank2_FreeCapital
			}
			set_variable = {
				name = bank2_LoanedCapital
				value = global_var:bank2_LoanedCapital
			}
			set_variable = {
				name = bank2_InvestmentFund
				value = global_var:bank2_InvestmentFund
			}
			set_variable = {
				name = bank2_BankValue
				value = global_var:bank2_BankValue
			}
			set_variable = {
				name = bank2_NofShares
				value = global_var:bank2_NofShares
			}
			set_variable = {
				name = bank2_Earnings
				value = global_var:bank2_Earnings
			}
			set_variable = {
				name = bank2_Expenses
				value = global_var:bank2_Expenses
			}
			set_variable = {
				name = bank2_LostLoans
				value = global_var:bank2_LostLoans
			}
		}
		if = {
			limit = {
				has_variable = bank3_Shares
				var:bank3_Shares > 0
			}
			every_in_global_list = {
				variable = bank3_Shareholder
				limit = {
					has_character_flag = bank3_Director
				}
				save_scope_as = director
			}
			# Transfer global variables to character in order to show them in the locs
			set_variable = {
				name = bank3_FreeCapital
				value = global_var:bank3_FreeCapital
			}
			set_variable = {
				name = bank3_LoanedCapital
				value = global_var:bank3_LoanedCapital
			}
			set_variable = {
				name = bank3_InvestmentFund
				value = global_var:bank3_InvestmentFund
			}
			set_variable = {
				name = bank3_BankValue
				value = global_var:bank3_BankValue
			}
			set_variable = {
				name = bank3_NofShares
				value = global_var:bank3_NofShares
			}
			set_variable = {
				name = bank3_Earnings
				value = global_var:bank3_Earnings
			}
			set_variable = {
				name = bank3_Expenses
				value = global_var:bank3_Expenses
			}
			set_variable = {
				name = bank3_LostLoans
				value = global_var:bank3_LostLoans
			}
		}
	}

	option = {
		name = agot_banking.0301.a

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0401 = { # fill the investment fund
	type = character_event
	title = agot_banking.0401.t
	desc = agot_banking.0401.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = steward
	}

	option = {  # do it
		name = agot_banking.0401.a
		custom_tooltip = agot_banking.0401.a_tt

		if = {
			limit = {
				has_character_flag = IB_Director
			}
			change_global_variable = {
				name = IB_InvestmentFund
				add = 1000
			}
			change_global_variable = {
				name = IB_FreeCapital
				subtract = 1000
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_Director
			}
			change_global_variable = {
				name = bank1_InvestmentFund
				add = 1000
			}
			change_global_variable = {
				name = bank1_FreeCapital
				subtract = 1000
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_Director
			}
			change_global_variable = {
				name = bank2_InvestmentFund
				add = 1000
			}
			change_global_variable = {
				name = bank2_FreeCapital
				subtract = 1000
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_Director
			}
			change_global_variable = {
				name = bank3_InvestmentFund
				add = 1000
			}
			change_global_variable = {
				name = bank3_FreeCapital
				subtract = 1000
			}
		}

		ai_chance = {
			base = 0
			modifier = {
				add = {
					value = stewardship
					multiply = 5
				}
			}
			ai_value_modifier = {
				ai_greed = 0.25
				ai_boldness = 0.25
			}
		}
	}

	option = {  # I changed my mind
		name = agot_banking.0401.b

		ai_chance = {
			base = 50
		}
	}
}

agot_banking.0402 = { # yearly investement fund results
	hidden = yes

	trigger = {
		OR = {
			AND = {
				has_character_flag = IB_Director
				global_var:IB_InvestmentFund > 100
			}
			AND = {
				has_character_flag = bank1_Director
				global_var:bank1_InvestmentFund > 100
			}
			AND = {
				has_character_flag = bank2_Director
				global_var:bank2_InvestmentFund > 100
			}
			AND = {
				has_character_flag = bank3_Director
				global_var:bank3_InvestmentFund > 100
			}
		}
	}

	immediate = {
		save_scope_as = director

		random_list = {  # average yearly performance of 0,15% with Stewardship 10, -2.45% with Stewardship 0 and +1.46% with Stewardship 20

			24 = {  # -5%
				modifier = {
					add = {
						value = -1.4
						multiply = {
							value = stewardship
							subtract = 10
						}
					}
				}

				if = {
					limit = {
						has_character_flag = IB_Director
					}
					set_variable = {
						name = IB_InvestProfit
						value = global_var:IB_InvestmentFund
					}
					change_variable = {
						name = IB_InvestProfit
						multiply = -0.05
					}
					if = {
						limit = {
							global_var:IB_RiskLevel = 3
						}
						change_variable = {
							name = IB_InvestProfit
							multiply = 0.5
						}
						change_global_variable = {
							name = IB_InvestmentFund
							multiply = 0.975
						}
					}
					else_if = {
						limit = {
							global_var:IB_RiskLevel = 18
						}
						change_variable = {
							name = IB_InvestProfit
							multiply = 2
						}
						change_global_variable = {
							name = IB_InvestmentFund
							multiply = 0.9
						}
					}
					else = {
						change_global_variable = {
							name = IB_InvestmentFund
							multiply = 0.95
						}
					}

					change_global_variable = {
						name = IB_Expenses
						subtract = var:IB_InvestProfit  # negative number
					}
					change_global_variable = {
						name = IB_BankValue
						add = var:IB_InvestProfit  # negative number
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank1_Director
					}
					set_variable = {
						name = bank1_InvestProfit
						value = global_var:bank1_InvestmentFund
					}
					change_variable = {
						name = bank1_InvestProfit
						multiply = -0.05
					}
					if = {
						limit = {
							global_var:bank1_RiskLevel = 3
						}
						change_variable = {
							name = bank1_InvestProfit
							multiply = 0.5
						}
						change_global_variable = {
							name = bank1_InvestmentFund
							multiply = 0.975
						}
					}
					else_if = {
						limit = {
							global_var:bank1_RiskLevel = 18
						}
						change_variable = {
							name = bank1_InvestProfit
							multiply = 2
						}
						change_global_variable = {
							name = bank1_InvestmentFund
							multiply = 0.9
						}
					}
					else = {
						change_global_variable = {
							name = bank1_InvestmentFund
							multiply = 0.95
						}
					}

					change_global_variable = {
						name = bank1_Expenses
						subtract = var:bank1_InvestProfit  # negative number
					}
					change_global_variable = {
						name = bank1_BankValue
						add = var:bank1_InvestProfit  # negative number
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank2_Director
					}
					set_variable = {
						name = bank2_InvestProfit
						value = global_var:bank2_InvestmentFund
					}
					change_variable = {
						name = bank2_InvestProfit
						multiply = -0.05
					}
					if = {
						limit = {
							global_var:bank2_RiskLevel = 3
						}
						change_variable = {
							name = bank2_InvestProfit
							multiply = 0.5
						}
						change_global_variable = {
							name = bank2_InvestmentFund
							multiply = 0.975
						}
					}
					else_if = {
						limit = {
							global_var:bank2_RiskLevel = 18
						}
						change_variable = {
							name = bank2_InvestProfit
							multiply = 2
						}
						change_global_variable = {
							name = bank2_InvestmentFund
							multiply = 0.9
						}
					}
					else = {
						change_global_variable = {
							name = bank2_InvestmentFund
							multiply = 0.95
						}
					}

					change_global_variable = {
						name = bank2_Expenses
						subtract = var:bank2_InvestProfit  # negative number
					}
					change_global_variable = {
						name = bank2_BankValue
						add = var:bank2_InvestProfit  # negative number
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank3_Director
					}
					set_variable = {
						name = bank3_InvestProfit
						value = global_var:bank3_InvestmentFund
					}
					change_variable = {
						name = bank3_InvestProfit
						multiply = -0.05
					}
					if = {
						limit = {
							global_var:bank3_RiskLevel = 3
						}
						change_variable = {
							name = bank3_InvestProfit
							multiply = 0.5
						}
						change_global_variable = {
							name = bank3_InvestmentFund
							multiply = 0.975
						}
					}
					else_if = {
						limit = {
							global_var:bank3_RiskLevel = 18
						}
						change_variable = {
							name = bank3_InvestProfit
							multiply = 2
						}
						change_global_variable = {
							name = bank3_InvestmentFund
							multiply = 0.9
						}
					}
					else = {
						change_global_variable = {
							name = bank3_InvestmentFund
							multiply = 0.95
						}
					}

					change_global_variable = {
						name = bank3_Expenses
						subtract = var:bank3_InvestProfit  # negative number
					}
					change_global_variable = {
						name = bank3_BankValue
						add = var:bank3_InvestProfit  # negative number
					}
				}
			}
			15 = {  #0%
				modifier = {
					add = {
						value = -0.5
						multiply = {
							value = stewardship
							subtract = 10
						}
					}
				}

				if = {
					limit = {
						has_character_flag = IB_Director
					}
					set_variable = {
						name = IB_InvestProfit
						value = 0
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank1_Director
					}
					set_variable = {
						name = bank1_InvestProfit
						value = 0
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank2_Director
					}
					set_variable = {
						name = bank2_InvestProfit
						value = 0
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank3_Director
					}
					set_variable = {
						name = bank3_InvestProfit
						value = 0
					}
				}
			}
			24 = {  #1%
				modifier = {
					add = {
						value = 2
						multiply = {
							value = stewardship
							subtract = 10
						}
					}
				}


				if = {
					limit = {
						has_character_flag = IB_Director
					}
					set_variable = {
						name = IB_InvestProfit
						value = global_var:IB_InvestmentFund
					}
					change_variable = {
						name = IB_InvestProfit
						multiply = 0.01
					}
					if = {
						limit = {
							global_var:IB_RiskLevel = 3
						}
						change_variable = {
							name = IB_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:IB_RiskLevel = 18
						}
						change_variable = {
							name = IB_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = IB_FreeCapital
						add = var:IB_InvestProfit
					}
					change_global_variable = {
						name = IB_Earnings
						add = var:IB_InvestProfit
					}
					change_global_variable = {
						name = IB_BankValue
						add = var:IB_InvestProfit
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank1_Director
					}
					set_variable = {
						name = bank1_InvestProfit
						value = global_var:bank1_InvestmentFund
					}
					change_variable = {
						name = bank1_InvestProfit
						multiply = 0.01
					}
					if = {
						limit = {
							global_var:bank1_RiskLevel = 3
						}
						change_variable = {
							name = bank1_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:bank1_RiskLevel = 18
						}
						change_variable = {
							name = bank1_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = bank1_FreeCapital
						add = var:bank1_InvestProfit
					}
					change_global_variable = {
						name = bank1_Earnings
						add = var:bank1_InvestProfit
					}
					change_global_variable = {
						name = bank1_BankValue
						add = var:bank1_InvestProfit
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank2_Director
					}
					set_variable = {
						name = bank2_InvestProfit
						value = global_var:bank2_InvestmentFund
					}
					change_variable = {
						name = bank2_InvestProfit
						multiply = 0.01
					}
					if = {
						limit = {
							global_var:bank2_RiskLevel = 3
						}
						change_variable = {
							name = bank2_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:bank2_RiskLevel = 18
						}
						change_variable = {
							name = bank2_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = bank2_FreeCapital
						add = var:bank2_InvestProfit
					}
					change_global_variable = {
						name = bank2_Earnings
						add = var:bank2_InvestProfit
					}
					change_global_variable = {
						name = bank2_BankValue
						add = var:bank2_InvestProfit
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank3_Director
					}
					set_variable = {
						name = bank3_InvestProfit
						value = global_var:bank3_InvestmentFund
					}
					change_variable = {
						name = bank3_InvestProfit
						multiply = 0.01
					}
					if = {
						limit = {
							global_var:bank3_RiskLevel = 3
						}
						change_variable = {
							name = bank3_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:bank3_RiskLevel = 18
						}
						change_variable = {
							name = bank3_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = bank3_FreeCapital
						add = var:bank3_InvestProfit
					}
					change_global_variable = {
						name = bank3_Earnings
						add = var:bank3_InvestProfit
					}
					change_global_variable = {
						name = bank3_BankValue
						add = var:bank3_InvestProfit
					}
				}
			}
			18 = {  #2%
				modifier = {
					add = {
						value = 1.5
						multiply = {
							value = stewardship
							subtract = 10
						}
					}
				}

				if = {
					limit = {
						has_character_flag = IB_Director
					}
					set_variable = {
						name = IB_InvestProfit
						value = global_var:IB_InvestmentFund
					}
					change_variable = {
						name = IB_InvestProfit
						multiply = 0.02
					}
					if = {
						limit = {
							global_var:IB_RiskLevel = 3
						}
						change_variable = {
							name = IB_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:IB_RiskLevel = 18
						}
						change_variable = {
							name = IB_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = IB_FreeCapital
						add = var:IB_InvestProfit
					}
					change_global_variable = {
						name = IB_Earnings
						add = var:IB_InvestProfit
					}
					change_global_variable = {
						name = IB_BankValue
						add = var:IB_InvestProfit
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank1_Director
					}
					set_variable = {
						name = bank1_InvestProfit
						value = global_var:bank1_InvestmentFund
					}
					change_variable = {
						name = bank1_InvestProfit
						multiply = 0.02
					}
					if = {
						limit = {
							global_var:bank1_RiskLevel = 3
						}
						change_variable = {
							name = bank1_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:bank1_RiskLevel = 18
						}
						change_variable = {
							name = bank1_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = bank1_FreeCapital
						add = var:bank1_InvestProfit
					}
					change_global_variable = {
						name = bank1_Earnings
						add = var:bank1_InvestProfit
					}
					change_global_variable = {
						name = bank1_BankValue
						add = var:bank1_InvestProfit
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank2_Director
					}
					set_variable = {
						name = bank2_InvestProfit
						value = global_var:bank2_InvestmentFund
					}
					change_variable = {
						name = bank2_InvestProfit
						multiply = 0.02
					}
					if = {
						limit = {
							global_var:bank2_RiskLevel = 3
						}
						change_variable = {
							name = bank2_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:bank2_RiskLevel = 18
						}
						change_variable = {
							name = bank2_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = bank2_FreeCapital
						add = var:bank2_InvestProfit
					}
					change_global_variable = {
						name = bank2_Earnings
						add = var:bank2_InvestProfit
					}
					change_global_variable = {
						name = bank2_BankValue
						add = var:bank2_InvestProfit
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank3_Director
					}
					set_variable = {
						name = bank3_InvestProfit
						value = global_var:bank3_InvestmentFund
					}
					change_variable = {
						name = bank3_InvestProfit
						multiply = 0.02
					}
					if = {
						limit = {
							global_var:bank3_RiskLevel = 3
						}
						change_variable = {
							name = bank3_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:bank3_RiskLevel = 18
						}
						change_variable = {
							name = bank3_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = bank3_FreeCapital
						add = var:bank3_InvestProfit
					}
					change_global_variable = {
						name = bank3_Earnings
						add = var:bank3_InvestProfit
					}
					change_global_variable = {
						name = bank3_BankValue
						add = var:bank3_InvestProfit
					}
				}
			}
			12 = {  #3%
				modifier = {
					add = {
						value = 1
						multiply = {
							value = stewardship
							subtract = 10
						}
					}
				}

				if = {
					limit = {
						has_character_flag = IB_Director
					}
					set_variable = {
						name = IB_InvestProfit
						value = global_var:IB_InvestmentFund
					}
					change_variable = {
						name = IB_InvestProfit
						multiply = 0.03
					}
					if = {
						limit = {
							global_var:IB_RiskLevel = 3
						}
						change_variable = {
							name = IB_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:IB_RiskLevel = 18
						}
						change_variable = {
							name = IB_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = IB_FreeCapital
						add = var:IB_InvestProfit
					}
					change_global_variable = {
						name = IB_Earnings
						add = var:IB_InvestProfit
					}
					change_global_variable = {
						name = IB_BankValue
						add = var:IB_InvestProfit
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank1_Director
					}
					set_variable = {
						name = bank1_InvestProfit
						value = global_var:bank1_InvestmentFund
					}
					change_variable = {
						name = bank1_InvestProfit
						multiply = 0.03
					}
					if = {
						limit = {
							global_var:bank1_RiskLevel = 3
						}
						change_variable = {
							name = bank1_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:bank1_RiskLevel = 18
						}
						change_variable = {
							name = bank1_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = bank1_FreeCapital
						add = var:bank1_InvestProfit
					}
					change_global_variable = {
						name = bank1_Earnings
						add = var:bank1_InvestProfit
					}
					change_global_variable = {
						name = bank1_BankValue
						add = var:bank1_InvestProfit
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank2_Director
					}
					set_variable = {
						name = bank2_InvestProfit
						value = global_var:bank2_InvestmentFund
					}
					change_variable = {
						name = bank2_InvestProfit
						multiply = 0.03
					}
					if = {
						limit = {
							global_var:bank2_RiskLevel = 3
						}
						change_variable = {
							name = bank2_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:bank2_RiskLevel = 18
						}
						change_variable = {
							name = bank2_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = bank2_FreeCapital
						add = var:bank2_InvestProfit
					}
					change_global_variable = {
						name = bank2_Earnings
						add = var:bank2_InvestProfit
					}
					change_global_variable = {
						name = bank2_BankValue
						add = var:bank2_InvestProfit
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank3_Director
					}
					set_variable = {
						name = bank3_InvestProfit
						value = global_var:bank3_InvestmentFund
					}
					change_variable = {
						name = bank3_InvestProfit
						multiply = 0.03
					}
					if = {
						limit = {
							global_var:bank3_RiskLevel = 3
						}
						change_variable = {
							name = bank3_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:bank3_RiskLevel = 18
						}
						change_variable = {
							name = bank3_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = bank3_FreeCapital
						add = var:bank3_InvestProfit
					}
					change_global_variable = {
						name = bank3_Earnings
						add = var:bank3_InvestProfit
					}
					change_global_variable = {
						name = bank3_BankValue
						add = var:bank3_InvestProfit
					}
				}
			}
			6 = {  #4%
				modifier = {
					add = {
						value = 0.5
						multiply = {
							value = stewardship
							subtract = 10
						}
					}
				}

				if = {
					limit = {
						has_character_flag = IB_Director
					}
					set_variable = {
						name = IB_InvestProfit
						value = global_var:IB_InvestmentFund
					}
					change_variable = {
						name = IB_InvestProfit
						multiply = 0.04
					}
					if = {
						limit = {
							global_var:IB_RiskLevel = 3
						}
						change_variable = {
							name = IB_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:IB_RiskLevel = 18
						}
						change_variable = {
							name = IB_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = IB_FreeCapital
						add = var:IB_InvestProfit
					}
					change_global_variable = {
						name = IB_Earnings
						add = var:IB_InvestProfit
					}
					change_global_variable = {
						name = IB_BankValue
						add = var:IB_InvestProfit
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank1_Director
					}
					set_variable = {
						name = bank1_InvestProfit
						value = global_var:bank1_InvestmentFund
					}
					change_variable = {
						name = bank1_InvestProfit
						multiply = 0.04
					}
					if = {
						limit = {
							global_var:bank1_RiskLevel = 3
						}
						change_variable = {
							name = bank1_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:bank1_RiskLevel = 18
						}
						change_variable = {
							name = bank1_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = bank1_FreeCapital
						add = var:bank1_InvestProfit
					}
					change_global_variable = {
						name = bank1_Earnings
						add = var:bank1_InvestProfit
					}
					change_global_variable = {
						name = bank1_BankValue
						add = var:bank1_InvestProfit
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank2_Director
					}
					set_variable = {
						name = bank2_InvestProfit
						value = global_var:bank2_InvestmentFund
					}
					change_variable = {
						name = bank2_InvestProfit
						multiply = 0.04
					}
					if = {
						limit = {
							global_var:bank2_RiskLevel = 3
						}
						change_variable = {
							name = bank2_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:bank2_RiskLevel = 18
						}
						change_variable = {
							name = bank2_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = bank2_FreeCapital
						add = var:bank2_InvestProfit
					}
					change_global_variable = {
						name = bank2_Earnings
						add = var:bank2_InvestProfit
					}
					change_global_variable = {
						name = bank2_BankValue
						add = var:bank2_InvestProfit
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank3_Director
					}
					set_variable = {
						name = bank3_InvestProfit
						value = global_var:bank3_InvestmentFund
					}
					change_variable = {
						name = bank3_InvestProfit
						multiply = 0.04
					}
					if = {
						limit = {
							global_var:bank3_RiskLevel = 3
						}
						change_variable = {
							name = bank3_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:bank3_RiskLevel = 18
						}
						change_variable = {
							name = bank3_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = bank3_FreeCapital
						add = var:bank3_InvestProfit
					}
					change_global_variable = {
						name = bank3_Earnings
						add = var:bank3_InvestProfit
					}
					change_global_variable = {
						name = bank3_BankValue
						add = var:bank3_InvestProfit
					}
				}
			}
			3 = {  #5%
				modifier = {
					add = {
						value = 0.25
						multiply = {
							value = stewardship
							subtract = 10
						}
					}
				}

				if = {
					limit = {
						has_character_flag = IB_Director
					}
					set_variable = {
						name = IB_InvestProfit
						value = global_var:IB_InvestmentFund
					}
					change_variable = {
						name = IB_InvestProfit
						multiply = 0.05
					}
					if = {
						limit = {
							global_var:IB_RiskLevel = 3
						}
						change_variable = {
							name = IB_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:IB_RiskLevel = 18
						}
						change_variable = {
							name = IB_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = IB_FreeCapital
						add = var:IB_InvestProfit
					}
					change_global_variable = {
						name = IB_Earnings
						add = var:IB_InvestProfit
					}
					change_global_variable = {
						name = IB_BankValue
						add = var:IB_InvestProfit
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank1_Director
					}
					set_variable = {
						name = bank1_InvestProfit
						value = global_var:bank1_InvestmentFund
					}
					change_variable = {
						name = bank1_InvestProfit
						multiply = 0.05
					}
					if = {
						limit = {
							global_var:bank1_RiskLevel = 3
						}
						change_variable = {
							name = bank1_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:bank1_RiskLevel = 18
						}
						change_variable = {
							name = bank1_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = bank1_FreeCapital
						add = var:bank1_InvestProfit
					}
					change_global_variable = {
						name = bank1_Earnings
						add = var:bank1_InvestProfit
					}
					change_global_variable = {
						name = bank1_BankValue
						add = var:bank1_InvestProfit
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank2_Director
					}
					set_variable = {
						name = bank2_InvestProfit
						value = global_var:bank2_InvestmentFund
					}
					change_variable = {
						name = bank2_InvestProfit
						multiply = 0.05
					}
					if = {
						limit = {
							global_var:bank2_RiskLevel = 3
						}
						change_variable = {
							name = bank2_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:bank2_RiskLevel = 18
						}
						change_variable = {
							name = bank2_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = bank2_FreeCapital
						add = var:bank2_InvestProfit
					}
					change_global_variable = {
						name = bank2_Earnings
						add = var:bank2_InvestProfit
					}
					change_global_variable = {
						name = bank2_BankValue
						add = var:bank2_InvestProfit
					}
				}
				else_if = {
					limit = {
						has_character_flag = bank3_Director
					}
					set_variable = {
						name = bank3_InvestProfit
						value = global_var:bank3_InvestmentFund
					}
					change_variable = {
						name = bank3_InvestProfit
						multiply = 0.05
					}
					if = {
						limit = {
							global_var:bank3_RiskLevel = 3
						}
						change_variable = {
							name = bank3_InvestProfit
							multiply = 0.5
						}
					}
					else_if = {
						limit = {
							global_var:bank3_RiskLevel = 18
						}
						change_variable = {
							name = bank3_InvestProfit
							multiply = 2
						}
					}

					change_global_variable = {
						name = bank3_FreeCapital
						add = var:bank3_InvestProfit
					}
					change_global_variable = {
						name = bank3_Earnings
						add = var:bank3_InvestProfit
					}
					change_global_variable = {
						name = bank3_BankValue
						add = var:bank3_InvestProfit
					}
				}
			}
		}
		if = {
			limit = {
				has_character_flag = IB_Director
			}
			set_variable = {
				name = ShownInvestProfit
				value = var:IB_InvestProfit
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_Director
			}
			set_variable = {
				name = ShownInvestProfit
				value = var:bank1_InvestProfit
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_Director
			}
			set_variable = {
				name = ShownInvestProfit
				value = var:bank2_InvestProfit
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_Director
			}
			set_variable = {
				name = ShownInvestProfit
				value = var:bank3_InvestProfit
			}
		}

		trigger_event = {
			id = agot_banking.0403    # inform director
		}
	}
}

agot_banking.0403 = { # inform about investment funds profits
	type = character_event
	title = agot_banking.0403.t

	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					OR = {
						AND = {
							has_character_flag = IB_Director
							var:IB_InvestProfit > 0
						}
						AND = {
							has_character_flag = bank1_Director
							var:bank1_InvestProfit > 0
						}
						AND = {
							has_character_flag = bank2_Director
							var:bank2_InvestProfit > 0
						}
						AND = {
							has_character_flag = bank3_Director
							var:bank3_InvestProfit > 0
						}
					}
				}
				desc = agot_banking.0403.positive_desc
			}
			triggered_desc = {
				trigger = {
					OR = {
						AND = {
							has_character_flag = IB_Director
							var:IB_InvestProfit = 0
						}
						AND = {
							has_character_flag = bank1_Director
							var:bank1_InvestProfit = 0
						}
						AND = {
							has_character_flag = bank2_Director
							var:bank2_InvestProfit = 0
						}
						AND = {
							has_character_flag = bank3_Director
							var:bank3_InvestProfit = 0
						}
					}
				}
				desc = agot_banking.0403.neutral_desc
			}
			triggered_desc = {
				trigger = {
					OR = {
						AND = {
							has_character_flag = IB_Director
							var:IB_InvestProfit < 0
						}
						AND = {
							has_character_flag = bank1_Director
							var:bank1_InvestProfit < 0
						}
						AND = {
							has_character_flag = bank2_Director
							var:bank2_InvestProfit < 0
						}
						AND = {
							has_character_flag = bank3_Director
							var:bank3_InvestProfit < 0
						}
					}
				}
				desc = agot_banking.0403.negative_desc
			}
		}
	}

	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = scope:director
		animation = steward
	}

	option = {
		name = agot_banking.0403.a

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0501 = { # inform about accepted vassal loan and transfer the money
	type = letter_event
	opening = agot_banking.0501.t
	desc = agot_banking.0501.desc
	sender = scope:loan_vassal

	option = {
		name = agot_banking.0501.a

		scope:loan_vassal = {
			pay_short_term_gold = {
				target = PREV
				gold = var:liege_loan_amount
			}
		}

		trigger_event = {
			id =  agot_banking.0503
			years = 5
		}

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0502 = { # inform about declined vassal loan
	type = letter_event
	opening = agot_banking.0502.t
	desc = agot_banking.0502.desc
	sender = scope:loan_vassal

	option = {
		name = agot_banking.0502.a

		add_opinion = {
			target = scope:loan_vassal
			modifier = disappointed_opinion
			opinion = -10
		}

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0503 = { # repayment becomes due
	type = letter_event
	opening = agot_banking.0503.t
	desc = agot_banking.0503.desc
	sender = var:vassal_loan_creditor

	trigger = {
		has_character_flag = has_a_vassal_loan
		var:vassal_loan_creditor ?= { is_alive = yes }
	}

	option = {   # repay everything
		name = agot_banking.0503.a
		custom_tooltip = agot_banking.0503.a_tt

		trigger = {
			gold >= var:vassal_loan_total_amount
		}

		remove_short_term_gold = var:vassal_loan_total_amount

		var:vassal_loan_creditor = {
			add_character_flag = vassal_loan_repay_full
			remove_character_flag = has_granted_liege_loan
			trigger_event = {
				id =  agot_banking.0504
			}
		}

		remove_character_flag = has_a_vassal_loan
		remove_character_flag = vassal_loan_first_default_liege

		if = {
			limit = { has_variable = vassal_loan_amount }
			remove_variable = vassal_loan_amount
		}
		if = {
			limit = { has_variable = vassal_loan_total_amount }
			remove_variable = vassal_loan_total_amount
		}
		if = {
			limit = { has_variable = vassal_loan_interest }
			remove_variable = vassal_loan_interest
		}
		if = {
			limit = { has_variable = vassal_loan_creditor }
			remove_variable = vassal_loan_creditor
		}

		ai_chance = {
			base = 200
			ai_value_modifier = {
				ai_greed = -0.5
				ai_rationality = 0.5
			}
		}
	}

	option = {   # repay interest only
		name = agot_banking.0503.b
		custom_tooltip = agot_banking.0503.b_tt

		trigger = {
			gold >= var:vassal_loan_interest
		}

		remove_short_term_gold = var:vassal_loan_interest

		var:vassal_loan_creditor = {
			add_character_flag = vassal_loan_repay_interest
			trigger_event = {
				id =  agot_banking.0504
			}
		}

		trigger_event = {
			id =  agot_banking.0503
			years = 5
		}

		ai_chance = {
			base = 150
		}
	}

	option = {   # first default
		name = agot_banking.0503.c
		custom_tooltip = agot_banking.0503.c_tt

		trigger = {
			NOT = { has_character_flag = vassal_loan_first_default_liege }
		}

		add_character_flag = vassal_loan_first_default_liege

		var:vassal_loan_creditor = {
			add_character_flag = vassal_loan_first_default
			trigger_event = {
				id =  agot_banking.0504
			}
		}

		trigger_event = {
			id =  agot_banking.0503
			years = 5
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = 0.1
				ai_rationality = 0.25
				ai_boldness = -0.25
			}
			modifier = {
				gold >= var:vassal_loan_interest
				factor = 0.1
			}
		}
	}

	option = {   # second default
		name = agot_banking.0503.d
		custom_tooltip = agot_banking.0503.d_tt

		trigger = {
			has_character_flag = vassal_loan_first_default_liege
		}

		var:vassal_loan_creditor = {
			add_character_flag = vassal_loan_second_default
			remove_character_flag = has_granted_liege_loan

			add_opinion = {
				modifier = not_repay_loan_opinion
				target = PREV
			}

			trigger_event = {
				id =  agot_banking.0504
			}
		}

		remove_character_flag = has_a_vassal_loan
		remove_character_flag = vassal_loan_first_default_liege

		if = {
			limit = { has_variable = vassal_loan_amount }
			remove_variable = vassal_loan_amount
		}
		if = {
			limit = { has_variable = vassal_loan_total_amount }
			remove_variable = vassal_loan_total_amount
		}
		if = {
			limit = { has_variable = vassal_loan_interest }
			remove_variable = vassal_loan_interest
		}
		if = {
			limit = { has_variable = vassal_loan_creditor }
			remove_variable = vassal_loan_creditor
		}

		ai_chance = {
			base = 50
			ai_value_modifier = {
				ai_rationality = 0.25
				ai_boldness = -0.25
			}
			modifier = {
				gold >= var:vassal_loan_interest
				factor = 0.1
			}
		}
	}

	option = {   # refuse to pay
		name = agot_banking.0503.e
		custom_tooltip = agot_banking.0503.e_tt

		var:vassal_loan_creditor = {
			add_character_flag = vassal_loan_refuse_payment
			remove_character_flag = has_granted_liege_loan

			add_opinion = {
				modifier = not_repay_loan_opinion
				target = PREV
			}

			trigger_event = {
				id =  agot_banking.0504
			}
		}

		add_tyranny = medium_tyranny_value

		remove_character_flag = has_a_vassal_loan
		remove_character_flag = vassal_loan_first_default_liege

		if = {
			limit = { has_variable = vassal_loan_amount }
			remove_variable = vassal_loan_amount
		}
		if = {
			limit = { has_variable = vassal_loan_total_amount }
			remove_variable = vassal_loan_total_amount
		}
		if = {
			limit = { has_variable = vassal_loan_interest }
			remove_variable = vassal_loan_interest
		}
		if = {
			limit = { has_variable = vassal_loan_creditor }
			remove_variable = vassal_loan_creditor
		}

		ai_chance = {
			base = 25
			ai_value_modifier = {
				ai_rationality = -0.1
				ai_boldness = 0.15
			}
			modifier = {
				gold >= var:vassal_loan_interest
				factor = 0.1
			}
		}
	}
}

agot_banking.0504 = { # inform about liege reaction on due repayment
	type = letter_event
	opening = agot_banking.0504.t

	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = vassal_loan_repay_full
				}
				desc = agot_banking.0504.repay_full_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = vassal_loan_repay_interest
				}
				desc = agot_banking.0504.repay_interest_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = vassal_loan_first_default
				}
				desc = agot_banking.0504.first_default_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = vassal_loan_second_default
				}
				desc = agot_banking.0504.second_default_desc
			}
			triggered_desc = {
				trigger = {
					has_character_flag = vassal_loan_refuse_payment
				}
				desc = agot_banking.0504.refusal_desc
			}
		}
	}

	sender = var:vassal_loan_debtor

	option = {
		name = agot_banking.0504.a

		trigger = {
			has_character_flag = vassal_loan_repay_full
		}

		add_gold = {
			value = var:liege_loan_amount
			multiply = 1.25
		}

		if = {
			limit = { has_variable = liege_loan_amount }
			remove_variable = liege_loan_amount
		}
		if = {
			limit = { has_variable = vassal_loan_debtor }
			remove_variable = vassal_loan_debtor
		}
		remove_character_flag = has_granted_liege_loan

		remove_character_flag = vassal_loan_repay_full

		ai_chance = {
			base = 100
		}
	}

	option = {
		name = agot_banking.0504.b

		trigger = {
			has_character_flag = vassal_loan_repay_interest
		}

		add_gold = {
			value = var:liege_loan_amount
			multiply = 0.25
		}

		remove_character_flag = vassal_loan_repay_interest

		ai_chance = {
			base = 100
		}
	}

	option = {
		name = agot_banking.0504.c

		trigger = {
			has_character_flag = vassal_loan_first_default
		}

		if = {
			limit = {
				NOT = { has_hook = var:vassal_loan_debtor }
			}
			add_hook = {
				type = indebted_hook
				target = var:vassal_loan_debtor
			}
		}

		remove_character_flag = vassal_loan_first_default

		ai_chance = {
			base = 100
		}
	}

	option = {
		name = agot_banking.0504.d

		trigger = {
			has_character_flag = vassal_loan_second_default
		}

		if = {
			limit = {
				NOT = { has_strong_hook = var:vassal_loan_debtor }
			}
			add_hook = {
				type = liege_favour_strong_hook
				target = var:vassal_loan_debtor
			}
		}

		if = {
			limit = { has_variable = liege_loan_amount }
			remove_variable = liege_loan_amount
		}
		if = {
			limit = { has_variable = vassal_loan_debtor }
			remove_variable = vassal_loan_debtor
		}
		remove_character_flag = has_granted_liege_loan

		remove_character_flag = vassal_loan_second_default

		ai_chance = {
			base = 100
		}
	}

	option = {
		name = agot_banking.0504.e

		trigger = {
			has_character_flag = vassal_loan_refuse_payment
		}

		if = {
			limit = {
				var:vassal_loan_debtor = { is_landed = yes }
				NOT = { has_claim_on = var:vassal_loan_debtor.primary_title }
			}
			add_unpressed_claim = var:vassal_loan_debtor.primary_title
		}

		if = {
			limit = { has_variable = liege_loan_amount }
			remove_variable = liege_loan_amount
		}
		if = {
			limit = { has_variable = vassal_loan_debtor }
			remove_variable = vassal_loan_debtor
		}
		remove_character_flag = has_granted_liege_loan

		remove_character_flag = vassal_loan_refuse_payment

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0215 = { # inform about dead director and ask for vote
	type = character_event
	title = agot_banking.0215.t
	desc = agot_banking.0215.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = scope:director_candidate1
		animation = steward
	}

	right_portrait = {
		trigger = { exists = scope:director_candidate2 }
		character = scope:director_candidate2
		animation = steward
	}

	lower_left_portrait = {
		trigger = { exists = scope:director_candidate3 }
		character = scope:director_candidate3
	}

	lower_right_portrait = {
		trigger = { exists = scope:director_candidate4 }
		character = scope:director_candidate4
	}

	option = {
		name = agot_banking.0215.a

		trigger = {
			exists = scope:director_candidate1
		}

		scope:director_candidate1 = {
			if = {
				limit = {
					root = { has_variable = IB_Shares }
					root.var:IB_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:IB_Shares
				}
			}
			else_if = {
				limit = {
					root = { has_variable = bank1_Shares }
					root.var:bank1_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:bank1_Shares
				}
			}
			else_if = {
				limit = {
					root = { has_variable = bank2_Shares }
					root.var:bank2_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:bank2_Shares
				}
			}
			else_if = {
				limit = {
					root = { has_variable = bank3_Shares }
					root.var:bank3_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:bank3_Shares
				}
			}
		}

		ai_chance = {
			base = 0

			modifier = {
				add = {
					value = scope:director_candidate1.stewardship
					multiply = 10
				}
			}

			modifier = {
				add = {
					value = scope:director_candidate1.diplomacy
					multiply = 5
				}
			}

			modifier = {
				add = {
					add = scope:director_candidate1.martial
					add = scope:director_candidate1.intrigue
					add = scope:director_candidate1.learning
				}
			}

			modifier = {
				add = {
					value = scope:director_candidate1.age
					multiply = 2
				}
			}

			modifier = {
				opinion = {
					target = scope:director_candidate1
					value < 0
				}
				add = -50
			}

			modifier = {
				opinion = {
					target = scope:director_candidate1
					value >= 25
				}
				add = 25
			}

			modifier = {
				opinion = {
					target = scope:director_candidate1
					value >= 50
				}
				add = 25
			}

			modifier = {
				opinion = {
					target = scope:director_candidate1
					value >= 75
				}
				add = 25
			}

			modifier = {
				OR = {
					scope:director_candidate2 ?= this
					scope:director_candidate3 ?= this
					scope:director_candidate4 ?= this
				}
				factor = 0
			}
		}
	}

	option = {
		name = agot_banking.0215.b

		trigger = {
			exists = scope:director_candidate2
		}

		scope:director_candidate2 = {
			if = {
				limit = {
					root = { has_variable = IB_Shares }
					root.var:IB_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:IB_Shares
				}
			}
			else_if = {
				limit = {
					root = { has_variable = bank1_Shares }
					root.var:bank1_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:bank1_Shares
				}
			}
			else_if = {
				limit = {
					root = { has_variable = bank2_Shares }
					root.var:bank2_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:bank2_Shares
				}
			}
			else_if = {
				limit = {
					root = { has_variable = bank3_Shares }
					root.var:bank3_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:bank3_Shares
				}
			}
		}

		ai_chance = {
			base = 0

			modifier = {
				add = {
					value = scope:director_candidate2.stewardship
					multiply = 10
				}
			}

			modifier = {
				add = {
					value = scope:director_candidate2.diplomacy
					multiply = 5
				}
			}

			modifier = {
				add = {
					add = scope:director_candidate2.martial
					add = scope:director_candidate2.intrigue
					add = scope:director_candidate2.learning
				}
			}

			modifier = {
				add = {
					value = scope:director_candidate2.age
					multiply = 2
				}
			}

			modifier = {
				opinion = {
					target = scope:director_candidate2
					value < 0
				}
				add = -50
			}

			modifier = {
				opinion = {
					target = scope:director_candidate2
					value >= 25
				}
				add = 25
			}

			modifier = {
				opinion = {
					target = scope:director_candidate2
					value >= 50
				}
				add = 25
			}

			modifier = {
				opinion = {
					target = scope:director_candidate2
					value >= 75
				}
				add = 25
			}

			modifier = {
				OR = {
					scope:director_candidate1 ?= this
					scope:director_candidate3 ?= this
					scope:director_candidate4 ?= this
				}
				factor = 0
			}
		}
	}

	option = {
		name = agot_banking.0215.c

		trigger = {
			exists = scope:director_candidate3
		}

		scope:director_candidate3 = {
			if = {
				limit = {
					root = { has_variable = IB_Shares }
					root.var:IB_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:IB_Shares
				}
			}
			else_if = {
				limit = {
					root = { has_variable = bank1_Shares }
					root.var:bank1_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:bank1_Shares
				}
			}
			else_if = {
				limit = {
					root = { has_variable = bank2_Shares }
					root.var:bank2_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:bank2_Shares
				}
			}
			else_if = {
				limit = {
					root = { has_variable = bank3_Shares }
					root.var:bank3_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:bank3_Shares
				}
			}
		}

		ai_chance = {
			base = 0

			modifier = {
				add = {
					value = scope:director_candidate3.stewardship
					multiply = 10
				}
			}

			modifier = {
				add = {
					value = scope:director_candidate3.diplomacy
					multiply = 5
				}
			}

			modifier = {
				add = {
					add = scope:director_candidate3.martial
					add = scope:director_candidate3.intrigue
					add = scope:director_candidate3.learning
				}
			}

			modifier = {
				add = {
					value = scope:director_candidate3.age
					multiply = 2
				}
			}

			modifier = {
				opinion = {
					target = scope:director_candidate3
					value < 0
				}
				add = -50
			}

			modifier = {
				opinion = {
					target = scope:director_candidate3
					value >= 25
				}
				add = 25
			}

			modifier = {
				opinion = {
					target = scope:director_candidate3
					value >= 50
				}
				add = 25
			}

			modifier = {
				opinion = {
					target = scope:director_candidate3
					value >= 75
				}
				add = 25
			}

			modifier = {
				OR = {
					scope:director_candidate1 ?= this
					scope:director_candidate2 ?= this
					scope:director_candidate4 ?= this
				}
				factor = 0
			}
		}
	}

	option = {
		name = agot_banking.0215.d

		trigger = {
			exists = scope:director_candidate4
		}

		scope:director_candidate4 = {
			if = {
				limit = {
					root = { has_variable = IB_Shares }
					root.var:IB_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:IB_Shares
				}
			}
			else_if = {
				limit = {
					root = { has_variable = bank1_Shares }
					root.var:bank1_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:bank1_Shares
				}
			}
			else_if = {
				limit = {
					root = { has_variable = bank2_Shares }
					root.var:bank2_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:bank2_Shares
				}
			}
			else_if = {
				limit = {
					root = { has_variable = bank3_Shares }
					root.var:bank3_Shares > 0
				}
				change_variable = {
					name = director_votes
					add = root.var:bank3_Shares
				}
			}
		}

		ai_chance = {
			base = 0

			modifier = {
				add = {
					value = scope:director_candidate4.stewardship
					multiply = 10
				}
			}

			modifier = {
				add = {
					value = scope:director_candidate4.diplomacy
					multiply = 5
				}
			}

			modifier = {
				add = {
					add = scope:director_candidate4.martial
					add = scope:director_candidate4.intrigue
					add = scope:director_candidate4.learning
				}
			}

			modifier = {
				add = {
					value = scope:director_candidate4.age
					multiply = 2
				}
			}

			modifier = {
				opinion = {
					target = scope:director_candidate4
					value < 0
				}
				add = -50
			}

			modifier = {
				opinion = {
					target = scope:director_candidate4
					value >= 25
				}
				add = 25
			}

			modifier = {
				opinion = {
					target = scope:director_candidate4
					value >= 50
				}
				add = 25
			}

			modifier = {
				opinion = {
					target = scope:director_candidate4
					value >= 75
				}
				add = 25
			}

			modifier = {
				OR = {
					scope:director_candidate1 ?= this
					scope:director_candidate2 ?= this
					scope:director_candidate3 ?= this
				}
				factor = 0
			}
		}
	}
}

agot_banking.0225 = {
	hidden = yes

	trigger = {
		is_alive = yes
	}

	immediate = {
		if = {
			limit = {
				AND = {
					has_variable = IB_Shares
					var:IB_Shares > 0
				}
			}
			ordered_in_global_list = {  #determine election winner
				variable = IB_Shareholder
				limit = {
					is_alive = yes
					has_variable = director_votes
				}
				order_by = { value = var:director_votes }
				max = 1

				add_character_flag = IB_Director
				save_scope_as = director
			}

			every_in_global_list = {  # inform shareholders about new director
				variable = IB_Shareholder
				set_variable = {
					name = director_winner_votes
					value = scope:director.var:director_votes
				}
				trigger_event = {
					id = agot_banking.0205
					days = 1
				}
			}
		}
		else_if = {
			limit = {
				AND = {
					has_variable = bank1_Shares
					var:bank1_Shares > 0
				}
			}
			ordered_in_global_list = {  #determine election winner
				variable = bank1_Shareholder
				limit = {
					is_alive = yes
					has_variable = director_votes
				}
				order_by = { value = var:director_votes }
				max = 1

				add_character_flag = bank1_Director
				save_scope_as = director
			}

			every_in_global_list = {  # inform shareholders about new director
				variable = bank1_Shareholder
				set_variable = {
					name = director_winner_votes
					value = scope:director.var:director_votes
				}
				trigger_event = {
					id = agot_banking.0205
					days = 1
				}
			}
		}
		else_if = {
			limit = {
				AND = {
					has_variable = bank2_Shares
					var:bank2_Shares > 0
				}
			}
			ordered_in_global_list = {  #determine election winner
				variable = bank2_Shareholder
				limit = {
					is_alive = yes
					has_variable = director_votes
				}
				order_by = { value = var:director_votes }
				max = 1

				add_character_flag = bank2_Director
				save_scope_as = director
			}

			every_in_global_list = {  # inform shareholders about new director
				variable = bank2_Shareholder
				set_variable = {
					name = director_winner_votes
					value = scope:director.var:director_votes
				}
				trigger_event = {
					id = agot_banking.0205
					days = 1
				}
			}
		}
		else_if = {
			limit = {
				AND = {
					has_variable = bank3_Shares
					var:bank3_Shares > 0
				}
			}
			ordered_in_global_list = {  #determine election winner
				variable = bank3_Shareholder
				limit = {
					is_alive = yes
					has_variable = director_votes
				}
				order_by = { value = var:director_votes }
				max = 1

				add_character_flag = bank3_Director
				save_scope_as = director
			}

			every_in_global_list = {  # inform shareholders about new director
				variable = bank3_Shareholder
				set_variable = {
					name = director_winner_votes
					value = scope:director.var:director_votes
				}
				trigger_event = {
					id = agot_banking.0205
					days = 1
				}
			}
		}
	}
}
agot_banking.0601 = { # a new bank was founded
	type = character_event
	title = agot_banking.0601.t
	desc = agot_banking.0601.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = steward
	}

	widget = {
		gui = "event_window_widget_enter_text_banking"
		container = "dynamic_birth_name" # "custom_widgets_container"
		controller = {
			type = text
			data = {
				key = bank_name
				default = {
					localization_key = bank_name_default_blank
				}
			}
		}
		setup_scope = {
			root = { save_scope_as = text_target }
		}
	}

	option = {
		name = agot_banking.0601.a

		store_localized_text_in_death = bank_name

		if = {
			limit = {
				is_ai = yes
			}
			make_trait_inactive = ai_bank_founder
		}

		if = {
			limit = {
				global_var:bank1_BankValue = 0
			}

			add_character_flag = bank1_Director

			set_global_variable = {
				name = bank1_founder
				value = this
			}
			set_global_variable = {
				name = bank1_FreeCapital
				value = 700
			}
			set_global_variable = {
				name = bank1_NofShares
				value = 10
			}
			set_global_variable = {
				name = bank1_BankValue
				value = 700
			}
			set_global_variable = {
				name = bank1_ValuePerShare
				value = 70
			}
			set_global_variable = {
				name = bank1_location
				value = capital_barony
			}

			set_variable = {
				name = bank1_Shares
				value = 10
			}
			add_to_global_variable_list = {
				name = bank1_Shareholder
				target = this
			}
		}

		else_if = {
			limit = {
				global_var:bank2_BankValue = 0
			}

			add_character_flag = bank2_Director

			set_global_variable = {
				name = bank2_founder
				value = this
			}
			set_global_variable = {
				name = bank2_FreeCapital
				value = 700
			}
			set_global_variable = {
				name = bank2_NofShares
				value = 10
			}
			set_global_variable = {
				name = bank2_BankValue
				value = 700
			}
			set_global_variable = {
				name = bank2_ValuePerShare
				value = 70
			}
			set_global_variable = {
				name = bank2_location
				value = capital_barony
			}

			set_variable = {
				name = bank2_Shares
				value = 10
			}
			add_to_global_variable_list = {
				name = bank2_Shareholder
				target = this
			}
		}

		else_if = {
			limit = {
				global_var:bank3_BankValue = 0
			}

			add_character_flag = bank3_Director

			set_global_variable = {
				name = bank3_founder
				value = this
			}
			set_global_variable = {
				name = bank3_FreeCapital
				value = 700
			}
			set_global_variable = {
				name = bank3_NofShares
				value = 10
			}
			set_global_variable = {
				name = bank3_BankValue
				value = 700
			}
			set_global_variable = {
				name = bank3_ValuePerShare
				value = 70
			}
			set_global_variable = {
				name = bank3_location
				value = capital_barony
			}

			set_variable = {
				name = bank3_Shares
				value = 10
			}
			add_to_global_variable_list = {
				name = bank3_Shareholder
				target = this
			}
		}

		add_to_global_variable_list = {
			name = Shareholder
			target = this
		}

		set_variable = {
			name = BankName
			value = this
		}

		ai_chance = {
			base = 100
		}
	}
}

# agot_banking.0602 = { # new high profile debtor
# 	type = character_event
# 	title = agot_banking.0602.t
# 	desc = agot_banking.0602.desc
# 	theme = stewardship
# 	override_background = {
# 		reference = throne_room
# 	}

# 	left_portrait = {
# 		character = scope:NewDebtor
# 		animation = steward
# 	}

# 	option = {
# 		name = agot_banking.0602.a

# 		ai_chance = {
# 			base = 100
# 		}
# 	}
# }

agot_banking.0603 = {
	type = character_event
	title = agot_banking.0603.t
	desc = agot_banking.0603.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	widget = {
		is_shown = {
			is_ai = no
		}
		gui = "event_window_character_list_shareholders"
		container = "custom_widgets_container"
	}

	left_portrait = {
		character = root
		animation = chancellor
	}

	immediate = {
		if = {
			limit = {
				has_variable = IB_Shares
				var:IB_Shares > 0
				global_var:IB_NofShares > 0
			}

			ordered_in_global_list = {
				variable = IB_Shareholder
				order_by = { value = var:IB_Shares }
				max = 100

				set_variable = {
					name = ShownShares
					value = var:IB_Shares
				}
				root = {
					add_to_variable_list = {
						name = possible_characters
						target = prev
					}
				}
			}
		}
		else_if = {
			limit = {
				has_variable = bank1_Shares
				var:bank1_Shares > 0
				global_var:bank1_NofShares > 0
			}
			ordered_in_global_list = {
				variable = bank1_Shareholder
				order_by = { value = var:bank1_Shares }
				max = 100

				set_variable = {
					name = ShownShares
					value = var:bank1_Shares
				}
				root = {
					add_to_variable_list = {
						name = possible_characters
						target = prev
					}
				}
			}
		}
		else_if = {
			limit = {
				has_variable = bank2_Shares
				var:bank2_Shares > 0
				global_var:bank2_NofShares > 0
			}
			ordered_in_global_list = {
				variable = bank2_Shareholder
				order_by = { value = var:bank2_Shares }
				max = 100

				set_variable = {
					name = ShownShares
					value = var:bank2_Shares
				}
				root = {
					add_to_variable_list = {
						name = possible_characters
						target = prev
					}
				}
			}
		}
		else_if = {
			limit = {
				has_variable = bank3_Shares
				var:bank3_Shares > 0
				global_var:bank3_NofShares > 0
			}
			ordered_in_global_list = {
				variable = bank3_Shareholder
				order_by = { value = var:bank3_Shares }
				max = 100

				set_variable = {
					name = ShownShares
					value = var:bank3_Shares
				}
				root = {
					add_to_variable_list = {
						name = possible_characters
						target = prev
					}
				}
			}
		}
	}

	option = {
		name = agot_banking.0603.a

		clear_variable_list = possible_characters

		ai_chance = {
			base = 100
		}
	}
}
agot_banking.0604 = {
	type = character_event
	title = agot_banking.0604.t
	desc = agot_banking.0604.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	widget = {
		is_shown = {
			is_ai = no
		}
		gui = "event_window_character_list_debtors"
		container = "custom_widgets_container"
	}

	left_portrait = {
		character = root
		animation = chancellor
	}

	immediate = {
		if = {
			limit = {
				has_variable = IB_Shares
				var:IB_Shares > 0
			}
			ordered_in_global_list = {
				variable = IB_Important_Debtors
				limit = {
					has_variable = total_repayment
				}
				order_by = { value = var:total_repayment }
				max = 100

				root = {
					add_to_variable_list = {
						name = possible_characters
						target = prev
					}
				}
			}
		}
		else_if = {
			limit = {
				has_variable = bank1_Shares
				var:bank1_Shares > 0
			}
			ordered_in_global_list = {
				variable = bank1_Important_Debtors
				limit = {
					has_variable = total_repayment
				}
				order_by = { value = var:total_repayment }
				max = 100

				root = {
					add_to_variable_list = {
						name = possible_characters
						target = prev
					}
				}
			}
		}
		else_if = {
			limit = {
				has_variable = bank2_Shares
				var:bank2_Shares > 0
			}
			ordered_in_global_list = {
				variable = bank2_Important_Debtors
				limit = {
					has_variable = total_repayment
				}
				order_by = { value = var:total_repayment }
				max = 100

				root = {
					add_to_variable_list = {
						name = possible_characters
						target = prev
					}
				}
			}
		}
		else_if = {
			limit = {
				has_variable = bank3_Shares
				var:bank3_Shares > 0
			}
			ordered_in_global_list = {
				variable = bank3_Important_Debtors
				limit = {
					has_variable = total_repayment
				}
				order_by = { value = var:total_repayment }
				max = 100

				root = {
					add_to_variable_list = {
						name = possible_characters
						target = prev
					}
				}
			}
		}
	}

	option = {
		name = agot_banking.0604.a

		clear_variable_list = possible_characters

		ai_chance = {
			base = 100
		}
	}
}
agot_banking.0605 = {
	type = character_event
	title = agot_banking.0605.t
	desc = agot_banking.0605.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	widget = {
		is_shown = {
			is_ai = no
		}
		gui = "event_window_character_list_banks"
		container = "custom_widgets_container"
	}

	#left_portrait = {
	#	character = root
	#	animation = chancellor
	#}

	immediate = {
		every_in_global_list = {
			variable = Shareholder

			limit = {
				OR = {
					has_character_flag = IB_Director
					has_character_flag = bank1_Director
					has_character_flag = bank2_Director
					has_character_flag = bank3_Director
				}
			}

			if = {
				limit = {
					has_character_flag = IB_Director
				}
				set_variable = {
					name = BankValue
					value = global_var:IB_BankValue
				}
				set_variable = {
					name = InterestLevel
					value = global_var:IB_InterestLevel
				}
			}
			else_if = {
				limit = {
					has_character_flag = bank1_Director
				}
				set_variable = {
					name = BankValue
					value = global_var:bank1_BankValue
				}
				set_variable = {
					name = InterestLevel
					value = global_var:bank1_InterestLevel
				}
			}
			else_if = {
				limit = {
					has_character_flag = bank2_Director
				}
				set_variable = {
					name = BankValue
					value = global_var:bank2_BankValue
				}
				set_variable = {
					name = InterestLevel
					value = global_var:bank2_InterestLevel
				}
			}
			else_if = {
				limit = {
					has_character_flag = bank3_Director
				}
				set_variable = {
					name = BankValue
					value = global_var:bank3_BankValue
				}
				set_variable = {
					name = InterestLevel
					value = global_var:bank3_InterestLevel
				}
			}

			root = {
				add_to_variable_list = {
					name = possible_characters
					target = prev
				}
			}
		}
	}

	option = {
		name = agot_banking.0605.a

		clear_variable_list = possible_characters

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.1108 = { # emperor reacts to offer
	type = character_event
	title = agot_banking.1108.t
	desc = agot_banking.1108.desc
	theme = diplomacy
	override_background = {
		reference = throne_room_west
	}

	left_portrait = {
		character = scope:FinalDefaulter
		animation = thinking
	}

	immediate = {
		set_variable = {
			name = loan_penalty_payment
			value = var:payable_interest
		}
		change_variable = {
			name = loan_penalty_payment
			multiply = 0.5
		}
	}

	option = {   # accept
		name = agot_banking.1108.a
		custom_tooltip = agot_banking.1108.a_tt

		# inform revisor about success
		scope:default_revisor = {
			add_character_flag = letter3_success
			trigger_event = {
				id =  agot_banking.0212
			}
		}


		if = {
			limit = {
				has_character_flag = IB_debtor
			}
			change_global_variable = {
				name = IB_LoanedCapital
				add = scope:FinalDefaulter.var:loaned_amount
			}
			change_global_variable = {
				name = IB_BankValue
				add = scope:FinalDefaulter.var:loaned_amount
			}

			if = {
				limit = {
					global_var:IB_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = IB_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = IB_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = IB_FreeCapital
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = IB_BankValue
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = IB_Earnings
				add = var:loan_penalty_payment
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank1_debtor
			}
			change_global_variable = {
				name = bank1_LoanedCapital
				add = scope:FinalDefaulter.var:loaned_amount
			}
			change_global_variable = {
				name = bank1_BankValue
				add = scope:FinalDefaulter.var:loaned_amount
			}

			if = {
				limit = {
					global_var:bank1_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = bank1_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = bank1_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = bank1_FreeCapital
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = bank1_BankValue
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = bank1_Earnings
				add = var:loan_penalty_payment
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank2_debtor
			}
			change_global_variable = {
				name = bank2_LoanedCapital
				add = scope:FinalDefaulter.var:loaned_amount
			}
			change_global_variable = {
				name = bank2_BankValue
				add = scope:FinalDefaulter.var:loaned_amount
			}

			if = {
				limit = {
					global_var:bank2_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = bank2_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = bank2_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = bank2_FreeCapital
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = bank2_BankValue
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = bank2_Earnings
				add = var:loan_penalty_payment
			}
		}
		else_if = {
			limit = {
				has_character_flag = bank3_debtor
			}
			change_global_variable = {
				name = bank3_LoanedCapital
				add = scope:FinalDefaulter.var:loaned_amount
			}
			change_global_variable = {
				name = bank3_BankValue
				add = scope:FinalDefaulter.var:loaned_amount
			}

			if = {
				limit = {
					global_var:bank3_LostLoans >= scope:FinalDefaulter.var:loaned_amount
				}
				change_global_variable = {
					name = bank3_LostLoans
					subtract = scope:FinalDefaulter.var:loaned_amount
				}
			}
			else = {
				set_global_variable = {
					name = bank3_LostLoans
					value = 0
				}
			}

			change_global_variable = {
				name = bank3_FreeCapital
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = bank3_BankValue
				add = var:loan_penalty_payment
			}
			change_global_variable = {
				name = bank3_Earnings
				add = var:loan_penalty_payment
			}
		}


		remove_character_flag = final_default

		remove_short_term_gold = var:loan_penalty_payment

		set_variable = {
			name = loan_term
			value = 3
		}

		create_story = {
			type = story_agot_loan
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_boldness = -0.5
				ai_rationality = 1
			}
			modifier = {
				add = {
					value = scope:default_revisor.diplomacy
					subtract = scope:FinalDefaulter.diplomacy
					multiply = 10
				}
			}
		}
	}

	option = {   # refuse
		name = agot_banking.1108.b
		custom_tooltip = agot_banking.1108.b_tt

		# inform revisor about failed attempt
		scope:default_revisor = {
			add_character_flag = attempted_letter
			add_character_flag = letter4_failed
			trigger_event = {
				id =  agot_banking.0211   # follow-up attempt
			}
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_boldness = 0.5
				ai_rationality = -1
			}
		}
	}
}

agot_banking.0700 = {
	type = character_event
	title = agot_banking.0700.t
	desc = agot_banking.0700.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = worry
	}

	immediate = {
		if = {
			limit = {
				has_variable = IB_Shares
				var:IB_Shares > 0
				global_var:IB_NofShares > 0
			}
			set_variable = {
				name = payout
				value = global_var:IB_FreeCapital
			}
			change_variable = {
				name = payout
				divide = global_var:IB_NofShares
			}
			change_variable = {
				name = payout
				multiply = var:IB_Shares
			}
		}
		else_if = {
			limit = {
				has_variable = bank1_Shares
				var:bank1_Shares > 0
				global_var:bank1_NofShares > 0
			}
			set_variable = {
				name = payout
				value = global_var:bank1_FreeCapital
			}
			change_variable = {
				name = payout
				divide = global_var:bank1_NofShares
			}
			change_variable = {
				name = payout
				multiply = var:bank1_Shares
			}
		}
		else_if = {
			limit = {
				has_variable = bank2_Shares
				var:bank2_Shares > 0
				global_var:bank2_NofShares > 0
			}
			set_variable = {
				name = payout
				value = global_var:bank2_FreeCapital
			}
			change_variable = {
				name = payout
				divide = global_var:bank2_NofShares
			}
			change_variable = {
				name = payout
				multiply = var:bank2_Shares
			}
		}
		else_if = {
			limit = {
				has_variable = bank3_Shares
				var:bank3_Shares > 0
				global_var:bank3_NofShares > 0
			}
			set_variable = {
				name = payout
				value = global_var:bank3_FreeCapital
			}
			change_variable = {
				name = payout
				divide = global_var:bank3_NofShares
			}
			change_variable = {
				name = payout
				multiply = var:bank3_Shares
			}
		}
	}

	option = {
		name = agot_banking.0700.a

		if = {
			limit = {
				exists = var:payout
				var:payout > 0
			}
			add_gold = var:payout
		}

		if = {
			limit = {
				has_variable = IB_Shares
				var:IB_Shares > 0
			}
			change_global_variable = {
				name = IB_NofShares
				subtract = var:IB_Shares
			}
		}
		else_if = {
			limit = {
				has_variable = bank1_Shares
				var:bank1_Shares > 0
			}
			change_global_variable = {
				name = bank1_NofShares
				subtract = var:bank1_Shares
			}
		}
		else_if = {
			limit = {
				has_variable = bank2_Shares
				var:bank2_Shares > 0
			}
			change_global_variable = {
				name = bank2_NofShares
				subtract = var:bank2_Shares
			}
		}
		else_if = {
			limit = {
				has_variable = bank3_Shares
				var:bank3_Shares > 0
			}
			change_global_variable = {
				name = bank3_NofShares
				subtract = var:bank3_Shares
			}
		}

		remove_variable = IB_Shares
		remove_variable = BankName
		remove_list_global_variable = {
			name = IB_Shareholder
			target = this
		}
		remove_variable = bank1_Shares
		remove_variable = BankName
		remove_list_global_variable = {
			name = bank1_Shareholder
			target = this
		}
		remove_variable = bank2_Shares
		remove_variable = BankName
		remove_list_global_variable = {
			name = bank2_Shareholder
			target = this
		}
		remove_variable = bank3_Shares
		remove_variable = BankName
		remove_list_global_variable = {
			name = bank3_Shareholder
			target = this
		}

		remove_list_global_variable = {
			name = Shareholder
			target = this
		}

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0701 = {  #decide if the bank shall be raided
	type = character_event
	title = agot_banking.0701.t
	desc = agot_banking.0701.desc
	theme = battle
	override_background = {
		reference = battlefield
	}

	left_portrait = {
		character = root
		animation = personality_greedy
	}

	immediate = {
		if = {
			limit = {
				global_var:IB_location ?= scope:barony
			}
			random_in_global_list = {
				variable = IB_Shareholder
				save_scope_as = bank_shareholder
			}
			set_variable = {
				name = raided_gold
				value = {
					value = global_var:IB_FreeCapital
					multiply = 0.33
					max = 750
				}
			}
		}
		else_if = {
			limit = {
				global_var:bank1_location ?= scope:barony
			}
			random_in_global_list = {
				variable = bank1_Shareholder
				save_scope_as = bank_shareholder
			}
			set_variable = {
				name = raided_gold
				value = {
					value = global_var:bank1_FreeCapital
					multiply = 0.33
					max = 750
				}
			}
		}
		else_if = {
			limit = {
				global_var:bank2_location ?= scope:barony
			}
			random_in_global_list = {
				variable = bank2_Shareholder
				save_scope_as = bank_shareholder
			}
			set_variable = {
				name = raided_gold
				value = {
					value = global_var:bank2_FreeCapital
					multiply = 0.33
					max = 750
				}
			}
		}
		else_if = {
			limit = {
				global_var:bank3_location ?= scope:barony
			}
			random_in_global_list = {
				variable = bank3_Shareholder
				save_scope_as = bank_shareholder
			}
			set_variable = {
				name = raided_gold
				value = {
					value = global_var:bank3_FreeCapital
					multiply = 0.33
					max = 750
				}
			}
		}
	}

	option = {  #yes
		name = agot_banking.0701.a

		add_gold = var:raided_gold
		save_scope_as = bank_raider
		add_character_flag = raided_bank

		if = {
			limit = {
				global_var:IB_location ?= scope:barony
			}
			change_global_variable = {
				name = IB_FreeCapital
				subtract = var:raided_gold
			}
			change_global_variable = {
				name = IB_BankValue
				subtract = var:raided_gold
			}
			change_global_variable = {
				name = IB_Expenses
				add = var:raided_gold
			}
			every_in_global_list = {
				variable = IB_Shareholder
				limit = {
					has_character_flag = IB_Director
				}
				trigger_event = {
					id = agot_banking.0702
				}
			}
		}
		else_if = {
			limit = {
				global_var:bank1_location ?= scope:barony
			}
			change_global_variable = {
				name = bank1_FreeCapital
				subtract = var:raided_gold
			}
			change_global_variable = {
				name = bank1_BankValue
				subtract = var:raided_gold
			}
			change_global_variable = {
				name = bank1_Expenses
				add = var:raided_gold
			}
			every_in_global_list = {
				variable = bank1_Shareholder
				limit = {
					has_character_flag = bank1_Director
				}
				trigger_event = {
					id = agot_banking.0702
				}
			}
		}
		else_if = {
			limit = {
				global_var:bank2_location ?= scope:barony
			}
			change_global_variable = {
				name = bank2_FreeCapital
				subtract = var:raided_gold
			}
			change_global_variable = {
				name = bank2_BankValue
				subtract = var:raided_gold
			}
			change_global_variable = {
				name = bank2_Expenses
				add = var:raided_gold
			}
			every_in_global_list = {
				variable = bank2_Shareholder
				limit = {
					has_character_flag = bank2_Director
				}
				trigger_event = {
					id = agot_banking.0702
				}
			}
		}
		else_if = {
			limit = {
				global_var:bank3_location ?= scope:barony
			}
			change_global_variable = {
				name = bank3_FreeCapital
				subtract = var:raided_gold
			}
			change_global_variable = {
				name = bank3_BankValue
				subtract = var:raided_gold
			}
			change_global_variable = {
				name = bank3_Expenses
				add = var:raided_gold
			}
			every_in_global_list = {
				variable = bank3_Shareholder
				limit = {
					has_character_flag = bank3_Director
				}
				trigger_event = {
					id = agot_banking.0702
				}
			}
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_boldness = 0.5
				ai_greed = 1
				ai_rationality = -0.5
			}
		}
	}

	option = {  #no
		name = agot_banking.0701.b

		remove_variable = raided_gold

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0702 = {  #inform the banks director
	type = character_event
	title = agot_banking.0702.t
	desc = agot_banking.0702.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = anger
	}

	immediate = {
		save_scope_as = raided_director
	}

	option = {  #demand repayment
		name = agot_banking.0702.a

		scope:bank_raider = {
			trigger_event = {
				id = agot_banking.0703
				months = 1
			}
		}

		ai_chance = {
			base = 100
		}
	}

	option = {  #do nothing
		name = agot_banking.0702.b

		ai_chance = {
			base = 0
		}
	}
}

agot_banking.0703 = {  #letter to the bank raider, demanding repayment
	type = letter_event
	opening = agot_banking.0703.t
	desc = agot_banking.0703.desc
	sender = scope:raided_director

	immediate = {
		set_variable = {
			name = raided_gold_repayment
			value = {
				value = var:raided_gold
				multiply = 1.1
			}
		}
	}

	option = {  #Repay everything at once
		name = agot_banking.0703.a

		trigger = {
			gold >= var:raided_gold_repayment
		}

		scope:raided_director = {
			trigger_event = {
				id = agot_banking.0704
			}
		}

		remove_short_term_gold = var:raided_gold_repayment

		if = {
			limit = {
				global_var:IB_location ?= scope:barony
			}
			change_global_variable = {
				name = IB_FreeCapital
				add = var:raided_gold_repayment
			}
			change_global_variable = {
				name = IB_BankValue
				add = var:raided_gold_repayment
			}
			change_global_variable = {
				name = IB_Expenses
				subtract = var:raided_gold
			}
			if = {
				limit = {
					global_var:IB_Expenses < 0
				}
				set_global_variable = {
					name = IB_Expenses
					value = 0
				}
			}
			change_global_variable = {
				name = IB_Earnings
				add = {
					value = var:raided_gold
					multiply = 0.1
				}
			}
		}
		else_if = {
			limit = {
				global_var:bank1_location ?= scope:barony
			}
			change_global_variable = {
				name = bank1_FreeCapital
				add = var:raided_gold_repayment
			}
			change_global_variable = {
				name = bank1_BankValue
				add = var:raided_gold_repayment
			}
			change_global_variable = {
				name = bank1_Expenses
				subtract = var:raided_gold
			}
			if = {
				limit = {
					global_var:bank1_Expenses < 0
				}
				set_global_variable = {
					name = bank1_Expenses
					value = 0
				}
			}
			change_global_variable = {
				name = bank1_Earnings
				add = {
					value = var:raided_gold
					multiply = 0.1
				}
			}
		}
		else_if = {
			limit = {
				global_var:bank2_location ?= scope:barony
			}
			change_global_variable = {
				name = bank2_FreeCapital
				add = var:raided_gold_repayment
			}
			change_global_variable = {
				name = bank2_BankValue
				add = var:raided_gold_repayment
			}
			change_global_variable = {
				name = bank2_Expenses
				subtract = var:raided_gold
			}
			if = {
				limit = {
					global_var:bank2_Expenses < 0
				}
				set_global_variable = {
					name = bank2_Expenses
					value = 0
				}
			}
			change_global_variable = {
				name = bank2_Earnings
				add = {
					value = var:raided_gold
					multiply = 0.1
				}
			}
		}
		else_if = {
			limit = {
				global_var:bank3_location ?= scope:barony
			}
			change_global_variable = {
				name = bank3_FreeCapital
				add = var:raided_gold_repayment
			}
			change_global_variable = {
				name = bank3_BankValue
				add = var:raided_gold_repayment
			}
			change_global_variable = {
				name = bank3_Expenses
				subtract = var:raided_gold
			}
			if = {
				limit = {
					global_var:bank3_Expenses < 0
				}
				set_global_variable = {
					name = bank3_Expenses
					value = 0
				}
			}
			change_global_variable = {
				name = bank3_Earnings
				add = {
					value = var:raided_gold
					multiply = 0.1
				}
			}
		}

		remove_character_flag = raided_bank
		remove_variable = raided_gold
		remove_variable = raided_gold_repayment

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_boldness = -0.5
				ai_greed = -1
				ai_rationality = 0.5
			}
		}
	}

	option = {  #Repay via loan
		name = agot_banking.0703.b
		custom_tooltip = agot_banking.0703.b_tt

		scope:raided_director = {
			trigger_event = {
				id = agot_banking.0705
			}
		}

		add_character_flag = has_a_loan_flag

		set_variable = {
			name = loaned_amount
			value = var:raided_gold
		}
		set_variable = {
			name = loan_term
			value = 3
		}
		set_variable = {
			name = loan_interest_rate
			value = 5
		}

		set_variable = {
			name = payable_interest
			value = var:loan_interest_rate
		}
		change_variable = {
			name = payable_interest
			divide = 100
		}
		change_variable = {
			name = payable_interest
			multiply = {
				value = var:loan_term
				multiply = var:loaned_amount
			}
		}

		set_variable = {
			name = total_repayment
			value = var:loaned_amount
		}
		change_variable = {
			name = total_repayment
			add = var:payable_interest
		}

		set_variable = {
			name = half_repayment
			value = var:total_repayment
		}
		change_variable = {
			name = half_repayment
			divide = 2
		}

		if = {
			limit = {
				global_var:IB_location ?= scope:barony
			}

			add_character_flag = IB_debtor

			change_global_variable = {
				name = IB_Expenses
				subtract = var:loaned_amount
			}
			if = {
				limit = {
					global_var:IB_Expenses < 0
				}
				set_global_variable = {
					name = IB_Expenses
					value = 0
				}
			}

			change_global_variable = {
				name = IB_LoanedCapital
				add = var:loaned_amount
			}
			change_global_variable = {
				name = IB_BankValue
				add = var:loaned_amount
			}
		}

		else_if = {
			limit = {
				global_var:bank1_location ?= scope:barony
			}
			add_character_flag = bank1_debtor

			change_global_variable = {
				name = bank1_Expenses
				subtract = var:loaned_amount
			}
			if = {
				limit = {
					global_var:bank1_Expenses < 0
				}
				set_global_variable = {
					name = bank1_Expenses
					value = 0
				}
			}

			change_global_variable = {
				name = bank1_LoanedCapital
				add = var:loaned_amount
			}
			change_global_variable = {
				name = bank1_BankValue
				add = var:loaned_amount
			}
		}

		else_if = {
			limit = {
				global_var:bank2_location ?= scope:barony
			}
			add_character_flag = bank2_debtor

			change_global_variable = {
				name = bank2_Expenses
				subtract = var:loaned_amount
			}
			if = {
				limit = {
					global_var:bank2_Expenses < 0
				}
				set_global_variable = {
					name = bank2_Expenses
					value = 0
				}
			}

			change_global_variable = {
				name = bank2_LoanedCapital
				add = var:loaned_amount
			}
			change_global_variable = {
				name = bank2_BankValue
				add = var:loaned_amount
			}
		}

		else_if = {
			limit = {
				global_var:bank3_location ?= scope:barony
			}
			add_character_flag = bank3_debtor

			change_global_variable = {
				name = bank3_Expenses
				subtract = var:loaned_amount
			}
			if = {
				limit = {
					global_var:bank3_Expenses < 0
				}
				set_global_variable = {
					name = bank3_Expenses
					value = 0
				}
			}

			change_global_variable = {
				name = bank3_LoanedCapital
				add = var:loaned_amount
			}
			change_global_variable = {
				name = bank3_BankValue
				add = var:loaned_amount
			}
		}

		create_story = {
			type = story_agot_loan
		}

		remove_character_flag = raided_bank
		remove_variable = raided_gold
		remove_variable = raided_gold_repayment


		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_boldness = -0.25
				ai_greed = -0.5
				ai_rationality = 0.25
			}
		}
	}

	option = {  #Refuse to pay, handle as final default
		name = agot_banking.0703.c
		custom_tooltip = agot_banking.0703.c_tt

		add_character_flag = has_a_loan_flag
		add_character_flag = defaulted_on_loan
		add_character_flag = final_default

		# inform director about final default
		save_scope_as = FinalDefaulter


		set_variable = {
			name = loaned_amount
			value = var:raided_gold
		}
		set_variable = {
			name = loan_term
			value = 3
		}
		set_variable = {
			name = loan_interest_rate
			value = 5
		}

		set_variable = {
			name = payable_interest
			value = var:loan_interest_rate
		}
		change_variable = {
			name = payable_interest
			divide = 100
		}
		change_variable = {
			name = payable_interest
			multiply = {
				value = var:loan_term
				multiply = var:loaned_amount
			}
		}

		set_variable = {
			name = total_repayment
			value = var:loaned_amount
		}
		change_variable = {
			name = total_repayment
			add = var:payable_interest
		}

		set_variable = {
			name = half_repayment
			value = var:total_repayment
		}
		change_variable = {
			name = half_repayment
			divide = 2
		}

		if = {
			limit = {
				global_var:IB_location ?= scope:barony
			}

			add_character_flag = IB_debtor

			change_global_variable = {
				name = IB_Expenses
				subtract = var:loaned_amount
			}
			if = {
				limit = {
					global_var:IB_Expenses < 0
				}
				set_global_variable = {
					name = IB_Expenses
					value = 0
				}
			}

			change_global_variable = {
				name = IB_LostLoans
				add = var:loaned_amount
			}

			every_in_global_list = {
				variable = IB_Shareholder
				limit = {
					has_character_flag = IB_Director
				}
				save_scope_as = director
				if = {
					limit = {
						OR = {
							is_incapable = yes
							has_character_flag = no_default_handling
						}
					}
					if = {
						limit = {
							any_in_global_list = {
								variable = IB_Shareholder
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = IB_Director }
								is_adult = yes
							}
						}
						random_in_global_list = {
							variable = IB_Shareholder

							limit = {
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = IB_Director }
								is_adult = yes
							}

							weight = {
								base = 100
								modifier = {
									has_trait = ambitious
									add = 50
								}
								modifier = {
									has_trait = diligent
									add = 50
								}
								modifier = {
									add = {
										value = var:IB_Shares
										multiply = 10
									}
								}
							}

							set_variable = {  # base amount for possible bonus payment
								name = recovered_amount
								value = scope:FinalDefaulter.var:total_repayment
							}

							add_character_flag = {
								flag = handling_default
								years = 1
							}
							save_scope_as = default_revisor
							trigger_event = {
								id =  agot_banking.0211   # initial action selection
							}
						}
					}
				}
				else = {
					trigger_event = {
						id = agot_banking.0210
					}
				}
			}
		}

		else_if = {
			limit = {
				global_var:bank1_location ?= scope:barony
			}
			add_character_flag = bank1_debtor

			change_global_variable = {
				name = bank1_Expenses
				subtract = var:loaned_amount
			}
			if = {
				limit = {
					global_var:bank1_Expenses < 0
				}
				set_global_variable = {
					name = bank1_Expenses
					value = 0
				}
			}

			change_global_variable = {
				name = bank1_LostLoans
				add = var:loaned_amount
			}

			every_in_global_list = {
				variable = bank1_Shareholder
				limit = {
					has_character_flag = bank1_Director
				}
				save_scope_as = director
				if = {
					limit = {
						OR = {
							is_incapable = yes
							has_character_flag = no_default_handling
						}
					}
					if = {
						limit = {
							any_in_global_list = {
								variable = bank1_Shareholder
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = bank1_Director }
								is_adult = yes
							}
						}
						random_in_global_list = {
							variable = bank1_Shareholder

							limit = {
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = bank1_Director }
								is_adult = yes
							}

							weight = {
								base = 100
								modifier = {
									has_trait = ambitious
									add = 50
								}
								modifier = {
									has_trait = diligent
									add = 50
								}
								modifier = {
									add = {
										value = var:bank1_Shares
										multiply = 10
									}
								}
							}

							set_variable = {  # base amount for possible bonus payment
								name = recovered_amount
								value = scope:FinalDefaulter.var:total_repayment
							}

							add_character_flag = {
								flag = handling_default
								years = 1
							}
							save_scope_as = default_revisor
							trigger_event = {
								id =  agot_banking.0211   # initial action selection
							}
						}
					}
				}
				else = {
					trigger_event = {
						id = agot_banking.0210
					}
				}
			}
		}

		else_if = {
			limit = {
				global_var:bank2_location ?= scope:barony
			}
			add_character_flag = bank2_debtor

			change_global_variable = {
				name = bank2_Expenses
				subtract = var:loaned_amount
			}
			if = {
				limit = {
					global_var:bank2_Expenses < 0
				}
				set_global_variable = {
					name = bank2_Expenses
					value = 0
				}
			}

			change_global_variable = {
				name = bank2_LostLoans
				add = var:loaned_amount
			}

			every_in_global_list = {
				variable = bank2_Shareholder
				limit = {
					has_character_flag = bank2_Director
				}
				save_scope_as = director
				if = {
					limit = {
						OR = {
							is_incapable = yes
							has_character_flag = no_default_handling
						}
					}
					if = {
						limit = {
							any_in_global_list = {
								variable = bank2_Shareholder
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = bank2_Director }
								is_adult = yes
							}
						}
						random_in_global_list = {
							variable = bank2_Shareholder

							limit = {
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = bank2_Director }
								is_adult = yes
							}

							weight = {
								base = 100
								modifier = {
									has_trait = ambitious
									add = 50
								}
								modifier = {
									has_trait = diligent
									add = 50
								}
								modifier = {
									add = {
										value = var:bank2_Shares
										multiply = 10
									}
								}
							}

							set_variable = {  # base amount for possible bonus payment
								name = recovered_amount
								value = scope:FinalDefaulter.var:total_repayment
							}

							add_character_flag = {
								flag = handling_default
								years = 1
							}
							save_scope_as = default_revisor
							trigger_event = {
								id =  agot_banking.0211   # initial action selection
							}
						}
					}
				}
				else = {
					trigger_event = {
						id = agot_banking.0210
					}
				}
			}
		}

		else_if = {
			limit = {
				global_var:bank3_location ?= scope:barony
			}
			add_character_flag = bank3_debtor

			change_global_variable = {
				name = bank3_Expenses
				subtract = var:loaned_amount
			}
			if = {
				limit = {
					global_var:bank3_Expenses < 0
				}
				set_global_variable = {
					name = bank3_Expenses
					value = 0
				}
			}

			change_global_variable = {
				name = bank3_LostLoans
				add = var:loaned_amount
			}

			every_in_global_list = {
				variable = bank3_Shareholder
				limit = {
					has_character_flag = bank3_Director
				}
				save_scope_as = director
				if = {
					limit = {
						OR = {
							is_incapable = yes
							has_character_flag = no_default_handling
						}
					}
					if = {
						limit = {
							any_in_global_list = {
								variable = bank3_Shareholder
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = bank3_Director }
								is_adult = yes
							}
						}
						random_in_global_list = {
							variable = bank3_Shareholder

							limit = {
								NOT = { has_character_flag = handling_default }
								NOT = { has_character_flag = bank3_Director }
								is_adult = yes
							}

							weight = {
								base = 100
								modifier = {
									has_trait = ambitious
									add = 50
								}
								modifier = {
									has_trait = diligent
									add = 50
								}
								modifier = {
									add = {
										value = var:bank3_Shares
										multiply = 10
									}
								}
							}

							set_variable = {  # base amount for possible bonus payment
								name = recovered_amount
								value = scope:FinalDefaulter.var:total_repayment
							}

							add_character_flag = {
								flag = handling_default
								years = 1
							}
							save_scope_as = default_revisor
							trigger_event = {
								id =  agot_banking.0211   # initial action selection
							}
						}
					}
				}
				else = {
					trigger_event = {
						id = agot_banking.0210
					}
				}
			}
		}

		remove_variable = raided_gold
		remove_variable = raided_gold_repayment

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0704 = {
	type = character_event
	title = agot_banking.0704.t
	desc = agot_banking.0704.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = war_over_win
	}

	option = {  #demand repayment
		name = agot_banking.0704.a

		ai_chance = {
			base = 100
		}
	}
}

agot_banking.0705 = {  #inform the banks director
	type = character_event
	title = agot_banking.0705.t
	desc = agot_banking.0705.desc
	theme = stewardship
	override_background = {
		reference = throne_room
	}

	left_portrait = {
		character = root
		animation = war_over_win
	}

	option = {
		name = agot_banking.0705.a

		ai_chance = {
			base = 100
		}
	}
}